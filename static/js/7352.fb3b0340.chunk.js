"use strict";(self.webpackChunkn2_depot=self.webpackChunkn2_depot||[]).push([[7352],{5109:(t,e,i)=>{i.d(e,{k:()=>o});var n=i(6326),s=i(68134),a=(i(76460),i(81806),i(47249),i(50076),i(87990)),r=i(56829);let o=class extends r.g{constructor(t){super(t)}initialize(){this.addHandles((0,s.wB)(()=>this.analysisViewData.visible,t=>this.visible=t,s.pc))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};o=(0,n.Cg)([(0,a.$)("esri.views.interactive.AnalysisToolBase")],o)},10260:(t,e,i)=>{i.d(e,{Hd:()=>l,ZX:()=>c,aS:()=>u,qW:()=>d});var n=i(98773),s=i(54901),a=i(30726),r=i(50346),o=i(68134);function l(t,e){return(0,o.wB)(()=>t.interactive,()=>function(t,e){t.interactive?function(t,e){u(t);const{view:i,analysis:n}=t,s=new e({view:i,analysis:n,analysisViewData:t});t.tool=s,i.tools.add(s)}(t,e):u(t)}(t,e),o.pc)}function u(t){const{view:e,tool:i}=t;null!=i&&(e.tools.remove(i),t.tool=null)}function d(t,e){var i;const l=t.userOperation,u=(0,n.UT)(async i=>{var u;if(l){const t=l.promise.catch(()=>{});null!==l&&void 0!==l&&l.abort(),await t,(0,r.Te)(i)}const d=function(t,e){t.interactive=!0;const{tool:i,view:s}=t;s.activeTool=i;let l=(0,r.u7)(e,()=>{s.activeTool===i&&(s.activeTool=null)});return(0,n.UT)(async e=>{await(0,o.C_)(()=>{var e;return!(null!==(e=t.tool)&&void 0!==e&&e.active)},e),l=(0,a.xt)(l)},e)}(t,{signal:i}),c=null!==(u=null===e||void 0===e?void 0:e.shouldRejectOnCancel)&&void 0!==u?u:()=>!0,h=(0,s.vE)([(0,o.on)(()=>t.tool,"cancel",()=>{c()&&d.abort()})]),{tool:g}=t;try{var v;g&&(g.resetCreated(),null!==e&&void 0!==e&&null!==(v=e.onToolActivated)&&void 0!==v&&v.call(e,g)),await d.promise,(0,r.Te)(i)}catch(p){if(i.aborted||!(0,r.zf)(p)||c())throw p}finally{null===h||void 0===h||h.remove()}},{signal:null===e||void 0===e||null===(i=e.abortOptions)||void 0===i?void 0:i.signal});return t.userOperation=u,u.promise.finally(()=>{t.userOperation===u&&(t.userOperation=null)})}async function c(t,e){const i=t.analysis.clone();return await d(t,{abortOptions:null===e||void 0===e?void 0:e.placementOptions,onToolActivated:null===e||void 0===e?void 0:e.onToolActivated,shouldRejectOnCancel:()=>{const{analysis:e}=t;return!e.valid||e.equals(i)}}),{}}},11113:(t,e,i)=>{i.d(e,{Ee:()=>l,Jd:()=>m,Nk:()=>h,OM:()=>_,Oo:()=>p,W4:()=>u,ix:()=>g,t_:()=>c,tr:()=>d,yh:()=>v,zJ:()=>r});var n=i(73582),s=i(24648),a=i(96820);function r(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,a.zJ)(t,(0,s.kM)(e,i).value,i,n,r)}function o(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,a.nD)(t,(0,s.kM)(e,i).value,i,n,r)}function l(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.Ee)(t,e.value,e.unit,i,n)}function u(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.W4)(t,e.value,e.unit,i,n)}function d(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.tr)(t,e.value,e.unit,i,n)}function c(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.t_)(t,e.value,e.unit,i,n)}function h(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.ie,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,a.Me)(t.value,t.unit,t.rotationType,e,i,s,r)}function g(t,e,i,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(n=null!==n&&void 0!==n?n:2,i){case"imperial":return d(t,e,n,s);case"metric":return l(t,e,n,s);default:return r(t,e,i,n,s)}}function v(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.J1)(t,e.value,e.unit,i,n)}(t,e,n,s);case"metric":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.Mm)(t,e.value,e.unit,i,n)}(t,e,n,s);default:return o(t,e,i,n,s)}}function p(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return c(t,e,n,s);case"metric":return u(t,e,n,s);default:return r(t,e,i,n,s)}}function _(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.LF)(t,e.value,e.unit,i,n)}(t,e,n,s);case"metric":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.e_)(t,e.value,e.unit,i,n)}(t,e,n,s);default:return o(t,e,i,n,s)}}function m(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.Sz)(t,e.value,e.unit,i,n)}(t,e,n,s);case"metric":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,a.zq)(t,e.value,e.unit,i,n)}(t,e,n,s);default:return r(t,e,i,n,s)}}},67352:(t,e,i)=>{i.r(e),i.d(e,{default:()=>te});var n=i(6326),s=(i(81806),i(30726)),a=i(46053),r=i(76460),o=(i(47249),i(87990)),l=i(19747),u=i(72205),d=i(91967),c=i(24648),h=i(68134),g=i(31633),v=i(17430),p=i(29772);let _=class extends d.A{constructor(t){super(t)}initialize(){this.addHandles([(0,h.wB)(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),t=>{let{viewData:e,startPoint:i}=t;e.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(i)},h.pc),(0,h.wB)(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),t=>{let{viewData:e,endPoint:i}=t;e.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(i)},h.pc),(0,h.wB)(()=>({result:this._computedResult,viewData:this.viewData}),t=>{let{result:e,viewData:i}=t;i.result=e},h.pc)])}_applyProjectionAndElevationAlignment(t){if(null==t)return t;const{spatialReference:e,elevationProvider:i}=this.view,n=(0,v.B)(t,e,i);return null!==n&&void 0!==n?n:((0,v.V)(this.analysis,t.spatialReference,r.A.getLogger(this)),null)}get _computedResult(){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,measurementMode:i,unit:n}=this.viewData;if(null==t||null==e)return null;const s=(0,p.NH)(t,e),a=this.geodesicLengthMeasurementUtils.geodesicDistanceBetweenPoints(t,e);if(null==s)return null;let r,o;switch(i){case 0:o=null!=a?"geodesic":"euclidean",r=null!==a&&void 0!==a?a:s.horizontal;break;case 2:if(null==a)return null;o="geodesic",r=a;break;case 1:o="euclidean",r=s.horizontal}let l=s.direct,u=s.vertical;const d=(0,g.Vs)(l.value,l.unit,n),h=(0,g.Vs)(r.value,r.unit,n),v=(0,g.jE)(u.value,u.unit,n);return l=(0,c.kM)(l,d),r=(0,c.kM)(r,h),u=(0,c.kM)(u,v),{mode:o,directDistance:l,horizontalDistance:r,verticalDistance:u}}};(0,n.Cg)([(0,a.MZ)({constructOnly:!0})],_.prototype,"view",void 0),(0,n.Cg)([(0,a.MZ)({constructOnly:!0})],_.prototype,"analysis",void 0),(0,n.Cg)([(0,a.MZ)({constructOnly:!0})],_.prototype,"viewData",void 0),(0,n.Cg)([(0,a.MZ)({constructOnly:!0})],_.prototype,"geodesicLengthMeasurementUtils",void 0),(0,n.Cg)([(0,a.MZ)()],_.prototype,"_computedResult",null),_=(0,n.Cg)([(0,o.$)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],_);var m=i(89379),w=(i(11265),i(59784)),y=i(15941),b=i(11113),C=i(76931),f=i(19555),M=i(20664),P=i(9392),L=i(4244),A=i(66747),S=i(7256),V=i(88321),O=i(13191),E=i(43047),D=i(55855),z=i(75762),Z=i(32314),x=i(5101),R=i(71372),T=i(72017),H=i(34981),k=i(59696),G=i(45463),B=i(48549),j=i(16506),Q=i(59246),W=i(60322),q=i(90806),U=i(93345),I=i(57162);class N extends Q.w{constructor(t,e){super(t,e,new j.$(q.M,()=>i.e(9492).then(i.bind(i,59492))),F.locations),this.primitiveType=U.WR.TRIANGLE_STRIP}initializePipeline(t){return(0,I.Ey)({blending:t.transparent?(0,W.Yf)(t.oitPass):null,polygonOffset:t.polygonOffsetEnabled?{factor:0,units:-4}:null,depthTest:{func:513},depthWrite:I.Uy,colorWrite:I.kn})}}const F=(0,B.BP)().vec3f("position").vec3f("normal").vec2f("uv0").f32("length");var J=i(6485),$=i(92656);class X extends $.E{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1}}(0,n.Cg)([(0,J.W)()],X.prototype,"polygonOffsetEnabled",void 0),(0,n.Cg)([(0,J.W)()],X.prototype,"transparent",void 0);var Y=i(75569);class K extends G.i{constructor(t){super(t,et),this._configuration=new X,this.intersectDraped=void 0,this.produces=new Map([[2,t=>!this._transparent&&(0,H.RN)(t)],[8,t=>this._transparent&&(0,H.RN)(t)]])}getConfiguration(t,e){return super.getConfiguration(t,e,this._configuration),this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this._transparent,this._configuration.oitPass=e.oitPass,this._configuration}get visible(){const{outlineColor:t,stripeEvenColor:e,stripeOddColor:i}=this.parameters;return t[3]>=Y.Q||e[3]>=Y.Q||i[3]>=Y.Q}intersect(){}createGLMaterial(t){return new tt(t)}createBufferWriter(){return new ot}get _transparent(){const{parameters:t}=this;return t.outlineColor[3]<1||t.stripeEvenColor[3]<1||t.stripeOddColor[3]<1}}class tt extends k.A{beginSlot(t){return this.getTechnique(N,t)}}class et extends G.q{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=(0,D.fA)(1,.5,0,1),this.stripeEvenColor=(0,D.fA)(1,1,1,1),this.stripeOddColor=(0,D.fA)(1,.5,0,1),this.stripeLength=1,this.polygonOffset=!1}}const it=(0,P.vt)(),nt=(0,P.vt)(),st=(0,P.vt)(),at=(0,P.vt)(),rt=(0,P.vt)();class ot{constructor(){this.layout=F}elementCount(t){return 2*(t.get("position").indices.length/2+1)}write(t,e,i,n,s,a){const{data:r,indices:o}=i.get("position"),l=i.get("normal").data,u=r.length/3;o&&o.length!==2*(u-1)&&console.warn("MeasurementArrowMaterial does not support indices");const d=it,c=nt,h=st,g=at,v=rt,p=s.position,_=s.normal,m=s.uv0;let w=0;for(let b=0;b<u;++b){const i=3*b;if((0,M.j)(d,r[i],r[i+1],r[i+2]),b<u-1){const t=3*(b+1);(0,M.j)(c,r[t],r[t+1],r[t+2]),(0,M.j)(v,l[t],l[t+1],l[t+2]),(0,M.n)(v,v),(0,M.e)(h,c,d),(0,M.n)(h,h),(0,M.i)(g,v,h),(0,M.n)(g,g)}const n=(0,M.k)(d,c);t&&e&&((0,M.t)(d,d,t),(0,M.t)(c,c,t),(0,M.t)(g,g,e));const s=a+2*b,o=s+1;p.setVec(s,d),p.setVec(o,d),_.setVec(s,g),_.setVec(o,g),m.set(s,0,w),m.set(s,1,-1),m.set(o,0,w),m.set(o,1,1),b<u-1&&(w+=n)}const y=s.length;for(let b=0;b<2*u;++b)y.set(a+b,w);return null}}class lt extends Z.X{constructor(t){super(t),this._arrowWidth=16,this._arrowSubdivisions=128,this._origin=(0,P.vt)(),this._originTransform=(0,O.vt)(),this._arrowCenter=(0,P.vt)(),this._renderOccluded=4,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._color=(0,D.vt)(),this._contrastColor=(0,D.vt)(),this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){var e;t!==this._renderOccluded&&(this._renderOccluded=t,null===(e=this._arrowMaterial)||void 0===e||e.setParameters({renderOccluded:t}))}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(t){this._stripeLength=t,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(t){if(this._stripesEnabled=t,this.attached){const t=this._stripesEnabled?this._contrastColor:this._color;this._arrowMaterial.setParameters({stripeEvenColor:t})}}get color(){return this._color}set color(t){(0,w.we)(t,this._color)||((0,E.d)(this._color,t),this._updateArrowColor())}get contrastColor(){return this._contrastColor}set contrastColor(t){(0,w.we)(t,this._color)||((0,E.d)(this._contrastColor,t),this._updateArrowColor())}createExternalResources(){const t=this._color,e=this._contrastColor,i=this._stripesEnabled?e:t;this._arrowMaterial=new K({outlineColor:t,stripeEvenColor:i,stripeOddColor:t,renderOccluded:this.renderOccluded,polygonOffset:!0,isDecoration:this.isDecoration}),this._handles=new V.A,this._handles.add((0,h.wB)(()=>this.view.state.camera,()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null,this._handles=(0,s.pR)(this._handles)}forEachMaterial(t){t(this._arrowMaterial)}createGeometries(t){var e;if(null==(null===(e=this._geometry)||void 0===e?void 0:e.startRenderSpace)||null==this._geometry.endRenderSpace)return;const i=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);i.transformation=this._originTransform,t.addGeometry(i),this._viewChanged()}_createArrowGeometry(t,e,i,n){const s=this.view,a=s.renderCoordsHelper,r=[],o=[],l=(t,e)=>{const n=z.rq.get();(0,M.e)(n,t,i),r.push(n),o.push(e)};if("euclidean"===n.type){n.eval(.5,this._arrowCenter);const i=z.rq.get();if(a.worldUpAtPosition(this._arrowCenter,i),function(t,e,i){const n=(0,M.a)(ut,e,t),s=(0,M.i)(ut,n,i);return 0===(0,M.H)(s)}(t,e,i)){const{heading:e,tilt:n}=s.camera,{direction:a}=(0,x.ZC)(s,t,e,n,dt);(0,M.d)(i,a)}l(t,i),l(e,i)}else{n.eval(.5,this._arrowCenter);const t=this._arrowSubdivisions+1&-2;for(let e=0;e<t;++e){const i=e/(t-1),s=z.rq.get(),r=z.rq.get();n.eval(i,s),a.worldUpAtPosition(s,r),l(s,r)}}return(0,T.Z8)(this._arrowMaterial,r,o)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&null!=this._geometry){const t=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._arrowWidth*t})}}_updateArrowColor(){if(!this.attached)return;const t=this._color,e=this._contrastColor,i=this._stripesEnabled?e:t,n=t,s=t;this._arrowMaterial.setParameters({stripeEvenColor:i,outlineColor:n,stripeOddColor:s})}}const ut=(0,P.vt)(),dt=(0,R.NP)();var ct=i(47996),ht=i(25191),gt=i(35925),vt=i(90659),pt=i(38042),_t=i(63860);let mt=class extends d.A{get _parameters(){const t=this.view.effectiveTheme,{accentColor:e,textColor:i}=t,n=(0,w.QP)(e),s=(0,w.f6)(e,.75),a=(0,w.QP)((0,w.bJ)(e)),r=(0,w.bJ)(i,160);return{accentColor:n,contrastColor:a,translucentAccentColor:s,triangleLineWidth:3,geodesicProjectionLineWidth:2,guideLineWidth:2,guideStippleLengthPixels:3,directLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12,textColor:i,textBackgroundColor:(0,w._L)(r,.6),textCalloutColor:(0,w._L)(r,.5)}}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e}=this.analysisView;if(null==t||null==e||t.equals(e))return 0;const i=this.analysisView.result;if(null==i)return 1;if("geodesic"===this.actualVisualizedMeasurement)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?3:1;const{verticalDistance:n,horizontalDistance:s}=i,a=(0,c.kM)(n,"meters").value,r=(0,c.kM)(s,"meters").value;return Math.min(a/r,r/a)<this.triangleCollapseRatioThreshold?1:2}get actualVisualizedMeasurement(){const{measurementMode:t,result:e}=this.analysisView;switch(t){case 0:return null!=e&&(0,c.kM)(e.horizontalDistance,"meters").value>vt.U7?"geodesic":"euclidean";case 1:return"euclidean";case 2:return"geodesic"}}get allowVisualElementsOrientationChange(){return null==this._triangleOrientationOverride}set allowVisualElementsOrientationChange(t){null==this._triangleOrientationOverride!==t&&(null==this._triangleOrientationOverride?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){return"geodesic"===this.actualVisualizedMeasurement?{direct:null,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}constructor(t){super(t),this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,P.vt)(),this._endPosition=(0,P.vt)(),this._cornerPosition=(0,P.vt)(),this._startPositionAtSeaLevel=(0,P.vt)(),this._endPositionAtSeaLevel=(0,P.vt)(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=0,this.triangleCollapseRatioThreshold=.03}initialize(){const t={attached:!0,view:this.view,isDecoration:!0},{guideLineWidth:e,guideStippleLengthPixels:i,triangleLineWidth:n,geodesicProjectionLineWidth:s,directLabelFontSize:a,verticalLabelFontSize:r,horizontalLabelFontSize:o}=this._parameters;this._segmentVisualElement=new lt((0,m.A)((0,m.A)({},t),{},{geometry:null,renderOccluded:4})),this._triangleVisualElement=new S.t((0,m.A)((0,m.A)({},t),{},{width:n,renderOccluded:4})),this._rightAngleQuad=new ct.n((0,m.A)((0,m.A)({},t),{},{renderOccluded:4}));const l=(0,m.A)((0,m.A)({},t),{},{polygonOffset:!0,renderOccluded:4});this._projectedGeodesicLine=new S.t((0,m.A)((0,m.A)({},l),{},{width:s,stipplePattern:(0,gt.wk)(i)})),this._geodesicStartHint=new S.t((0,m.A)((0,m.A)({},l),{},{width:e,stipplePattern:(0,gt.wk)(i)})),this._geodesicEndHint=new S.t((0,m.A)((0,m.A)({},l),{},{width:e,stipplePattern:(0,gt.wk)(i)})),this._segmentLabel=new A.N((0,m.A)((0,m.A)({},t),{},{fontSize:a})),this._verticalLabel=new A.N((0,m.A)((0,m.A)({},t),{},{fontSize:r})),this._horizontalLabel=new A.N((0,m.A)((0,m.A)({},t),{},{fontSize:o})),this.addHandles([(0,h.wB)(()=>{const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e}=this.analysisView,i=this.view;return{view:i,camera:i.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},t=>this._updateGeometryAndViewMode(t),h.pc),(0,h.wB)(()=>({visible:this.visible,viewMode:this.viewMode}),t=>this._updateVisualElementVisibility(t),h.pc),(0,h.wB)(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),t=>this._updateLabelText(t),h.pc),(0,h.wB)(()=>({visible:this.visible,viewMode:this.viewMode}),t=>this._updateLabelVisibility(t),h.pc),(0,h.wB)(()=>this._measurementArrowStripeLength,t=>this._updateSegmentStripeLength(t),h.pc),(0,pt.oQ)(()=>this._updateMessageBundle()),(0,h.wB)(()=>this._parameters,t=>{let{textBackgroundColor:e,textCalloutColor:i,textColor:n,translucentAccentColor:s,accentColor:a,contrastColor:r}=t;const{_segmentLabel:o,_verticalLabel:l,_horizontalLabel:u,_triangleVisualElement:d,_rightAngleQuad:c,_projectedGeodesicLine:h,_geodesicStartHint:g,_geodesicEndHint:v,_segmentVisualElement:p}=this;o.backgroundColor=e,o.calloutColor=i,o.textColor=n,l.backgroundColor=e,l.calloutColor=i,l.textColor=n,u.backgroundColor=e,u.calloutColor=i,u.textColor=n,d.color=s,c.color=s,h.color=s,g.color=s,v.color=s,p.color=a,p.contrastColor=r},h.Vh)]),this._updateMessageBundle()}destroy(){this._segmentVisualElement=(0,s.pR)(this._segmentVisualElement),this._triangleVisualElement=(0,s.pR)(this._triangleVisualElement),this._rightAngleQuad=(0,s.pR)(this._rightAngleQuad),this._projectedGeodesicLine=(0,s.pR)(this._projectedGeodesicLine),this._geodesicStartHint=(0,s.pR)(this._geodesicStartHint),this._geodesicEndHint=(0,s.pR)(this._geodesicEndHint),this._segmentLabel=(0,s.pR)(this._segmentLabel),this._verticalLabel=(0,s.pR)(this._verticalLabel),this._horizontalLabel=(0,s.pR)(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility(t){let{visible:e,viewMode:i}=t;if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,e)switch(i){case 0:break;case 1:this._segmentVisualElement.visible=!0;break;case 2:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case 3:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode(t){let{view:e,camera:i,viewMode:n,elevationAlignedStartPoint:s,elevationAlignedEndPoint:a,orientation:r,visualizedMeasurement:o,stripeLength:l}=t;const u=e.renderCoordsHelper;if(null==u||null==s||null==a||s.equals(a))return;let d=this._startPosition,c=this._endPosition;u.toRenderCoords(s,d),u.toRenderCoords(a,c);const h=1===r?1:-1,g=h*(u.getAltitude(c)-u.getAltitude(d));g<0&&(d=this._endPosition,c=this._startPosition);const v="geodesic"===o?new ht.J(this._startPosition,this._endPosition,u.spatialReference):new ht.C(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=v,this._updateSegmentStripeLength(l),n){case 1:this._updateSegment(v,r);break;case 2:this._updateSegmentAndTriangle({view:e,camera:i,segment:v,orientation:r,startPosition:d,endPosition:c,deltaSign:h,altitudeDelta:g});break;case 3:this._updateSegmentAndProjection({view:e,orientation:r,startPosition:d,endPosition:c})}}_updateSegment(t,e){this._segmentLabel.anchor=1===e?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:t,sampleLocation:"center"}}_updateSegmentAndTriangle(t){let{view:{renderCoordsHelper:e},camera:i,segment:n,orientation:s,startPosition:a,endPosition:r,deltaSign:o,altitudeDelta:l}=t;const u=this._cornerPosition;e.worldUpAtPosition(a,u),(0,M.h)(u,u,o*Math.abs(l)),(0,M.g)(u,u,a),this._triangleVisualElement.geometry=[[[a[0],a[1],a[2]],[u[0],u[1],u[2]],[r[0],r[1],r[2]]]],this._rightAngleQuad.geometry={previous:a,center:u,next:r};const d=new ht.C(a,u),c=new ht.C(u,r),h=function(t,e,i,n,s){const a=(0,L.Q)(t,i,s,Ct),r=(0,L.Q)(t,e,s,ft);if(null==a||null==r)return null;const o=s.projectToRenderScreen(i,yt),l=s.projectToRenderScreen(e,bt),u={segment:"bottom",horizontal:"top",vertical:null==o||null==l||o[0]<l[0]?"left":"right"};if((0,f.Om)(a,r)>=wt){const t=Math.sign(a[1])===Math.sign(r[1]);u.segment=t?(0,A.R)(u.vertical):u.vertical}else{const t=Mt;(0,L.Q)(i,e,s,t),(0,f.Om)(t,r)>=wt&&(u.segment=Math.sign(t[0])===Math.sign(r[0])?(0,A.R)(u.horizontal):u.horizontal)}if(2===n){const t=t=>"top"===t?"bottom":"top";u.segment=t(u.segment),u.horizontal=t(u.horizontal),u.vertical=t(u.vertical)}return u}(a,r,u,s,i);h&&(this._segmentLabel.anchor=h.segment,this._segmentLabel.geometry={type:"segment",segment:n,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:d,sampleLocation:"center"},this._verticalLabel.anchor=h.vertical,this._horizontalLabel.geometry={type:"segment",segment:c,sampleLocation:"center"},this._horizontalLabel.anchor=h.horizontal)}_updateSegmentAndProjection(t){let{view:{renderCoordsHelper:e},orientation:i,startPosition:n,endPosition:s}=t;e.setAltitude(this._startPositionAtSeaLevel,0,n),e.setAltitude(this._endPositionAtSeaLevel,0,s);const a=new ht.J(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,e.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(a),this._geodesicStartHint.setGeometryFromSegment(new ht.C(this._startPositionAtSeaLevel,n)),this._geodesicEndHint.setGeometryFromSegment(new ht.C(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:a,sampleLocation:"center"},this._segmentLabel.anchor=1===i?"top":"bottom"}_updateLabelText(t){let{text:e,visualizedMeasurement:i}=t;null!=e?(this._segmentLabel.text="euclidean"===i?e.directDistance:e.horizontalDistance,this._horizontalLabel.text=e.horizontalDistance,this._verticalLabel.text=e.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility(t){let{visible:e,viewMode:i}=t;const n=this._segmentLabel,s=this._horizontalLabel,a=this._verticalLabel;if(n.visible=!1,s.visible=!1,a.visible=!1,e)switch(i){case 1:case 3:n.visible=!0;break;case 2:n.visible=!0,s.visible=!0,a.visible=!0}}get _labelsText(){if(this.destroyed)return null;const t=this.messages,e=this.analysisView.result;if(null==e||null==t)return null;const{directDistance:i,horizontalDistance:n,verticalDistance:s}=e,a=this.analysisView.unit,r=t=>(0,m.A)({directDistance:"",horizontalDistance:"",verticalDistance:""},t);switch(a){case"metric":return r({directDistance:i&&(0,b.Ee)(t,i),horizontalDistance:n&&(0,b.Ee)(t,n),verticalDistance:s&&(0,b.W4)(t,s)});case"imperial":return r({directDistance:i&&(0,b.tr)(t,i),horizontalDistance:n&&(0,b.tr)(t,n),verticalDistance:s&&(0,b.t_)(t,s)});default:return r({directDistance:i&&(0,b.zJ)(t,i,a),horizontalDistance:n&&(0,b.zJ)(t,n,a),verticalDistance:s&&(0,b.zJ)(t,s,a)})}}_updateSegmentStripeLength(t){const e=this._segmentVisualElement;null!=t?(e.stripeLength=t,e.stripesEnabled=!0):e.stripesEnabled=!1}get _actualVisualElementsOrientation(){if(null!=this._triangleOrientationOverride)return this._triangleOrientationOverride;const t=this.visualElementOrientation;return 0===t?this.view.state.camera.aboveGround?1:2:t}_requiresGeodesicGuideAt(t){const e=this.view;if(null===e||void 0===e||!e.state)return!1;const i=e.state.camera,n=e.renderCoordsHelper;if(!n)return!1;const s=i.computeScreenPixelSizeAt(t);return n.getAltitude(t)/s>=10}get _measurementArrowStripeLength(){const{result:t,unit:e}=this.analysisView;if(null==t)return null;let i=null;const n=t.directDistance;switch(e){case"metric":i=n&&(0,c.kM)(n,"meters");break;case"imperial":i=n&&(0,c.kM)(n,(0,g.OU)(n.value,n.unit));break;default:i=n&&(0,c.kM)(n,e)}return null==i?null:(0,y.Vr)(i.value/30)*(0,g.oU)(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,_t.ud)("esri/core/t9n/Units").then(t=>{this.messages=t}).finally(()=>{this.loadingMessages=!1})}get testData(){}};(0,n.Cg)([(0,a.MZ)()],mt.prototype,"_parameters",null),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"_triangleOrientationOverride",void 0),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"messages",void 0),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"view",void 0),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"analysis",void 0),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"analysisView",void 0),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"loadingMessages",void 0),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"visible",null),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"viewMode",null),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"actualVisualizedMeasurement",null),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"visualElementOrientation",void 0),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"triangleCollapseRatioThreshold",void 0),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"allowVisualElementsOrientationChange",null),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"labels",null),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"_labelsText",null),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"_actualVisualElementsOrientation",null),(0,n.Cg)([(0,a.MZ)()],mt.prototype,"_measurementArrowStripeLength",null),mt=(0,n.Cg)([(0,o.$)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],mt);const wt=Math.cos((0,y.kU)(12)),yt=(0,C.r_)(),bt=(0,C.r_)(),Ct=(0,C.QG)(),ft=(0,C.QG)(),Mt=(0,C.QG)();var Pt=i(56002),Lt=i(19451),At=i(19247),St=i(32535),Vt=i(77515),Ot=i(70836),Et=i(7947),Dt=i(69539),zt=i(44230),Zt=i(56121),xt=i(38317),Rt=i(91175),Tt=i(1307);let Ht=class extends d.A{constructor(t){super(t),this.cursorPoint=null,this._visible=!1,this._laserLine=null,this.laserLineEnabled=!0,this._lastDraggedHandle=null}initialize(){this._laserLine=new Tt.o({view:this.view,attached:!0,isDecoration:!0}),this._updateVisibility(this._visible),this._connectToAnalysisView(),this.addHandles((0,h.wB)(()=>this._params,t=>{let{laserLineGlowColor:e,laserLineInnerColor:i,laserLineGlobalAlpha:n}=t;const s=this._laserLine,a=s.style;s.style=(0,m.A)((0,m.A)({},a),{},{innerColor:i,glowColor:e,globalAlpha:n})}))}destroy(){this._laserLine=(0,s.pR)(this._laserLine)}get _params(){const{accentColor:t}=this.view.effectiveTheme;return{laserLineGlowColor:Dt.A.toUnitRGB(t),laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:Dt.A.toUnitRGB((0,w.bJ)(t)),laserLineInnerWidth:.75,laserLineGlobalAlpha:.75*t.a,handleColor:(0,w.f6)(t,.5),handleRadius:5}}get visible(){return this._visible}set visible(t){t?this.show():this.hide()}get testData(){}get _cursorPosition(){const t=(0,P.vt)(),e=this.cursorPoint;return e&&this.view.renderCoordsHelper.toRenderCoords(e,t),t}get _startPosition(){const t=(0,P.vt)(),e=this.analysis.startPoint;return e&&this.view.renderCoordsHelper.toRenderCoords(e,t),t}get _endPosition(){const t=(0,P.vt)(),e=this.analysis.endPoint;return e&&this.view.renderCoordsHelper.toRenderCoords(e,t),t}get _laserLineParams(){const t=this._focusPosition,{active:e,lineState:i}=this.toolState,n=this.analysisViewData,s=this.laserLineEnabled&&!!t&&"measured"!==i&&e;if(!s||!this.visible||null==n||n.destroyed)return{heightManifoldTarget:null,pointDistanceLine:null,lineVerticalPlaneSegment:null};const a=n.actualVisualizedMeasurement,r="local"!==this.view.viewingMode&&s&&!!this.analysis.startPoint&&"geodesic"===a,o=s&&2===n.viewMode;return{heightManifoldTarget:"euclidean"===a?t:null,pointDistanceLine:r?this._pointDistanceLine:null,lineVerticalPlaneSegment:o?(0,zt.Cr)(this._startPosition,this._endPosition):null}}get _focusPosition(){const{lineState:t}=this.toolState,e=this.analysisViewData,i=null!=e&&!e.destroyed&&1===e.measurementMode&&1===e.viewMode;switch(t){case"drawing":return i?this._startPosition:this.analysis.endPoint?this._endPosition:this._startPosition;case"editing":return i?"start"===this._lastDraggedHandle?this._endPosition:this._startPosition:"start"===this._lastDraggedHandle?this._startPosition:this._endPosition;default:return null!=this.cursorPoint?this._cursorPosition:null}}get _pointDistanceLine(){return{origin:"drawing"===this.toolState.lineState||"end"===this._lastDraggedHandle?this._startPosition:this._endPosition,target:this._focusPosition}}createManipulators(){const t=this._params,{view:e}=this,i=()=>{const i=(0,xt.UM)(t.handleColor),n=[new Rt.M((0,T.CM)(i,1,32,32))],s=new Zt.q({view:e,renderObjects:n});return s.available=!1,s.radius=t.handleRadius,[s,i]},[n,s]=i(),[a,r]=i(),o=new Zt.q({view:this.view,available:!1,interactive:!1});null!=this.analysis.startPoint&&(n.location=this.analysis.startPoint,n.available=!0),null!=this.analysis.endPoint&&(a.location=this.analysis.endPoint,a.available=!0);const l=()=>{let t=this._lastDraggedHandle;n.grabbing&&!a.grabbing&&(t="start"),a.grabbing&&!n.grabbing&&(t="end"),n.grabbing||a.grabbing||(t=null),this._lastDraggedHandle=t},u=n.events.on("grab-changed",l),d=a.events.on("grab-changed",l);return this.addHandles([u,d,(0,h.wB)(()=>(0,w.pf)(this._params.handleColor),t=>{s.setParameters({color:t}),r.setParameters({color:t})},{equals:w.we})],"manipulators"),{start:n,end:a,cursor:o}}show(){this.destroyed||this._visible||this._updateVisibility(!0)}hide(){!this.destroyed&&this._visible&&this._updateVisibility(!1)}_connectToAnalysisView(){this.removeHandles("analysis-view"),this.addHandles([(0,h.wB)(()=>{var t;return null===(t=this.analysisViewData)||void 0===t?void 0:t.destroyed},t=>{t&&this.removeHandles("analysis-view")},h.Vh),(0,h.wB)(()=>["measured"===this.toolState.lineState,this.analysisViewData],t=>{let[e,i]=t;null==i||i.destroyed||(i.allowVisualElementsOrientationChange=!e)},h.Vh),(0,h.wB)(()=>this._laserLineParams,t=>{const e=this._laserLine;e.heightManifoldTarget=t.heightManifoldTarget,e.pointDistanceLine=t.pointDistanceLine,e.lineVerticalPlaneSegment=t.lineVerticalPlaneSegment},h.Vh)],"analysis-view")}_updateVisibility(t){this.initialized&&(this._visible=t,t&&(this._laserLine.style={innerColor:this._params.laserLineInnerColor,innerWidth:this._params.laserLineInnerWidth,glowColor:this._params.laserLineGlowColor,glowWidth:this._params.laserLineGlowWidth,glowFalloff:this._params.laserLineGlowFalloff,globalAlpha:this._params.laserLineGlobalAlpha}),this._laserLine.visible=t)}};(0,n.Cg)([(0,a.MZ)({constructOnly:!0})],Ht.prototype,"view",void 0),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"_params",null),(0,n.Cg)([(0,a.MZ)({constructOnly:!0})],Ht.prototype,"analysis",void 0),(0,n.Cg)([(0,a.MZ)({constructOnly:!0})],Ht.prototype,"analysisViewData",void 0),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"cursorPoint",void 0),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"toolState",void 0),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"visible",null),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"testData",null),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"_visible",void 0),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"_laserLine",void 0),(0,n.Cg)([(0,a.MZ)({constructOnly:!0})],Ht.prototype,"laserLineEnabled",void 0),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"_cursorPosition",null),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"_startPosition",null),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"_endPosition",null),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"_lastDraggedHandle",void 0),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"_laserLineParams",null),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"_focusPosition",null),(0,n.Cg)([(0,a.MZ)()],Ht.prototype,"_pointDistanceLine",null),Ht=(0,n.Cg)([(0,o.$)("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DView")],Ht);var kt=i(80935),Gt=i(5109),Bt=i(89238),jt=i(17046),Qt=i(974),Wt=i(56497),qt=i(13284),Ut=i(61237),It=i(75218),Nt=i(70330),Ft=i(11500);let Jt=class extends Gt.k{constructor(t){super(t),this._updatingHandles=new Lt.U,this._snappingManagerResult=null,this._emulatedDrag=null,this.lineState="initial",this.removeIncompleteOnCancel=!1,this.startPointSurfaceLocation=null,this.endPointSurfaceLocation=null,this.cursorPointSurfaceLocation=null,this.startManipulator=null,this.endManipulator=null,this.cursorManipulator=null,this._getSnappingContext=(0,Pt.B)(t=>new qt.e({elevationInfo:{mode:"absolute-height",offset:0},pointer:t,editGeometryOperations:new Wt.p(new Qt.ZE("point",(0,Bt.BV)(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new Ot.s}))}initialize(){const{view:t,analysis:e,analysisViewData:i,visible:n}=this;this.measurementView=new Ht({toolState:this,view:t,analysis:e,analysisViewData:i,visible:n});const{start:s,end:a,cursor:r}=this.measurementView.createManipulators(),o=(t,e,i)=>{const n=(0,jt.Xt)(t,(t,n,s,a)=>{const r=(0,Et.z7)(t),o=this._ensureSnappingManager(),l=this._getSnappingContext(a),u=this._updatingHandles,{lineState:d}=this;s=s.next(r).next((0,jt.VG)(this,[i,e])).next(i=>{if("cursorPoint"!==e){const i=this.analysis[e];null!=i&&(t.location=i)}return i});const c=(0,Et.xk)(this.view);let h=n.next(r).next(t=>{const n=c(t);return n||"drawing"!==this.lineState&&"initial"!==this.lineState||(this[e]=null,this[i]=null),n});if("touch"!==a||"editing"===d){const{snappingStep:t,cancelSnapping:e}=(0,Ut.L)({snappingManager:o,snappingContext:l,updatingHandles:u});s=s.next(e),h=h.next(...t)}h.next(t=>"start"!==t.action?t:null).next(n=>{const s=(0,St.EL)(n.mapEnd,new At.A);this[e]=s,t.location=s,this[i]=this._surfaceLocation(s,n.surfaceType)})});return"cursorPoint"===e?[n]:[n,t.events.on("grab-changed",()=>{const t=s.grabbing||a.grabbing;this.lineState=t?"editing":"measured"}),(0,h.wB)(()=>this.analysis[e],e=>{e&&(t.location=e)})]};this.startManipulator=s,this.endManipulator=a,this.cursorManipulator=r,this.manipulators.add(s),this.manipulators.add(a),this.manipulators.add(r),this.addHandles([...o(s,"startPoint","startPointSurfaceLocation"),...o(a,"endPoint","endPointSurfaceLocation"),...o(r,"cursorPoint","cursorPointSurfaceLocation"),(0,h.z7)(()=>"measured"===this.state,()=>{this.finishToolCreation(),this.active&&(this.view.activeTool=null)},h.pc),(0,h.wB)(()=>({startPointAvailable:null!=this.startPoint,endPointAvailable:null!=this.endPoint}),t=>{let{startPointAvailable:e,endPointAvailable:i}=t;this.startManipulator.available=e,this.endManipulator.available=i},h.pc)]),(0,Nt.BY)(this)}destroy(){this._updatingHandles=(0,s.pR)(this._updatingHandles),this.measurementView=(0,s.pR)(this.measurementView)}get _snappingManager(){var t;return null===(t=this._snappingManagerResult)||void 0===t?void 0:t.snappingManager}_ensureSnappingManager(){if(null==this._snappingManagerResult){const t=(0,It.X)(this.view);this._snappingManagerResult=t,this.addHandles(t)}return this._snappingManagerResult.snappingManager}get state(){const{analysis:t}=this;if(null==t.startPoint&&null==t.endPoint)return"ready";const{lineState:e}=this;return this.validMeasurement&&"editing"!==e&&"drawing"!==e?"measured":"measuring"}get cursor(){return!this.active||"ready"!==this.state&&"measured"===this.lineState?null:"crosshair"}get startPoint(){return this.analysis.startPoint}set startPoint(t){this.analysis.startPoint=t}get endPoint(){return this.analysis.endPoint}set endPoint(t){this.analysis.endPoint=t}get cursorPoint(){return this.measurementView.cursorPoint}set cursorPoint(t){this.measurementView.cursorPoint=t}get snappingOptions(){var t;return null===(t=this._snappingManager)||void 0===t?void 0:t.options}get validMeasurement(){return null!=this.analysis.startPoint&&null!=this.analysis.endPoint}get updating(){var t;return this._updatingHandles.updating||!(null===(t=this._snappingManager)||void 0===t||!t.updating)}resetCreated(){super.resetCreated(),this.lineState="initial",this.cursorPoint=null,"measured"===this.state&&this.finishToolCreation()}onShow(){this.measurementView.show()}onHide(){this.measurementView.hide()}onDeactivate(){var t;null!==(t=this._emulatedDrag)&&void 0!==t&&t.cancel(),this._emulatedDrag=null}onInputEvent(t){switch(t.type){case"immediate-click":this._handleImmediateClick(t);break;case"pointer-move":this._handlePointerMove(t)}}_handlePointerMove(t){var e,i;if(!this.active||this.view.navigating)return;const{pointerType:n}=t;if("mouse"!==n)return;const s=(0,Ft.ZV)(t),{lineState:a,cursorManipulator:r,endManipulator:o}=this;let l=!1;null==this.cursorPoint&&(null!==(e=this._emulatedDrag)&&void 0!==e&&e.cancel(),this._emulatedDrag=$t(r,n,s),l=!0),"initial"===a&&(null!==(i=this._emulatedDrag)&&void 0!==i&&i.update(s),l=!0),"drawing"===a&&(o.events.emit("drag",{action:"update",start:s,screenPoint:s}),l=!0),l&&t.stopPropagation()}_handleImmediateClick(t){var e,i,n,s;if(!this.active||!(0,Vt.s7)(t))return;const a=(0,Ft.ZV)(t),{pointerType:r}=t,{cursorManipulator:o,startManipulator:l,endManipulator:u,lineState:d}=this;let c=!1;switch(null==this.cursorPoint&&(null!==(e=this._emulatedDrag)&&void 0!==e&&e.cancel(),this._emulatedDrag=$t(o,r,a)),d){case"initial":if(null!==(i=this._emulatedDrag)&&void 0!==i&&i.update(a),null!=this.cursorPoint){var h;null!==(h=this._emulatedDrag)&&void 0!==h&&h.end(a),this._emulatedDrag=null,this.endPoint=null;const{cursorPoint:t}=this;this.startPoint=t,this.startPointSurfaceLocation=this.cursorPointSurfaceLocation,l.location=t,l.interactive=!1,u.interactive=!1,this.lineState="drawing",this._emulatedDrag=$t(u,r,a),c=!0}break;case"drawing":null!==(n=this._emulatedDrag)&&void 0!==n&&n.update(a),null!=this.endPoint&&(null!==(s=this._emulatedDrag)&&void 0!==s&&s.end(a),this._emulatedDrag=null,l.interactive=!0,u.interactive=!0,this.lineState="measured",c=!0)}c&&t.stopPropagation()}_surfaceLocation(t,e){var i;return 0===e?"on-the-surface":(null!==(i=t.z)&&void 0!==i?i:0)>=this._getElevation(t)?"above-the-surface":"below-the-surface"}_getElevation(t){var e;return this.view.basemapTerrain.ready&&null!==(e=(0,kt.R1)(this.view.elevationProvider,t))&&void 0!==e?e:0}get test(){}};function $t(t,e,i){return t.events.emit("drag",{action:"start",pointerType:e,start:i,screenPoint:i}),{update:e=>t.events.emit("drag",{action:"update",start:e,screenPoint:e}),end:e=>t.events.emit("drag",{action:"end",start:e,screenPoint:e}),cancel:()=>t.events.emit("drag",{action:"cancel"})}}(0,n.Cg)([(0,a.MZ)()],Jt.prototype,"_snappingManagerResult",void 0),(0,n.Cg)([(0,a.MZ)()],Jt.prototype,"_snappingManager",null),(0,n.Cg)([(0,a.MZ)({readOnly:!0})],Jt.prototype,"state",null),(0,n.Cg)([(0,a.MZ)()],Jt.prototype,"lineState",void 0),(0,n.Cg)([(0,a.MZ)({readOnly:!0})],Jt.prototype,"cursor",null),(0,n.Cg)([(0,a.MZ)()],Jt.prototype,"startPoint",null),(0,n.Cg)([(0,a.MZ)()],Jt.prototype,"endPoint",null),(0,n.Cg)([(0,a.MZ)()],Jt.prototype,"cursorPoint",null),(0,n.Cg)([(0,a.MZ)({constructOnly:!0})],Jt.prototype,"analysis",void 0),(0,n.Cg)([(0,a.MZ)({constructOnly:!0})],Jt.prototype,"analysisViewData",void 0),(0,n.Cg)([(0,a.MZ)()],Jt.prototype,"measurementView",void 0),(0,n.Cg)([(0,a.MZ)()],Jt.prototype,"removeIncompleteOnCancel",void 0),(0,n.Cg)([(0,a.MZ)({constructOnly:!0})],Jt.prototype,"view",void 0),(0,n.Cg)([(0,a.MZ)({readOnly:!0})],Jt.prototype,"validMeasurement",null),(0,n.Cg)([(0,a.MZ)({value:null})],Jt.prototype,"startPointSurfaceLocation",void 0),(0,n.Cg)([(0,a.MZ)({value:null})],Jt.prototype,"endPointSurfaceLocation",void 0),(0,n.Cg)([(0,a.MZ)({value:null})],Jt.prototype,"cursorPointSurfaceLocation",void 0),(0,n.Cg)([(0,a.MZ)()],Jt.prototype,"updating",null),Jt=(0,n.Cg)([(0,o.$)("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DTool")],Jt);var Xt=i(10260),Yt=i(23739);let Kt=class extends u.P{constructor(t){super(t),this.type="direct-line-measurement-view-3d",this.analysis=null,this.tool=null,this.result=null,this.measurementMode=0,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null,this.userOperation=null}initialize(){const{analysis:t,view:e}=this;this._analysisVisualization=new mt({view:e,analysis:t,analysisView:this}),this.addResolvingPromise((0,Yt.V)().then(i=>{this.destroyed||(this._analysisController=new _({view:e,analysis:t,viewData:this,geodesicLengthMeasurementUtils:i}))})),this.addHandles((0,Xt.Hd)(this,Jt))}destroy(){(0,Xt.aS)(this),this.userOperation=(0,s.DC)(this.userOperation),this._analysisController=(0,s.pR)(this._analysisController),this._analysisVisualization=(0,s.pR)(this._analysisVisualization)}get updating(){var t;return!(null===(t=this._analysisVisualization)||void 0===t||!t.loadingMessages)}get visible(){return super.visible}set visible(t){super.visible=t}get interactive(){return super.interactive}set interactive(t){super.interactive=t}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(t){this._analysisVisualization.visualElementOrientation=t}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(t){this._analysisVisualization.allowVisualElementsOrientationChange=t}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(t){this._analysisVisualization.triangleCollapseRatioThreshold=t}get directLabelText(){var t,e;return null!==(t=null===(e=this._analysisVisualization.labels.direct)||void 0===e?void 0:e.text)&&void 0!==t?t:""}get horizontalLabelText(){var t,e;return null!==(t=null===(e=this._analysisVisualization.labels.horizontal)||void 0===e?void 0:e.text)&&void 0!==t?t:""}get verticalLabelText(){var t,e;return null!==(t=null===(e=this._analysisVisualization.labels.vertical)||void 0===e?void 0:e.text)&&void 0!==t?t:""}get unit(){var t;return null!==(t=this.analysis.unit)&&void 0!==t?t:(0,l.c)(this.view)}get testData(){}place(t){return(0,Xt.ZX)(this,{placementOptions:t})}};(0,n.Cg)([(0,a.MZ)()],Kt.prototype,"_analysisVisualization",void 0),(0,n.Cg)([(0,a.MZ)()],Kt.prototype,"_analysisController",void 0),(0,n.Cg)([(0,a.MZ)()],Kt.prototype,"updating",null),(0,n.Cg)([(0,a.MZ)({readOnly:!0})],Kt.prototype,"type",void 0),(0,n.Cg)([(0,a.MZ)({constructOnly:!0,nonNullable:!0})],Kt.prototype,"analysis",void 0),(0,n.Cg)([(0,a.MZ)()],Kt.prototype,"tool",void 0),(0,n.Cg)([(0,a.MZ)()],Kt.prototype,"result",void 0),(0,n.Cg)([(0,a.MZ)()],Kt.prototype,"measurementMode",void 0),(0,n.Cg)([(0,a.MZ)()],Kt.prototype,"elevationAlignedStartPoint",void 0),(0,n.Cg)([(0,a.MZ)()],Kt.prototype,"elevationAlignedEndPoint",void 0),(0,n.Cg)([(0,a.MZ)({readOnly:!0})],Kt.prototype,"viewMode",null),(0,n.Cg)([(0,a.MZ)({readOnly:!0})],Kt.prototype,"actualVisualizedMeasurement",null),(0,n.Cg)([(0,a.MZ)()],Kt.prototype,"visualElementOrientation",null),(0,n.Cg)([(0,a.MZ)()],Kt.prototype,"allowVisualElementsOrientationChange",null),(0,n.Cg)([(0,a.MZ)()],Kt.prototype,"triangleCollapseRatioThreshold",null),(0,n.Cg)([(0,a.MZ)({readOnly:!0})],Kt.prototype,"directLabelText",null),(0,n.Cg)([(0,a.MZ)({readOnly:!0})],Kt.prototype,"horizontalLabelText",null),(0,n.Cg)([(0,a.MZ)({readOnly:!0})],Kt.prototype,"verticalLabelText",null),(0,n.Cg)([(0,a.MZ)()],Kt.prototype,"unit",null),(0,n.Cg)([(0,a.MZ)()],Kt.prototype,"userOperation",void 0),Kt=(0,n.Cg)([(0,o.$)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],Kt);const te=Kt},75218:(t,e,i)=>{i.d(e,{X:()=>u});var n=i(89379),s=i(54901),a=i(77944),r=i(18295),o=i(64344);const l=new Map;function u(t){if(!l.has(t)){const e=(0,r.B)(t,{distance:10}),i=function(t,e){return new o.g({view:t,options:e})}(t,e.options);l.set(t,{referenceCount:0,snappingManager:i,remove:()=>{e.remove(),i.destroy()}})}const e=l.get(t);e.referenceCount++;const i=(0,s.hA)(()=>{return i=t,(n=e).referenceCount--,void(n.referenceCount>0||(0,a.d)(()=>{0===n.referenceCount&&(n.remove(),l.delete(i))}));var i,n});return(0,n.A)({snappingManager:e.snappingManager},i)}},77515:(t,e,i)=>{i.d(e,{CL:()=>c,Gc:()=>g,OK:()=>d,s7:()=>v,uc:()=>l,zS:()=>h});var n=i(20664),s=i(9392),a=i(65215),r=i(78315),o=i(94966);function l(t,e){const i=(0,n.j)(u,0,0,0);for(let a=0;a<t.length;++a)(0,n.g)(i,i,t[a]);(0,n.h)(i,i,1/t.length);let s=0;for(let a=0;a<t.length;++a)s=Math.max(s,(0,n.s)(i,t[a]));(0,r.e)(e,i,Math.sqrt(s))}const u=(0,s.vt)();function d(t,e){if(t.length<3)throw new Error("need at least 3 points to fit a plane");(0,o.e9)(t[0],t[1],t[2],e)}function c(t,e){return(0,n.f)(t,e)+t[3]}function h(t,e,i,s,a){let{geodesicArea:r}=a;const o=p;return(0,n.d)(o.rings[0][0],t),(0,n.d)(o.rings[0][1],e),(0,n.d)(o.rings[0][2],i),(0,n.d)(o.rings[0][3],t),o.spatialReference=s,o.clearCache(),r(o)}function g(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=(t,e)=>{if(0===e[0]&&0===e[1]&&0===e[2])return!1;for(let i=0;i<t.length;++i)if((0,n.f)(e,t[i])<-1e-6)return!1;return!0};if(0===t.length)return!1;if(1===t.length)return e&&(0,n.d)(e,t[0]),!0;(0,n.j)(_,0,0,0);for(let a=0;a<t.length;++a)(0,n.g)(_,_,t[a]);if((0,n.n)(_,_),s(t,_))return e&&(0,n.d)(e,_),!0;if(!i)return!1;for(let a=0;a<t.length;++a)for(let i=0;i<t.length;++i)if(a!==i&&((0,n.i)(_,t[a],t[i]),(0,n.n)(_,_),s(t,_)))return e&&(0,n.d)(e,_),!0;return!1}function v(t){return"mouse"!==t.pointerType||0===t.button}const p=new a.A({hasM:!1,hasZ:!0,rings:[[(0,s.vt)(),(0,s.vt)(),(0,s.vt)(),(0,s.vt)()]],spatialReference:null}),_=(0,s.vt)()},90806:(t,e,i)=>{i.d(e,{M:()=>v,b:()=>g});var n,s,a,r=i(57528),o=i(3799),l=i(58350),u=i(21390),d=i(86955),c=i(2687),h=i(75569);function g(t){const e=new c.N5,{vertex:i,fragment:g}=e;(0,o.NB)(i,t),i.uniforms.add(new u.m("width",t=>t.width)),e.attributes.add("position","vec3"),e.attributes.add("normal","vec3"),e.attributes.add("uv0","vec2"),e.attributes.add("length","float"),e.varyings.add("vtc","vec2"),e.varyings.add("vlength","float"),e.varyings.add("vradius","float"),i.main.add((0,d.H)(n||(n=(0,r.A)(["vec3 bitangent = normal;\nvtc = uv0;\nvlength = length;\nvradius = 0.5 * width;\nvec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);\ngl_Position = proj * pos;"])))),g.uniforms.add(new u.m("outlineSize",t=>t.outlineSize),new l.E("outlineColor",t=>t.outlineColor),new u.m("stripeLength",t=>t.stripeLength),new l.E("stripeEvenColor",t=>t.stripeEvenColor),new l.E("stripeOddColor",t=>t.stripeOddColor));const v=1/Math.sqrt(2);return g.code.add((0,d.H)(s||(s=(0,r.A)(["\n    const float INV_SQRT2 = ",";\n\n    vec4 arrowColor(vec2 tc, float len) {\n      float d = INV_SQRT2 * (tc.x - abs(tc.y));\n      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n      d = min(d, 1.0 - abs(tc.y));\n\n      if (d < 0.0) {\n        return vec4(0.0);\n      }\n      if (d < outlineSize) {\n        return outlineColor;\n      }\n      return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;\n    }"])),d.H.float(v))),g.main.add((0,d.H)(a||(a=(0,r.A)(["\n    vec2 ntc = vec2(vtc.x / vradius, vtc.y);\n    vec4 color = arrowColor(ntc, vlength / vradius);\n    if (color.a < ",") {\n      discard;\n    }\n    fragColor = color;"])),d.H.float(h.Q))),e}const v=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}))}}]);
//# sourceMappingURL=7352.fb3b0340.chunk.js.map