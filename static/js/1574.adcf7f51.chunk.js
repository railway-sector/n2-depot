"use strict";(self.webpackChunkn2_depot=self.webpackChunkn2_depot||[]).push([[1574],{2144:(e,t,o)=>{o.d(t,{b:()=>s});var i=o(18690),a=o(54901),r=o(50346),n=o(75540);class s{constructor(){this._currentOperationSignal=(0,n.v)(null)}get currentOperationType(){var e,t;return null!==(e=null===(t=this._currentOperationSignal.value)||void 0===t?void 0:t.type)&&void 0!==e?e:null}destroy(){this.stop()}async start(e,t,o){const n=this._currentOperationSignal.value;null===n||void 0===n||n.stop();const s=new AbortController,l=null===o||void 0===o?void 0:o.signal,p=AbortSignal.any([s.signal,l].filter(i.Ru)),d=(0,r.Tw)();let h=!1;const c=()=>{h||(h=!0,d.reject((0,r.NK)()))},u={type:e,resolve:e=>{h||(h=!0,d.resolve(e))},reject:c,promise:d.promise,stop:()=>s.abort(),handles:[]};this._currentOperationSignal.value=u,u.handles.push((0,r.u7)(l,()=>{s.abort()}),(0,r.u7)(p,()=>{(0,a.a0)(u.handles),h||c()}));try{return n&&(await n.promise.catch(()=>{}),(0,r.Te)(p)),await t(u,p),await d.promise}finally{(0,a.a0)(u.handles),this._currentOperationSignal.value===u&&(this._currentOperationSignal.value=null)}}stop(){var e;null===(e=this._currentOperationSignal.value)||void 0===e||e.stop()}}},18279:(e,t,o)=>{o.d(t,{A:()=>ae});var i=o(89379),a=o(6326),r=o(18690),n=o(19276),s=o(50076),l=o(54099),p=o(54901),d=(o(81806),o(76460)),h=o(30726),c=o(50346),u=o(68134),v=o(46053),y=o(87990),g=o(19451),m=o(34111),f=o(56611),_=o(5262),b=o(80963),x=o(63733),w=o(31933),G=o(84847),A=o(94918),C=o(86875),M=o(7246),O=o(76940),E=o(86659),T=o(671);function S(e){switch(e){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the symbol type is not supported"}return""}var k=o(3689);function H(e){return function(e){var t;if(e.graphic&&"graphics"!==(null===(t=e.graphic.layer)||void 0===t?void 0:t.type))return{result:1};if(!e.operations)return{result:2};const o=e.operations.data.type,i=e.operations.data.geometry;return"point"===o||"mesh"===o||"polyline"===o||"polygon"===o?{result:0,geometry:i}:{result:3}}(e).result}var Z=o(69120),R=o(57308),D=o(82307),I=o(95327),P=o(97513),U=o(357),L=o(28506),j=o(64344),F=o(83973),N=o(70330),V=o(28330),K=o(68655),q=o(1723),W=o(53787),z=o(11500);o(47249),o(62754);class B{constructor(e){this.layer=e}get elevationInfo(){return this.layer.elevationInfo}add(e){this.layer.add(e)}addMany(e){this.layer.addMany(e)}onGraphicsChange(e){const{layer:t}=this;return(0,u.on)(()=>t.graphics,"change",t=>e(t))}has(e){return e.layer===this.layer}remove(e){this.layer.remove(e)}removeMany(e){this.layer.removeMany(e)}removeAll(){this.layer.removeAll()}}(0,a.Cg)([(0,v.MZ)()],B.prototype,"elevationInfo",null);class Y{constructor(e){this.layer=e}get elevationInfo(){}add(e,t){var o;const i=null!==(o=this._getSublayerForCreateTool(t))&&void 0!==o?o:this._getSublayerForGraphic(e);null===i||void 0===i||i.add(e)}addMany(e,t){if(t){const o=this._getSublayerForCreateTool(t);if(o)return void o.addMany(e)}e.forEach(e=>{var t;return null===(t=this._getSublayerForGraphic(e))||void 0===t?void 0:t.add(e)})}onGraphicsChange(e){var t,o;const{layer:i}=this;if(null!==(t=i.sublayers)&&void 0!==t&&t.length)return(0,p.vE)(null===(o=i.sublayers)||void 0===o?void 0:o.toArray().map(t=>(0,u.on)(()=>t.graphics,"change",t=>e(t))))}has(e){var t;const{layer:o}=this;return e.layer===o||e.sourceLayer===o||!(null===(t=o.sublayers)||void 0===t||!t.some(t=>e.layer===t||e.sourceLayer===t))}remove(e){var t;null===(t=this._getSublayerForGraphic(e))||void 0===t||t.remove(e)}removeMany(e){e.forEach(e=>{var t;return null===(t=this._getSublayerForGraphic(e))||void 0===t?void 0:t.remove(e)})}removeAll(){var e;null===(e=this.layer.sublayers)||void 0===e||e.forEach(e=>e.removeAll())}_getSublayerForCreateTool(e){const{layer:t}=this;switch(e){case"point":return t.pointLayer;case"polyline":return t.polylineLayer;case"polygon":return t.polygonLayer;case"multipoint":return t.multipointLayer;case"text":return t.textLayer}}_getSublayerForGraphic(e){var t;const{layer:o}=this;if(null!==e&&void 0!==e&&e.geometry)switch(e.geometry.type){case"point":return"text"===(null===(t=e.symbol)||void 0===t?void 0:t.type)?o.textLayer:o.pointLayer;case"polyline":return o.polylineLayer;case"polygon":return o.polygonLayer;case"multipoint":return o.multipointLayer}}}(0,a.Cg)([(0,v.MZ)()],Y.prototype,"elevationInfo",null);let $=class extends l.nJ{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){var e;const{activeComponent:t}=this;if(!t)return null;switch(t.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":return"text"===(null===(e=t.graphicSymbol)||void 0===e?void 0:e.type)?"text":t.geometryType;case"draw-3d":return t.geometryType}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){var e;null===(e=this.activeComponent)||void 0===e||e.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};(0,a.Cg)([(0,v.MZ)()],$.prototype,"activeComponent",void 0),(0,a.Cg)([(0,v.MZ)()],$.prototype,"cancelled",void 0),(0,a.Cg)([(0,v.MZ)()],$.prototype,"history",void 0),(0,a.Cg)([(0,v.MZ)()],$.prototype,"tool",null),(0,a.Cg)([(0,v.MZ)()],$.prototype,"type",void 0),(0,a.Cg)([(0,v.MZ)()],$.prototype,"canUndo",null),(0,a.Cg)([(0,v.MZ)()],$.prototype,"canRedo",null),(0,a.Cg)([(0,v.MZ)()],$.prototype,"onEnd",void 0),(0,a.Cg)([(0,v.MZ)()],$.prototype,"undo",null),(0,a.Cg)([(0,v.MZ)()],$.prototype,"redo",null),(0,a.Cg)([(0,v.MZ)()],$.prototype,"toggleTool",void 0),(0,a.Cg)([(0,v.MZ)()],$.prototype,"addToSelection",void 0),(0,a.Cg)([(0,v.MZ)()],$.prototype,"removeFromSelection",void 0),$=(0,a.Cg)([(0,y.$)("esri.widgets.Sketch.support.OperationHandle")],$);let Q=class extends ${};(0,a.Cg)([(0,v.MZ)()],Q.prototype,"activeComponent",void 0),Q=(0,a.Cg)([(0,y.$)("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],Q);let J=class extends ${};function X(e){var t;if(e.length>1)return!1;const o=null===(t=e.at(0))||void 0===t?void 0:t.geometry;return"point"===(null===o||void 0===o?void 0:o.type)||"multipoint"===(null===o||void 0===o?void 0:o.type)&&o.points.length<2}(0,a.Cg)([(0,v.MZ)()],J.prototype,"activeComponent",void 0),J=(0,a.Cg)([(0,y.$)("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],J);const ee={defaultZ:0},te={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:q.Tv},tool:"transform"},oe=Symbol(),ie=Symbol();let ae=class extends l.nJ{constructor(e){var t,o,i;super(e),this._defaultSnappingManager=null,this._internalGraphicsLayer=new x.A({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._updatingHandles=new g.U,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new O.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new C.A({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new M.A({color:[130,130,130,1],width:2}),this.meshSymbol=new A.A({symbolLayers:new n.A([new G.A])}),this.textSymbol=new E.A({text:"text"}),this.updateGraphics=new n.A,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new O.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new P.A,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._onLayerAdapterChange=async()=>{const{_layerAdapter:e}=this;if(this.removeHandles(ie),!e)return;const t=[e.onGraphicsChange(e=>this._onLayerGraphicsChangeCallback(e)),(0,u.wB)(()=>e.elevationInfo,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},u.pc)].filter(r.Ru);this.addHandles(t,ie)},this._originalPopupEnabled=null,this.defaultCreateOptions=ee,this.defaultUpdateOptions=te,this.snappingOptions=null!==(t=null!==(o=null===e||void 0===e||null===(i=e.snappingManager)||void 0===i?void 0:i.options)&&void 0!==o?o:null===e||void 0===e?void 0:e.snappingOptions)&&void 0!==t?t:new F.A}initialize(){this.addHandles([(0,u.on)(()=>{var e;return null===(e=this.view)||void 0===e||null===(e=e.map)||void 0===e?void 0:e.layers},"change",e=>{this.layer&&e.removed.includes(this.layer)&&this.cancel()}),(0,u.wB)(()=>this._layerAdapter,()=>this._onLayerAdapterChange(),u.pc),(0,u.wB)(()=>this.view,e=>{this._defaultSnappingManager=(0,h.pR)(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new j.g({view:e,options:this.snappingOptions})),"2d"===e.type?Promise.all([o.e(6871),o.e(6364),o.e(6175),o.e(426),o.e(6497),o.e(4471),o.e(1010),o.e(2281),o.e(4300)]).then(o.bind(o,45924)):"3d"===e.type&&(Promise.all([o.e(6871),o.e(6364),o.e(6175),o.e(426),o.e(6497),o.e(6928),o.e(4471),o.e(7322),o.e(1010),o.e(8577),o.e(205),o.e(2281),o.e(6999),o.e(8598),o.e(4752)]).then(o.bind(o,68598)),Promise.all([o.e(3263),o.e(3046),o.e(2208)]).then(o.bind(o,42208))))},u.pc),(0,u.wB)(()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.spatialReference},(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),(0,N.BY)(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=(0,h.pR)(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get _layerAdapter(){const{layer:e}=this;switch(null===e||void 0===e?void 0:e.type){case"graphics":return new B(e);case"map-notes":return new Y(e);default:return null}}get activeTool(){var e,t;return null!==(e=null===(t=this._operationHandle)||void 0===t?void 0:t.tool)&&void 0!==e?e:null}get activeCreateToolDrawMode(){var e;return"create"===(null===(e=this._operationHandle)||void 0===e?void 0:e.type)&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,o=!t&&e&&"tooltip"in e?e.tooltip:null;return null!==o&&void 0!==o&&o.visible?o:null}get activeComponent(){var e,t;return null!==(e=null===(t=this._operationHandle)||void 0===t?void 0:t.activeComponent)&&void 0!==e?e:null}get createGraphic(){return null==this.activeComponent||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",(0,i.A)((0,i.A)({},ee),e))}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",(0,i.A)((0,i.A)((0,i.A)({},te),e),{},{reshapeOptions:(0,i.A)((0,i.A)({},te.reshapeOptions),null===e||void 0===e?void 0:e.reshapeOptions),highlightOptions:(0,i.A)((0,i.A)({},te.highlightOptions),null===e||void 0===e?void 0:e.highlightOptions)}))}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){var e,t;return null!==(e=null===(t=this.snappingManager)||void 0===t?void 0:t.options)&&void 0!==e?e:this._get("snappingOptions")}set snappingOptions(e){null!=this._defaultSnappingManager&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=(0,h.pR)(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new j.g({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){var e;const t=!(null===(e=this.view)||void 0===e||!e.ready||!this.layer),o=this._operationHandle;return t&&o?"active":t?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get updating(){var e;return!(!this._updatingHandles.updating&&(null===(e=this.snappingManager)||void 0===e||!e.updating))}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:o}=t;e&&this._clearCursor(),null!==o&&void 0!==o&&o.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const o="view-ready";this.removeHandles(o),e&&this.addHandles((0,u.z7)(()=>e.ready,t=>{this.removeHandles(this._viewHandlesKey),t&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},u.pc),o),this._set("view",e)}addGraphic(e){var t;null===(t=this._layerAdapter)||void 0===t||t.add(e)}addGraphics(e){var t;null===(t=this._layerAdapter)||void 0===t||t.addMany(e)}hasGraphic(e){var t;return!(null===(t=this._layerAdapter)||void 0===t||!t.has(e))}removeGraphic(e){var t;null===(t=this._layerAdapter)||void 0===t||t.remove(e)}removeGraphics(e){var t;null===(t=this._layerAdapter)||void 0===t||t.removeMany(e)}removeAllGraphics(){var e;null===(e=this._layerAdapter)||void 0===e||e.removeAll()}cancel(){this._moduleLoaderAbortController=(0,h.DC)(this._moduleLoaderAbortController),this._viewReadyAbortController=(0,h.DC)(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){var e;null===(e=this._operationHandle)||void 0===e||e.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e}=this,o=t.toArray();this.removeGraphics(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:e})}}duplicate(){if("active"===this.state&&this.updateGraphics.length){const e=this.updateGraphics.map(e=>e.clone()).toArray();return this.addGraphics(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){var o;this.cancel(),await this._waitViewReady();const{view:i,layer:a}=this;if(!i||"disabled"===this.state)throw a||this._logMissingLayer(),(0,c.NK)();if(null!=i.activeTool&&(i.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");(0,Z.Y3)(i,this._internalGraphicsLayer);const r=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(null==r||this.destroyed)return void(null===(o=i.map)||void 0===o||o.remove(this._internalGraphicsLayer));r.on("complete",()=>{if(r===this._operationHandle){var o;const i=this.createGraphic,a=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),null!==(o=this.view)&&void 0!==o&&null!==(o=o.map)&&void 0!==o&&o.remove(this._internalGraphicsLayer),r.cancelled||null==i||this.addGraphic(i),this._sketchContinuationFlag=!1,this.emit("create",{graphic:i,state:a?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),a||this._sketchContinuationFlag)return;const{creationMode:n}=this;if("continuous"===n){if(null!==t&&void 0!==t&&t.geometryToPlace)return;this._updatingHandles.addPromise((0,c.QZ)(this.create(e,t)))}else"update"===n&&i&&this._updatingHandles.addPromise((0,c.QZ)(this.update([i])))}}),this._operationHandle=r,i.ready&&i.focus()}async place(e,t){return await e.load(),this.create("mesh",(0,i.A)({mode:"click",hasZ:e.hasZ,geometryToPlace:e},t))}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:o,view:i,state:a}=this;if(!i||"disabled"===a)throw o||this._logMissingLayer(),(0,c.NK)();null!=i.activeTool&&(i.activeTool=null);const r=Array.isArray(e)?e:[e];if(null==e||null===r||void 0===r||!r.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some(e=>this.hasGraphic(e)?null==e.geometry&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0)))return;const n=await this._updatingHandles.addPromise(this._setupUpdateOperation(r,t));this.destroyed||null==n||ve(n)||((0,Z.Y3)(i,this._internalGraphicsLayer),this._setUpdateOperationHandle(n,t),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:n.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const o of e)null==o.geometry||"mesh"===o.geometry.type||(0,b.aI)(o.geometry.spatialReference,t.spatialReference)||((0,f.canProjectWithoutEngine)(o.geometry.spatialReference,t.spatialReference)||(0,f.isLoaded)()||await(0,f.load)(),o.geometry=(0,f.project)(o.geometry,t.spatialReference))}else this._logMissingView()}undo(){var e;this.canUndo()&&(null===(e=this._operationHandle)||void 0===e||e.undo())}redo(){var e;this.canRedo()&&(null===(e=this._operationHandle)||void 0===e||e.redo())}canUndo(){var e;return!(null===(e=this._operationHandle)||void 0===e||!e.canUndo())}canRedo(){var e;return!(null===(e=this._operationHandle)||void 0===e||!e.canRedo())}toggleUpdateTool(){var e;null===(e=this._operationHandle)||void 0===e||e.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if("2d"===t.type){const o=[];t.map.allLayers.forEach(e=>{"vector-tile"!==e.type&&"imagery"!==e.type||o.push(e)});const i=await t.hitTest(e,{exclude:o});return(0,W.zF)(i.results)}const o=[t.map.ground];t.map.allLayers.forEach(e=>{(0,w.Eq)(e)&&o.push(e)});const i=await t.hitTest(e,{exclude:o});if(i.results.length>0){var a;const e=i.results[0];if(null!=e&&"graphic"===e.type&&e.graphic&&(!i.ground.mapPoint||t.map.ground.opacity<1||i.ground.distance-(null!==(a=e.distance)&&void 0!==a?a:0)>-Math.min(3*i.ground.distance,"global"===t.viewingMode?(0,m.tO)(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null}_generateViewHandles(e){return[e.on("immediate-click",async e=>{var t;const o="active"===this.state&&"create"===(null===(t=this._operationHandle)||void 0===t?void 0:t.type);"disabled"!==this.state&&!o&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},R.oj.WIDGET)]}async _handleImmediateClick(e){const t=await e.defer(()=>this._getFirstHit((0,z.ZV)(e)));let o=null;if(null!=t){var a;const i=t.graphic;this.updateGraphics.includes(i)||this.hasGraphic(i)?(e.stopPropagation(),o=i):"2d"!==(null===(a=this.view)||void 0===a?void 0:a.type)||this._isComponentGraphic(i)||"active"!==this.state||this.cancel()}else"active"===this.state&&this.cancel();null==o||this.updateGraphics.includes(o)||await this.update([o],(0,i.A)((0,i.A)({},this.defaultUpdateOptions),{},{reshapeOptions:(0,i.A)({},this.defaultUpdateOptions.reshapeOptions)}))}async _setupCreateOperation(e,t){const o=this.view;if(!o)return this._logMissingView(),null;const a=(0,i.A)((0,i.A)({hasZ:"3d"===o.type},this.defaultCreateOptions),t),r=await this._setupDrawGraphicTool(e,o,a);return null==r?null:(o.tools.add(r),o.activeTool=r,this._setupCreateOperationHandle(r,e))}async _setupDrawGraphicTool(e,t,o){var a,r,n;if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:s,defaultZ:l,hasZ:p,geometryToPlace:d,graphicProperties:h,mode:c,preserveAspectRatio:u}=o,v=function(e,t){return"freehandPolygon"===t||"freehandPolyline"===t?"freehand":null!==e&&void 0!==e?e:"rectangle"===t||"circle"===t?"hybrid":"click"}(c,e),y=function(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";case"text":return"point";default:return e}}(e),g=null!==o&&void 0!==o&&null!==(a=o.optionsPerTool)&&void 0!==a&&a.has(e)?o.optionsPerTool.get(e):{},m=null!==(r=null!==(n=null===g||void 0===g?void 0:g.preserveAspectRatio)&&void 0!==n?n:u)&&void 0!==r?r:"rectangle"!==e,f=(0,i.A)({centered:"rectangle"!==e&&!("circle"===e&&!m),cursor:s,defaultZ:l,forceUniformSize:m,graphicProperties:(0,i.A)((0,i.A)({},h),{},{attributes:(0,i.A)({},null===h||void 0===h?void 0:h.attributes)}),geometryToPlace:d,geometryType:y,mode:v,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:p,snappingManager:this.snappingManager,snapToScene:!1,view:t},g);return"2d"===t.type?this._makeDrawGraphicTool2D(f):this._makeDrawGraphicTool3D(f)}async _makeDrawGraphicTool2D(e){const[t,a,r]=await Promise.all([this._requireModule(Promise.all([o.e(6871),o.e(6364),o.e(6175),o.e(426),o.e(6497),o.e(4471),o.e(1010),o.e(2281),o.e(4300)]).then(o.bind(o,45924))),(0,V.E)(),(0,K.f)()]);return ve(t)||this.destroyed?null:new t.module.DrawGraphicTool2D((0,i.A)((0,i.A)({},e),{},{activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:se(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:r}))}async _makeDrawGraphicTool3D(e){var t;const[a,r,n]=await Promise.all([this._requireModule(Promise.all([o.e(6871),o.e(6364),o.e(6175),o.e(426),o.e(6497),o.e(6928),o.e(4471),o.e(7322),o.e(1010),o.e(8577),o.e(205),o.e(2281),o.e(6999),o.e(8598),o.e(4752)]).then(o.bind(o,68598))),(0,V.E)(),(0,K.f)()]);return ve(a)||this.destroyed?null:new a.module.DrawGraphicTool3D((0,i.A)((0,i.A)({},e),{},{elevationInfo:null===(t=this._layerAdapter)||void 0===t?void 0:t.elevationInfo,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:r,automaticLengthMeasurementUtils:n}))}_setupCreateOperationHandle(e,t){const o=this.view;if(!o)return this._logMissingView(),null;let i=null;const a=e.forceUniformSize,r=e.centered,n=[o.on("key-down",t=>{if(t.key===D.NE.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===D.NE.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==D.NE.vertexAdd||t.repeat)t.key===D.NE.undo?(t.stopPropagation(),s.undo()):t.key===D.NE.redo?(t.stopPropagation(),s.redo()):t.key!==D.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===D.NE.center&&(t.repeat||(e.centered=!r,t.stopPropagation())):(e.forceUniformSize=!a,t.stopPropagation());else{const o=e.drawOperation.geometryType;"polyline"!==o&&"polygon"!==o&&"multipoint"!==o||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}},R.oj.WIDGET),o.on("key-up",t=>{t.key===D.NE.pan?e.enabled=!0:t.key!==D.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===D.NE.center&&(e.centered=r,t.stopPropagation()):(e.forceUniformSize=a,t.stopPropagation())},R.oj.WIDGET),e.on("vertex-add",t=>{switch(i=null==i?"start":"active",t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:i,tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",t=>{switch(t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",e=>{this._set("createGraphic",e.graphic),i="complete",e.aborted?s&&s.cancel():s&&s.complete()}),(0,u.wB)(()=>this._getGraphicSymbolFromTool(t),t=>{e.graphicSymbol=t})],s=new Q({activeComponent:e,type:"create",onEnd:()=>{var t;(0,p.ei)(n),null===(t=o.tools)||void 0===t||t.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return s}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol;case"text":return this.textSymbol}}async _setupUpdateOperation(e,t){var o;const{view:a}=this;if(!a)return this._logMissingView(),null;const r=(0,i.A)((0,i.A)((0,i.A)({},this.defaultUpdateOptions),t),{},{reshapeOptions:(0,i.A)((0,i.A)({},this.defaultUpdateOptions.reshapeOptions),null===t||void 0===t?void 0:t.reshapeOptions),highlightOptions:(0,i.A)((0,i.A)({},this.defaultUpdateOptions.highlightOptions),null===t||void 0===t?void 0:t.highlightOptions)});let n=null!==(o=r.tool)&&void 0!==o?o:te.tool;if(this.removeGraphics(e),this.addGraphics(e),"3d"===a.type){if(0===e.length)return null;switch(n){case"move":return this._setupMove3DOperation(e,r,a,n);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],r,a);case"transform":return this._setupGraphicTransform3DOperation(e,r,a)}}switch(n){case"move":return this._setupMove2DOperation(e,r,a);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,n,r,a);case"transform":return X(e)&&(n="reshape"),this._setupTransformOrReshape2DOperation(e,n,r,a)}}async _setupMove3DOperation(e,t,i,a){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const[n,s]=await Promise.all([this._requireModule(Promise.all([o.e(6871),o.e(6364),o.e(6175),o.e(426),o.e(6497),o.e(6928),o.e(4471),o.e(7322),o.e(1010),o.e(8577),o.e(205),o.e(2281),o.e(6999),o.e(8598),o.e(4752)]).then(o.bind(o,68598))),(0,K.f)()]);if(ve(n))return n;const{ManipulatedObject3DGraphic:l,MoveTool3D:d}=n.module,h=new Map,c=()=>{h.forEach(e=>e.destroy()),h.clear()};for(const o of e){const e=new l({view:i,graphic:o}),t=(0,k.Y)(e);if(0!==t)return c(),this._logError("sketch:move","Move operation not supported for provided graphic(s) (".concat(S(t),").")),null;h.set(o,e)}const u=new d({view:i,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:s});i.tools.add(u),u.objects.addMany(Array.from(h.values())),r||this.updateGraphics.addMany(e);const v=[],y=new J({activeComponent:u,tool:a,type:"update",onEnd:()=>{(0,p.ei)(v),ue(i,u),c()},undo:()=>{he(this.view,u),le(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{pe(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:e=>{this.updateGraphics.push(e);const t=new l({view:i,graphic:e});h.set(e,t),u.objects.push(t),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);if(y.history.undo.forEach(e=>e.updates.splice(t,1)),y.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0===this.updateGraphics.length)return void y.complete();const o=h.get(e);o&&(u.objects.remove(o),o.destroy(),h.delete(e))},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==a)return;const e=this.updateGraphics.at(0),o=await this._setupReshape3DOperation(e,t,i,!0);o&&!ve(o)&&(y.onEnd(),y.destroy(),this._setUpdateOperationHandle(o,t))}});return v.push(...this._getHandlesForComponent(y,t),i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(y,e,t),R.oj.WIDGET),i.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(y,e)},R.oj.WIDGET)),y}_setupGraphicTransform3DOperation(e,t,o){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(1===e.length&&0===function(e){var t;if("graphics"!==(null===(t=e.layer)||void 0===t?void 0:t.type))return 1;if(null==e.geometry)return 2;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 0;default:return 3}const o=null!=e.symbol&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return o&&o.some(e=>"object"===e.type)?0:4}(e[0])){const a=e[0],r=a.geometry;if(null!=r&&("point"===r.type||"mesh"===r.type))return this._setupPointTransform3DOperation(a,t,o);if(null!=r&&("polygon"===r.type||"polyline"===r.type))return this._setupPolyTransform3DOperation(a,t,o,i)}return this._setupMove3DOperation(e,t,o,"transform",i)}async _setupPointTransform3DOperation(e,t,i){const a="transform",{enableRotation:r,enableScaling:n,enableZ:s}=t,l=await this._requireModule(Promise.all([o.e(6871),o.e(6364),o.e(6175),o.e(426),o.e(6497),o.e(6928),o.e(4471),o.e(7322),o.e(1010),o.e(8577),o.e(205),o.e(2281),o.e(6999),o.e(8598),o.e(4752)]).then(o.bind(o,68598)));if(ve(l))return l;const{TransformTool3D:d,ManipulatedObject3DGraphic:h}=l.module,c=new h({graphic:e,view:i}),u=new d({object:c,view:i,enableRotation:r,enableScaling:n,enableZ:s,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(u),this.updateGraphics.add(e);const v=[],y=new J({activeComponent:u,tool:a,type:"update",onEnd:()=>{(0,p.ei)(v),ue(i,u),c.destroy()},undo:()=>{he(this.view,u),le(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{pe(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const o=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);ve(o)||this._setUpdateOperationHandle(o,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return v.push(...this._getHandlesForComponent(y,t),i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(y,e,t),R.oj.WIDGET),i.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(y,e)},R.oj.WIDGET)),y}async _setupPolyTransform3DOperation(e,t,i){var a;let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n="transform",{enableRotation:s,enableScaling:l,enableZ:d,preserveAspectRatio:h}=t,[c,u]=await Promise.all([this._requireModule(Promise.all([o.e(6871),o.e(6364),o.e(6175),o.e(426),o.e(6497),o.e(6928),o.e(4471),o.e(7322),o.e(1010),o.e(8577),o.e(205),o.e(2281),o.e(6999),o.e(8598),o.e(4752)]).then(o.bind(o,68598))),(0,K.f)()]);if(ve(c))return c;const{ManipulatedObject3DGraphic:v,ExtentTransformTool:y}=c.module,g=null===(a=this.view)||void 0===a||null===(a=a.inputManager)||void 0===a?void 0:a.isModifierKeyDown(D.NE.constraint),m=new v({view:i,graphic:e}),f=new y({object:m,view:i,enableRotation:s,enableScaling:l,enableZ:d,preserveAspectRatio:!!h!=!!g,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:u});i.tools.add(f),r||this.updateGraphics.add(e);const _=[],b=new J({activeComponent:f,tool:n,type:"update",onEnd:()=>{(0,p.ei)(_),ue(i,f),m.destroy()},canUndo:()=>!f.destroyed&&f.canUndo,undo:()=>{f.destroyed||(f.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n}))},canRedo:()=>!f.destroyed&&f.canRedo,redo:()=>{f.destroyed||(f.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),b.onEnd(),b.destroy();const o=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);ve(o)||this._setUpdateOperationHandle(o,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),b.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const o=await this._setupReshape3DOperation(e,t,i,!0);o&&!ve(o)&&(b.onEnd(),b.destroy(),this._setUpdateOperationHandle(o,t))}});return _.push(...this._getHandlesForComponent(b,t),i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(b,e,t),R.oj.WIDGET),i.on("key-down",e=>this._getCommonUpdateOperationKeyDownHandlers(b,e),R.oj.WIDGET),i.on("key-down",e=>{e.key!==D.NE.constraint||e.repeat||(f.preserveAspectRatio=!f.preserveAspectRatio,e.stopPropagation())},R.oj.WIDGET),i.on("key-up",e=>{e.key===D.NE.constraint&&(f.preserveAspectRatio=!f.preserveAspectRatio,e.stopPropagation())},R.oj.WIDGET)),b}async _setupMove2DOperation(e,t,o){const i="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const a=await this._getGraphicMover(e,t,o);if(ve(a))return a;const r=new J({activeComponent:a,tool:i,type:"update",onEnd:()=>{var e;this._clearCursor(),(0,p.ei)(l),(0,p.ei)(s),a.destroy(),null===(e=this._internalGraphicsLayer)||void 0===e||e.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();le(r,e),r.refreshComponent(),this._emitUndoEvent({graphics:e,tool:i})},redo:()=>{const e=this.updateGraphics.toArray();pe(r,e),r.refreshComponent(),this._emitRedoEvent({graphics:e,tool:i})},addToSelection:async e=>{await this._updatingHandles.addPromise(this._updateSpatialReference(e)),this.updateGraphics.push(e),a.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);r.history.undo.forEach(e=>e.updates.splice(t,1)),r.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);const o=this.updateGraphics.toArray();this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?a.graphics=o:r.complete()}});let n=!1;const s=[o.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(r,e,t),R.oj.WIDGET),o.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key!==D.NE.constraint||e.repeat||(n=!0,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)},R.oj.WIDGET),o.on("key-up",e=>{e.key===D.NE.constraint&&n&&(n=!1,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)},R.oj.WIDGET)],l=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r="reshape",[n,s,l]=await Promise.all([this._requireModule(Promise.all([o.e(6871),o.e(6364),o.e(6175),o.e(426),o.e(6497),o.e(6928),o.e(4471),o.e(7322),o.e(1010),o.e(8577),o.e(205),o.e(2281),o.e(6999),o.e(8598),o.e(4752)]).then(o.bind(o,68598))),(0,V.E)(),(0,K.f)()]);if(ve(n))return n;const{ManipulatedObject3DGraphic:d,ReshapeTool3D:h}=n.module,c=new d({view:i,graphic:e}),u=H(c);if(0!==u)return c.destroy(),this._logError("sketch:reshape","Reshape operation not supported for provided graphic(s) (".concat(S(u),").")),null;const v=t.reshapeOptions,y=new h({view:i,object:c,enableZVertex:t.enableZ&&"move"===(null===v||void 0===v?void 0:v.vertexOperation),enableZShape:t.enableZ&&"move"===(null===v||void 0===v?void 0:v.shapeOperation),enableMoveObject:"move"===(null===v||void 0===v?void 0:v.shapeOperation)||"move-xy"===(null===v||void 0===v?void 0:v.shapeOperation),enableMidpoints:"split"===(null===v||void 0===v?void 0:v.edgeOperation),enableEdgeOffset:"offset"===(null===v||void 0===v?void 0:v.edgeOperation),snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:s,automaticLengthMeasurementUtils:l});i.tools.add(y),a||this.updateGraphics.add(c.graphic);const g=[],m=new J({activeComponent:y,tool:r,type:"update",onEnd:()=>{(0,p.ei)(g),ue(i,y),c.destroy()},canUndo:()=>!y.destroyed&&y.canUndo,undo:()=>{y.destroyed||(y.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},canRedo:()=>!y.destroyed&&y.canRedo,redo:()=>{y.destroyed||(y.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),m.onEnd(),m.destroy();const o=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);ve(o)||this._setUpdateOperationHandle(o,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),m.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;m.onEnd(),m.destroy();const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,i,!0);ve(e)||this._setUpdateOperationHandle(e,t)}});return g.push(...this._getHandlesForComponent(m,t),i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(m,e,t),R.oj.WIDGET),i.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(m,e)},R.oj.WIDGET)),m}async _setupTransformOrReshape2DOperation(e,t,o,i){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const a="transform"===t?await this._getBox(e,o,i):await this._getReshape(e,o,i);if(ve(a))return a;const r=new J({activeComponent:a,type:"update",onEnd:()=>{(0,p.ei)(s),(0,p.ei)(n),r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{le(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{pe(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async e=>{let t=r.activeComponent;if("reshape"===(null===t||void 0===t?void 0:t.type)){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll(),r.onEnd(),r.destroy();const a=await this._setupTransformOrReshape2DOperation(t,"transform",o,i);if(ve(a))return;this._setUpdateOperationHandle(a,o)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);r.history.undo.forEach(e=>e.updates.splice(t,1)),r.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);const o=this.updateGraphics.toArray();0===o.length?r.complete():X(o)?r.toggleTool():r.activeComponent.graphics=o,this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{var e;if(this.updateGraphics.length>1)return;const t=this.updateGraphics.at(0),a=t.geometry;if(null!=a&&("reshape"===r.tool&&"point"===a.type||"transform"===r.tool&&"extent"===a.type))return;let n=null;"transform"===r.tool?n=await this._getReshape([t],o,i):"reshape"===r.tool&&(n=await this._getBox([t],o,i)),ve(n)||(null!==(e=r.activeComponent)&&void 0!==e&&e.destroy(),r.activeComponent=n,r.activeComponent&&((0,p.ei)(s),s=this._getHandlesForComponent(r,o)))}}),n=[i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(r,e,o),R.oj.WIDGET),i.on("key-down",e=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key===D.NE.constraint&&!e.repeat&&r){const e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},R.oj.WIDGET),i.on("key-up",e=>{if(e.key===D.NE.constraint&&r){const e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},R.oj.WIDGET)];let s=this._getHandlesForComponent(r,o);return r}async _getGraphicMover(e,t,i){const{enableMoveAllGraphics:a,highlightOptions:r}=t,n=await this._requireModule(Promise.all([o.e(1472),o.e(2375)]).then(o.bind(o,61472)));return ve(n)?n:new n.module.default({enableMoveAllGraphics:a,highlightName:null===r||void 0===r?void 0:r.name,highlightsEnabled:!(null===r||void 0===r||!r.enabled),indicatorsEnabled:!1,graphics:e,view:i,callbacks:{onGraphicMoveStart:e=>{let{dx:t,dy:o,graphic:i}=e;this._displayCursor("grabbing"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:"move-start"},type:"update"})},onGraphicMove:e=>{let{dx:t,dy:o,graphic:i}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:"move"},type:"update"})},onGraphicMoveStop:e=>{let{dx:t,dy:o,graphic:i}=e;this._displayCursor("pointer"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayCursor("move"),onGraphicPointerOut:()=>this._clearCursor()}})}async _getBox(e,t,a){var r;const{enableRotation:n,enableScaling:s,highlightOptions:l,preserveAspectRatio:p}=t,[d,h]=await Promise.all([this._requireModule(Promise.all([o.e(4471),o.e(1472),o.e(3277)]).then(o.bind(o,20819))),(0,K.f)()]);if(ve(d))return d;const c=null===(r=this.view)||void 0===r||null===(r=r.inputManager)||void 0===r?void 0:r.isModifierKeyDown(D.NE.constraint);return new d.module.default({graphics:e,enableRotation:n,enableScaling:s,highlightName:null===l||void 0===l?void 0:l.name,highlightsEnabled:!(null===l||void 0===l||!l.enabled),preserveAspectRatio:!!p!=!!c,layer:this._internalGraphicsLayer,view:a,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:h,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,i.A)({},e),type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,i.A)({},e),type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,i.A)({},e),type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,i.A)({},e),type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,i.A)({},e),type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,i.A)({},e),type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,i.A)({},e),type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,i.A)({},e),type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,i.A)({},e),type:"update"})}})}async _getReshape(e,t,a){const{highlightOptions:r,reshapeOptions:n}=t,s="split"===(null===n||void 0===n?void 0:n.edgeOperation),l="move"===(null===n||void 0===n?void 0:n.shapeOperation),p=!(null===n||void 0===n||!n.enableCreateCurveFromStraightEdge),[d,h,c]=await Promise.all([this._requireModule(Promise.all([o.e(6871),o.e(6364),o.e(6175),o.e(426),o.e(6497),o.e(4471),o.e(1472),o.e(7859)]).then(o.bind(o,34781))),(0,V.E)(),(0,K.f)()]);return ve(d)?d:new d.module.default({enableMidpoints:s,enableMovement:l,enableCurveOnMidpoint:p,graphic:e[0],highlightName:null===r||void 0===r?void 0:r.name,highlightsEnabled:!(null===r||void 0===r||!r.enabled),layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:h,automaticLengthMeasurementUtils:c,view:a,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,i.A)({},e),type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,i.A)({},e),type:"update"}),onReshapeStop:e=>{let{mover:t,type:o}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:t,type:o},type:"update"})},onMoveStart:e=>{let{dx:t,dy:o,mover:i,type:a}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:a},type:"update"})},onMove:e=>{let{dx:t,dy:o,mover:i,type:a}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:a},type:"update"})},onMoveStop:e=>{let{dx:t,dy:o,mover:i,type:a}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:a},type:"update"})},onVertexAdd:e=>{let{added:t,type:o,vertices:i}=e;const a=t.map(e=>(0,_.$K)(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:a,vertices:i,type:o},type:"update"})},onVertexRemove:e=>{let{removed:t,type:o,vertices:i}=e;const a=t.map(e=>(0,_.$K)(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:a,vertices:i,type:o},type:"update"})}}})}_getHandlesForComponent(e,t){const o=e.activeComponent;if(!o)return[];switch(o.type){case"graphic-mover":return[o.on("graphic-click",o=>{var i;let{graphic:a,viewEvent:r}=o;(null===(i=r.native)||void 0===i?void 0:i.shiftKey)&&t.multipleSelectionEnabled&&(r.stopPropagation(),e.removeFromSelection(a))}),o.on("graphic-move-start",t=>e.addToHistory(ce(t.allGraphics)))];case"box":return[o.on("graphic-click",o=>this._onTransformOrReshape2DGraphicClick(e,t,o)),o.on("move-start",t=>e.addToHistory(ce(t.graphics))),o.on("rotate-start",t=>e.addToHistory(ce(t.graphics))),o.on("scale-start",t=>e.addToHistory(ce(t.graphics)))];case"reshape":return[o.on("graphic-click",o=>this._onTransformOrReshape2DGraphicClick(e,t,o)),o.on("move-start",t=>e.addToHistory(ce([t.mover]))),o.on("reshape-start",t=>e.addToHistory(ce([t.graphic]))),o.on("vertex-add",t=>e.addToHistory(ce([t.oldGraphic]))),o.on("vertex-remove",t=>e.addToHistory(ce([t.oldGraphic])))];case"move-3d":return[o.events.on("record-undo",t=>{let{updates:o}=t;e.addToHistory({updates:o})}),o.events.on("move-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-start"},type:"update"})}),o.events.on("move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move"},type:"update"})}),o.events.on("move-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-stop"},type:"update"})}),o.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[o.events.on("record-undo",t=>{let{updates:o}=t;e.addToHistory({updates:o})}),o.events.on("translate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})}),o.events.on("translate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})}),o.events.on("rotate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-start"},type:"update"})}),o.events.on("rotate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})}),o.events.on("scale-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})}),o.events.on("scale-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})}),o.events.on("translate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})}),o.events.on("rotate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate"},type:"update"})}),o.events.on("scale",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})}),o.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[o.events.on("reshape",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,i.A)((0,i.A)({},e),{},{mover:e.object.graphic}),type:"update"})}),o.events.on("move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:(0,i.A)((0,i.A)({},e),{},{mover:e.object.graphic}),type:"update"})}),o.events.on("vertex-add",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),o.events.on("vertex-remove",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),o.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,o){var i;const{graphic:a,viewEvent:r}=o;return null!==(i=r.native)&&void 0!==i&&i.shiftKey&&this.hasGraphic(a)?(r.stopPropagation(),e.removeFromSelection(a)):t.toggleToolOnClick?(r.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){var o;this._operationHandle=e;const i=null===(o=this.view)||void 0===o?void 0:o.map;this._disablePopup(t);e.on("complete",()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),a=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:a,toolEventInfo:null,type:"update"})}})}async _getCommonUpdateOperationClickHandlers(e,t,o){const i=(0,z.ZV)(t),a=await t.defer(()=>this._getFirstHit(i));null!=a&&(t.native.shiftKey&&this._toggleSelection([a.graphic],e,o)||this.updateGraphics.includes(a.graphic))?t.stopPropagation():e.complete()}_toggleSelection(e,t,o){const i=!!o.multipleSelectionEnabled;return e.some(e=>null!=e&&!(!i||!this.hasGraphic(e))&&(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const o=t.key;o===D.NE.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):o===D.NE.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):o===D.NE.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&D.NE.delete.includes(o)&&this._onDeleteKey(t)}_onDeleteKey(e){var t;if(!this._operationHandle||"update"!==this._operationHandle.type)return;const o=this.activeComponent,i=this.updateGraphics.toArray();null!=o&&("reshape"!==o.type||1===i.length&&"point"===(null===(t=i[0].geometry)||void 0===t?void 0:t.type))&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){var e;this._internalGraphicsLayer&&(null!==(e=this.view)&&void 0!==e&&null!==(e=e.map)&&void 0!==e&&e.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=(0,h.pR)(this._internalGraphicsLayer))}_isComponentGraphic(e){var t;const{activeComponent:o}=this;return!(!e||null==o)&&((null===(t=e.attributes)||void 0===t?void 0:t.esriSketchTool)||"draw-2d"===o.type&&o.graphic===e||("box"===o.type||"reshape"===o.type)&&o.isUIGraphic(e))}_clearCursor(){this.removeHandles(oe)}_displayCursor(e){var t;this.removeHandles(oe),(null===(t=this.view)||void 0===t?void 0:t.container)&&null!=e&&this.addHandles(this.view.acquireCursor(e,"high"),oe)}_logError(e,t,o){d.A.getLogger(this).error(new s.A(e,t,o))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const o=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:o}}_emitUndoEvent(e){this.emit("undo",(0,i.A)((0,i.A)({},e),{},{type:"undo"}))}_emitRedoEvent(e){this.emit("redo",(0,i.A)((0,i.A)({},e),{},{type:"redo"}))}_emitDeleteEvent(e){this.emit("delete",(0,i.A)((0,i.A)({},e),{},{type:"delete"}))}_onLayerGraphicsChangeCallback(e){if(null!=this._operationHandle){const{updateGraphics:t}=this;for(const o of e.removed)if(t.includes(o)){if(!(t.length>1)){this._operationHandle.cancel();break}this._operationHandle.removeFromSelection(o)}}}get test(){}wait(){return(0,u.C_)(()=>!this.updating)}_disablePopupEnabled(e){var t,o;return"3d"!==(null===(t=this.view)||void 0===t?void 0:t.type)||this.updateOnGraphicClick||null!==(o=null===e||void 0===e?void 0:e.toggleToolOnClick)&&void 0!==o&&o}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&null==this._originalPopupEnabled&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&null!=this._originalPopupEnabled&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?((0,h.DC)(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await(0,c.qr)((0,u.C_)(()=>null===e||void 0===e?void 0:e.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",ne("view"))}_logMissingLayer(){this._logError(re,ne("layer"))}};(0,a.Cg)([(0,v.MZ)()],ae.prototype,"_defaultSnappingManager",void 0),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"_layerAdapter",null),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"_operationHandle",void 0),(0,a.Cg)([(0,v.MZ)({readOnly:!0})],ae.prototype,"_updatingHandles",void 0),(0,a.Cg)([(0,v.MZ)({readOnly:!0})],ae.prototype,"activeTool",null),(0,a.Cg)([(0,v.MZ)({readOnly:!0})],ae.prototype,"activeCreateToolDrawMode",null),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"activeTooltip",null),(0,a.Cg)([(0,v.MZ)({types:T.Es})],ae.prototype,"activeFillSymbol",void 0),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"activeLineSymbol",void 0),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"activeVertexSymbol",void 0),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"allowDeleteKey",void 0),(0,a.Cg)([(0,v.MZ)({readOnly:!0})],ae.prototype,"createGraphic",null),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"defaultCreateOptions",null),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"defaultUpdateOptions",null),(0,a.Cg)([(0,v.MZ)({type:I.A,nonNullable:!0})],ae.prototype,"labelOptions",null),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"layer",void 0),(0,a.Cg)([(0,v.MZ)({types:T.Es})],ae.prototype,"pointSymbol",void 0),(0,a.Cg)([(0,v.MZ)({types:T.Es})],ae.prototype,"polygonSymbol",void 0),(0,a.Cg)([(0,v.MZ)({types:T.Es})],ae.prototype,"polylineSymbol",void 0),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"meshSymbol",void 0),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"textSymbol",void 0),(0,a.Cg)([(0,v.MZ)({type:F.A,nonNullable:!0})],ae.prototype,"snappingOptions",null),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"snappingManager",null),(0,a.Cg)([(0,v.MZ)({readOnly:!0})],ae.prototype,"state",null),(0,a.Cg)([(0,v.MZ)({type:U.A,nonNullable:!0})],ae.prototype,"tooltipOptions",null),(0,a.Cg)([(0,v.MZ)({readOnly:!0})],ae.prototype,"updateGraphics",void 0),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"updateOnGraphicClick",void 0),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"updating",null),(0,a.Cg)([(0,v.MZ)()],ae.prototype,"creationMode",void 0),(0,a.Cg)([(0,v.MZ)({type:L.A,nonNullable:!0})],ae.prototype,"valueOptions",null),(0,a.Cg)([(0,v.MZ)({types:T.Es})],ae.prototype,"vertexSymbol",void 0),(0,a.Cg)([(0,v.MZ)({value:null})],ae.prototype,"view",null),(0,a.Cg)([(0,v.MZ)({constructOnly:!0,type:P.A})],ae.prototype,"sketchOptions",void 0),ae=(0,a.Cg)([(0,y.$)("esri.widgets.Sketch.SketchViewModel")],ae);const re="sketch:missing-property",ne=e=>"Property '".concat(e,"' is missing on SketchViewModel.");function se(e){return"polygon"===e||"rectangle"===e||"circle"===e}function le(e,t){de("undo",e.history.undo,e.history.redo,t)}function pe(e,t){de("redo",e.history.redo,e.history.undo,t)}function de(e,t,o,i){const a=t.pop();if(!a)return;const r=a.updates,n=[];i.forEach((t,o)=>{const i=r[o];null!=i&&("geometry"in i&&null!=i.geometry&&(n.push({geometry:t.geometry}),t.geometry=i.geometry),"symbol"in i&&null!=i.symbol&&(n.push({symbol:t.symbol}),t.symbol=i.symbol),"undo"in i&&(n.push(i),i[e](t)))}),o.push({updates:n})}function he(e,t){null!=e&&t.hasGrabbedManipulators&&(e.activeTool=null)}function ce(e){return{updates:e.map(e=>{let{geometry:t}=e;return"mesh"===(null===t||void 0===t?void 0:t.type)?{geometry:t.cloneShallow()}:{geometry:t}})}}function ue(e,t){var o;null!==(o=e.tools)&&void 0!==o&&o.remove(t),t.destroyed||t.destroy()}function ve(e){return"requireError"in e&&"aborted"===e.requireError}},28330:(e,t,o)=>{o.d(t,{E:()=>s});var i=o(78009),a=o(66678);const r=e=>({autoAreaByElevationMode(t,o){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,i.u0)();if("on-the-ground"===o){const o=e.geodesicArea(t);return null!=o?o:(0,i.qh)(t,a)}return(0,i.EI)(t,a)},autoArea2D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,i.u0)();return this.autoAreaByElevationMode(e,"on-the-ground",t)}});let n=null;async function s(){return n||(n=r(await(0,a.c)())),n}},38983:(e,t,o)=>{function i(e,t,o){o=o||2;var i,r,s,l,p,d,c,u=t&&t.length,v=u?t[0]*o:e.length,y=a(e,0,v,o,!0),g=[];if(!y||y.next===y.prev)return g;if(u&&(y=h(e,t,y,o)),e.length>80*o){i=s=e[0],r=l=e[1];for(var m=o;m<v;m+=o)(p=e[m])<i&&(i=p),(d=e[m+1])<r&&(r=d),p>s&&(s=p),d>l&&(l=d);c=0!==(c=Math.max(s-i,l-r))?1/c:0}return n(y,g,o,i,r,c),g}function a(e,t,o,i,a){var r,n;if(a===k(e,t,o,i)>0)for(r=t;r<o;r+=i)n=E(r,e[r],e[r+1],n);else for(r=o-i;r>=t;r-=i)n=E(r,e[r],e[r+1],n);if(n&&w(n,n.next)){var s=n.next;T(n),n=s}return n}function r(e,t){if(!e)return e;t||(t=e);var o,i=e;do{if(o=!1,i.steiner||!w(i,i.next)&&0!==x(i.prev,i,i.next))i=i.next;else{var a=i.prev;if(T(i),(i=t=a)===i.next)break;o=!0}}while(o||i!==t);return t}function n(e,t,o,i,a,h,c){if(e){!c&&h&&g(e,i,a,h);for(var u,v,y=e;e.prev!==e.next;)if(u=e.prev,v=e.next,h?l(e,i,a,h):s(e))t.push(u.i/o),t.push(e.i/o),t.push(v.i/o),T(e),e=v.next,y=v.next;else if((e=v)===y){c?1===c?n(e=p(r(e),t,o),t,o,i,a,h,2):2===c&&d(e,t,o,i,a,h):n(r(e),t,o,i,a,h,1);break}}}function s(e){var t=e.prev,o=e,i=e.next;if(x(t,o,i)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(_(t.x,t.y,o.x,o.y,i.x,i.y,a.x,a.y)&&x(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function l(e,t,o,i){var a=e.prev,r=e,n=e.next;if(x(a,r,n)>=0)return!1;for(var s=a.x<r.x?a.x<n.x?a.x:n.x:r.x<n.x?r.x:n.x,l=a.y<r.y?a.y<n.y?a.y:n.y:r.y<n.y?r.y:n.y,p=a.x>r.x?a.x>n.x?a.x:n.x:r.x>n.x?r.x:n.x,d=a.y>r.y?a.y>n.y?a.y:n.y:r.y>n.y?r.y:n.y,h=m(s,l,t,o,i),c=m(p,d,t,o,i),u=e.prevZ,v=e.nextZ;u&&u.z>=h&&v&&v.z<=c;){if(u!==e.prev&&u!==e.next&&_(a.x,a.y,r.x,r.y,n.x,n.y,u.x,u.y)&&x(u.prev,u,u.next)>=0)return!1;if(u=u.prevZ,v!==e.prev&&v!==e.next&&_(a.x,a.y,r.x,r.y,n.x,n.y,v.x,v.y)&&x(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;u&&u.z>=h;){if(u!==e.prev&&u!==e.next&&_(a.x,a.y,r.x,r.y,n.x,n.y,u.x,u.y)&&x(u.prev,u,u.next)>=0)return!1;u=u.prevZ}for(;v&&v.z<=c;){if(v!==e.prev&&v!==e.next&&_(a.x,a.y,r.x,r.y,n.x,n.y,v.x,v.y)&&x(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function p(e,t,o){var i=e;do{var a=i.prev,n=i.next.next;!w(a,n)&&G(a,i,i.next,n)&&M(a,n)&&M(n,a)&&(t.push(a.i/o),t.push(i.i/o),t.push(n.i/o),T(i),T(i.next),i=e=n),i=i.next}while(i!==e);return r(i)}function d(e,t,o,i,a,s){var l=e;do{for(var p=l.next.next;p!==l.prev;){if(l.i!==p.i&&b(l,p)){var d=O(l,p);return l=r(l,l.next),d=r(d,d.next),n(l,t,o,i,a,s),void n(d,t,o,i,a,s)}p=p.next}l=l.next}while(l!==e)}function h(e,t,o,i){var n,s,l,p=[];for(n=0,s=t.length;n<s;n++)(l=a(e,t[n]*i,n<s-1?t[n+1]*i:e.length,i,!1))===l.next&&(l.steiner=!0),p.push(f(l));for(p.sort(c),n=0;n<p.length;n++)o=r(o=v(p[n],o),o.next);return o}function c(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;let t=e;for(;;){const o=t.next;if(o.prev===t||o===t||o===e)break;t=o}return t}function v(e,t){var o=function(e,t){var o,i=t,a=e.x,r=e.y,n=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var s=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=a&&s>n){if(n=s,s===a){if(r===i.y)return i;if(r===i.next.y)return i.next}o=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!o)return null;if(a===n)return o;var l,p=o,d=o.x,h=o.y,c=1/0;i=o;do{a>=i.x&&i.x>=d&&a!==i.x&&_(r<h?a:n,r,d,h,r<h?n:a,r,i.x,i.y)&&(l=Math.abs(r-i.y)/(a-i.x),M(i,e)&&(l<c||l===c&&(i.x>o.x||i.x===o.x&&y(o,i)))&&(o=i,c=l)),i=i.next}while(i!==p);return o}(e,t);if(!o)return t;var i=O(o,e),a=r(o,o.next);let n=u(i);return r(n,n.next),a=u(a),u(t===o?a:t)}function y(e,t){return x(e.prev,e,t.prev)<0&&x(t.next,e,e.next)<0}function g(e,t,o,i){var a=e;do{null===a.z&&(a.z=m(a.x,a.y,t,o,i)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,function(e){var t,o,i,a,r,n,s,l,p=1;do{for(o=e,e=null,r=null,n=0;o;){for(n++,i=o,s=0,t=0;t<p&&(s++,i=i.nextZ);t++);for(l=p;s>0||l>0&&i;)0!==s&&(0===l||!i||o.z<=i.z)?(a=o,o=o.nextZ,s--):(a=i,i=i.nextZ,l--),r?r.nextZ=a:e=a,a.prevZ=r,r=a;o=i}r.nextZ=null,p*=2}while(n>1)}(a)}function m(e,t,o,i,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-o)*a)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,o=e;do{(t.x<o.x||t.x===o.x&&t.y<o.y)&&(o=t),t=t.next}while(t!==e);return o}function _(e,t,o,i,a,r,n,s){return(a-n)*(t-s)-(e-n)*(r-s)>=0&&(e-n)*(i-s)-(o-n)*(t-s)>=0&&(o-n)*(r-s)-(a-n)*(i-s)>=0}function b(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var o=e;do{if(o.i!==e.i&&o.next.i!==e.i&&o.i!==t.i&&o.next.i!==t.i&&G(o,o.next,e,t))return!0;o=o.next}while(o!==e);return!1}(e,t)&&(M(e,t)&&M(t,e)&&function(e,t){var o=e,i=!1,a=(e.x+t.x)/2,r=(e.y+t.y)/2;do{o.y>r!=o.next.y>r&&o.next.y!==o.y&&a<(o.next.x-o.x)*(r-o.y)/(o.next.y-o.y)+o.x&&(i=!i),o=o.next}while(o!==e);return i}(e,t)&&(x(e.prev,e,t.prev)||x(e,t.prev,t))||w(e,t)&&x(e.prev,e,e.next)>0&&x(t.prev,t,t.next)>0)}function x(e,t,o){return(t.y-e.y)*(o.x-t.x)-(t.x-e.x)*(o.y-t.y)}function w(e,t){return e.x===t.x&&e.y===t.y}function G(e,t,o,i){var a=C(x(e,t,o)),r=C(x(e,t,i)),n=C(x(o,i,e)),s=C(x(o,i,t));return a!==r&&n!==s||!(0!==a||!A(e,o,t))||!(0!==r||!A(e,i,t))||!(0!==n||!A(o,e,i))||!(0!==s||!A(o,t,i))}function A(e,t,o){return t.x<=Math.max(e.x,o.x)&&t.x>=Math.min(e.x,o.x)&&t.y<=Math.max(e.y,o.y)&&t.y>=Math.min(e.y,o.y)}function C(e){return e>0?1:e<0?-1:0}function M(e,t){return x(e.prev,e,e.next)<0?x(e,t,e.next)>=0&&x(e,e.prev,t)>=0:x(e,t,e.prev)<0||x(e,e.next,t)<0}function O(e,t){var o=new S(e.i,e.x,e.y),i=new S(t.i,t.x,t.y),a=e.next,r=t.prev;return e.next=t,t.prev=e,o.next=a,a.prev=o,i.next=o,o.prev=i,r.next=i,i.prev=r,i}function E(e,t,o,i){var a=new S(e,t,o);return i?(a.next=i.next,a.prev=i,i.next.prev=a,i.next=a):(a.prev=a,a.next=a),a}function T(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,o){this.i=e,this.x=t,this.y=o,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function k(e,t,o,i){for(var a=0,r=t,n=o-i;r<o;r+=i)a+=(e[n]-e[r])*(e[r+1]+e[n+1]),n=r;return a}o.d(t,{e:()=>i}),i.deviation=function(e,t,o,i){var a=t&&t.length,r=a?t[0]*o:e.length,n=Math.abs(k(e,0,r,o));if(a)for(var s=0,l=t.length;s<l;s++){var p=t[s]*o,d=s<l-1?t[s+1]*o:e.length;n-=Math.abs(k(e,p,d,o))}var h=0;for(s=0;s<i.length;s+=3){var c=i[s]*o,u=i[s+1]*o,v=i[s+2]*o;h+=Math.abs((e[c]-e[v])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[v+1]-e[c+1]))}return 0===n&&0===h?0:Math.abs((h-n)/n)},i.flatten=function(e){for(var t=e[0][0].length,o={vertices:[],holes:[],dimensions:t},i=0,a=0;a<e.length;a++){for(var r=0;r<e[a].length;r++)for(var n=0;n<t;n++)o.vertices.push(e[a][r][n]);a>0&&(i+=e[a-1].length,o.holes.push(i))}return o}},66678:(e,t,o)=>{o.d(t,{c:()=>s});var i=o(24648),a=o(7137),r=o(90659);const n=e=>({geodesicArea(t){const{spatialReference:o}=t;return(0,r.M0)(o,l,t=>function(e,t){try{return(0,i.gT)(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch(o){return null}}(e,t),t)}});async function s(){const e=await Promise.all([o.e(2612),o.e(2481)]).then(o.bind(o,62481));return n(e)}function l(e){return(0,i.gT)(Math.abs((0,a.qy)([e],"square-meters")[0]),"square-meters")}},68655:(e,t,o)=>{o.d(t,{f:()=>n});var i=o(9392),a=o(29772),r=o(23739);async function n(){return e=await(0,r.V)(),{autoLength2D:t=>{var o;return null!==(o=e.geodesicLength(t))&&void 0!==o?o:(0,a.Xg)(t)},autoDistanceBetweenPoints2D:(t,o)=>{var i;return null!==(i=e.geodesicDistanceBetweenPoints(t,o))&&void 0!==i?i:(0,a.ll)(t,o)},autoDistance2D:(t,o,i)=>{var r;return s[0]=t[0],s[1]=t[1],s[2]=3===t.length?t[2]:0,l[0]=o[0],l[1]=o[1],l[2]=3===o.length?o[2]:0,null!==(r=e.geodesicDistance(s,l,i))&&void 0!==r?r:(0,a.sT)(s,l,i)}};var e}const s=(0,i.vt)(),l=(0,i.vt)()},69120:(e,t,o)=>{o.d(t,{Nu:()=>s,Y3:()=>r,in:()=>n});var i=o(70445),a=o(31933);function r(e,t,o){if(!t||null===e||void 0===e||!e.map)return;const{map:i}=e,a=i.layers.find(e=>e===t);a||i.add(t,o),a&&null!=o&&i.layers.reorder(a,o)}function n(e,t){const o="subtype-sublayer"===(null===t||void 0===t?void 0:t.type)?t.parent:t;return e.allLayerViews.find(e=>{const t=e.layer;return t===o||"sublayers"in t&&null!=t.sublayers&&t.sublayers.includes(o)})}function s(e){return(0,i.S)(e)||(0,a.Sv)(e)||(0,a.V0)(e)||(0,a.UC)(e)}},78009:(e,t,o)=>{o.d(t,{EI:()=>c,lO:()=>f,qh:()=>u,u0:()=>m});var i=o(24648),a=o(31633),r=o(38983),n=o(20664),s=o(9392),l=o(14487),p=o(13927),d=o(45097),h=o(41868);function c(e){return v(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]})}function u(e){return v(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]},!1)}function v(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.hasZ;const r=(0,h.l)(e.spatialReference),c=(0,a.B5)(r);if(null==c)return null;const u=(e,t)=>!(t.length<2)&&((0,n.j)(e,t[0],t[1],o&&t[2]||0),!0);let v=0;for(const i of e.rings){const o=i.length;if(o<3)continue;const{positionsWorldCoords:a}=t;for(;a.length<o;)a.push((0,s.vt)());const h=y,c=(0,n.j)(g,0,0,0),m=1/o;for(let t=0;t<o;t++){if(!u(h,i[t]))return null;if(!(0,l.F)(h,e.spatialReference,a[t],r))return null;(0,n.c)(c,c,a[t],m)}const _=(0,p.Cr)(a[0],a[1],c,(0,p.LV)());if(0===(0,n.m)((0,p.Qj)(_)))continue;for(let e=0;e<o;e++)(0,p.Z1)(_,c,a[e],a[e]);const b=f(a);for(let e=0;e<b.length;e+=3)v+=(0,d.Fm)(a[b[e]],a[b[e+1]],a[b[e+2]])}return(0,i.gT)(v,c)}const y=(0,s.vt)(),g=(0,s.vt)();function m(){return{positionsWorldCoords:[]}}function f(e){return(0,r.e)(function(e){const t=new Float64Array(2*e.length);for(let o=0;o<e.length;++o){const i=e[o],a=2*o;t[a]=i[0],t[a+1]=i[1]}return t}(e),[],2)}}}]);
//# sourceMappingURL=1574.adcf7f51.chunk.js.map