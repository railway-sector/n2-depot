"use strict";(self.webpackChunkn2_depot=self.webpackChunkn2_depot||[]).push([[4089],{5109:(e,t,i)=>{i.d(t,{k:()=>o});var n=i(6326),s=i(68134),r=(i(76460),i(81806),i(47249),i(50076),i(87990)),a=i(56829);let o=class extends a.g{constructor(e){super(e)}initialize(){this.addHandles((0,s.wB)(()=>this.analysisViewData.visible,e=>this.visible=e,s.pc))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};o=(0,n.Cg)([(0,r.$)("esri.views.interactive.AnalysisToolBase")],o)},10260:(e,t,i)=>{i.d(t,{Hd:()=>l,ZX:()=>d,aS:()=>h,qW:()=>u});var n=i(98773),s=i(54901),r=i(30726),a=i(50346),o=i(68134);function l(e,t){return(0,o.wB)(()=>e.interactive,()=>function(e,t){e.interactive?function(e,t){h(e);const{view:i,analysis:n}=e,s=new t({view:i,analysis:n,analysisViewData:e});e.tool=s,i.tools.add(s)}(e,t):h(e)}(e,t),o.pc)}function h(e){const{view:t,tool:i}=e;null!=i&&(t.tools.remove(i),e.tool=null)}function u(e,t){var i;const l=e.userOperation,h=(0,n.UT)(async i=>{var h;if(l){const e=l.promise.catch(()=>{});null!==l&&void 0!==l&&l.abort(),await e,(0,a.Te)(i)}const u=function(e,t){e.interactive=!0;const{tool:i,view:s}=e;s.activeTool=i;let l=(0,a.u7)(t,()=>{s.activeTool===i&&(s.activeTool=null)});return(0,n.UT)(async t=>{await(0,o.C_)(()=>{var t;return!(null!==(t=e.tool)&&void 0!==t&&t.active)},t),l=(0,r.xt)(l)},t)}(e,{signal:i}),d=null!==(h=null===t||void 0===t?void 0:t.shouldRejectOnCancel)&&void 0!==h?h:()=>!0,c=(0,s.vE)([(0,o.on)(()=>e.tool,"cancel",()=>{d()&&u.abort()})]),{tool:p}=e;try{var g;p&&(p.resetCreated(),null!==t&&void 0!==t&&null!==(g=t.onToolActivated)&&void 0!==g&&g.call(t,p)),await u.promise,(0,a.Te)(i)}catch(v){if(i.aborted||!(0,a.zf)(v)||d())throw v}finally{null===c||void 0===c||c.remove()}},{signal:null===t||void 0===t||null===(i=t.abortOptions)||void 0===i?void 0:i.signal});return e.userOperation=h,h.promise.finally(()=>{e.userOperation===h&&(e.userOperation=null)})}async function d(e,t){const i=e.analysis.clone();return await u(e,{abortOptions:null===t||void 0===t?void 0:t.placementOptions,onToolActivated:null===t||void 0===t?void 0:t.onToolActivated,shouldRejectOnCancel:()=>{const{analysis:t}=e;return!t.valid||t.equals(i)}}),{}}},11113:(e,t,i)=>{i.d(t,{Ee:()=>l,Jd:()=>_,Nk:()=>c,OM:()=>m,Oo:()=>v,W4:()=>h,ix:()=>p,t_:()=>d,tr:()=>u,yh:()=>g,zJ:()=>a});var n=i(73582),s=i(24648),r=i(96820);function a(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,r.zJ)(e,(0,s.kM)(t,i).value,i,n,a)}function o(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,r.nD)(e,(0,s.kM)(t,i).value,i,n,a)}function l(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,r.Ee)(e,t.value,t.unit,i,n)}function h(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,r.W4)(e,t.value,t.unit,i,n)}function u(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,r.tr)(e,t.value,t.unit,i,n)}function d(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,r.t_)(e,t.value,t.unit,i,n)}function c(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.ie,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,r.Me)(e.value,e.unit,e.rotationType,t,i,s,a)}function p(e,t,i,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(n=null!==n&&void 0!==n?n:2,i){case"imperial":return u(e,t,n,s);case"metric":return l(e,t,n,s);default:return a(e,t,i,n,s)}}function g(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,r.J1)(e,t.value,t.unit,i,n)}(e,t,n,s);case"metric":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,r.Mm)(e,t.value,t.unit,i,n)}(e,t,n,s);default:return o(e,t,i,n,s)}}function v(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return d(e,t,n,s);case"metric":return h(e,t,n,s);default:return a(e,t,i,n,s)}}function m(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,r.LF)(e,t.value,t.unit,i,n)}(e,t,n,s);case"metric":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,r.e_)(e,t.value,t.unit,i,n)}(e,t,n,s);default:return o(e,t,i,n,s)}}function _(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,r.Sz)(e,t.value,t.unit,i,n)}(e,t,n,s);case"metric":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,r.zq)(e,t.value,t.unit,i,n)}(e,t,n,s);default:return a(e,t,i,n,s)}}},14318:(e,t,i)=>{i.d(t,{O:()=>d});var n=i(89379),s=i(6326),r=i(91967),a=i(30726),o=i(50346),l=i(46053),h=(i(81806),i(76460),i(47249),i(87990)),u=i(59752);let d=class extends r.A{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,o.sg)(async(e,t,i,s)=>{const r=this._frameTask;if(null==r)return;const a=await r.schedule(()=>t.snap((0,n.A)((0,n.A)({},e),{},{context:i,signal:s})),s);a.valid&&await r.schedule(()=>{this.stagedPoint=a.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update((0,n.A)((0,n.A)({},this._snapPoints),{},{context:i})))},s)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var e;const t="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(e=e.resourceController)||void 0===e?void 0:e.scheduler:null;this._frameTask=null!=t?t.registerTask(u.W6.SNAPPING):u.nu}destroy(){this._abortController=(0,a.DC)(this._abortController),this._frameTask=(0,a.xt)(this._frameTask)}update(e,t,i){this._snapPoints=e;const{point:n,scenePoint:s}=e,r=t.update({point:n,scenePoint:s,context:i});return this.stagedPoint=r,r}async snap(e,t,i){const{point:n,scenePoint:s}=e;return this.stagedPoint=t.update({point:n,scenePoint:s,context:i}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,a.DC)(this._abortController),this._snapPoints=null}};(0,s.Cg)([(0,l.MZ)({constructOnly:!0})],d.prototype,"view",void 0),(0,s.Cg)([(0,l.MZ)()],d.prototype,"stagedPoint",null),(0,s.Cg)([(0,l.MZ)()],d.prototype,"constrainResult",void 0),(0,s.Cg)([(0,l.MZ)()],d.prototype,"_stagedPoint",void 0),d=(0,s.Cg)([(0,h.$)("esri.views.interactive.snapping.SnappingOperation")],d)},38983:(e,t,i)=>{function n(e,t,i){i=i||2;var n,r,o,l,h,u,c,p=t&&t.length,g=p?t[0]*i:e.length,v=s(e,0,g,i,!0),m=[];if(!v||v.next===v.prev)return m;if(p&&(v=d(e,t,v,i)),e.length>80*i){n=o=e[0],r=l=e[1];for(var _=i;_<g;_+=i)(h=e[_])<n&&(n=h),(u=e[_+1])<r&&(r=u),h>o&&(o=h),u>l&&(l=u);c=0!==(c=Math.max(o-n,l-r))?1/c:0}return a(v,m,i,n,r,c),m}function s(e,t,i,n,s){var r,a;if(s===Z(e,t,i,n)>0)for(r=t;r<i;r+=n)a=L(r,e[r],e[r+1],a);else for(r=i-n;r>=t;r-=n)a=L(r,e[r],e[r+1],a);if(a&&M(a,a.next)){var o=a.next;D(a),a=o}return a}function r(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!M(n,n.next)&&0!==x(n.prev,n,n.next))n=n.next;else{var s=n.prev;if(D(n),(n=t=s)===n.next)break;i=!0}}while(i||n!==t);return t}function a(e,t,i,n,s,d,c){if(e){!c&&d&&m(e,n,s,d);for(var p,g,v=e;e.prev!==e.next;)if(p=e.prev,g=e.next,d?l(e,n,s,d):o(e))t.push(p.i/i),t.push(e.i/i),t.push(g.i/i),D(e),e=g.next,v=g.next;else if((e=g)===v){c?1===c?a(e=h(r(e),t,i),t,i,n,s,d,2):2===c&&u(e,t,i,n,s,d):a(r(e),t,i,n,s,d,1);break}}}function o(e){var t=e.prev,i=e,n=e.next;if(x(t,i,n)>=0)return!1;for(var s=e.next.next;s!==e.prev;){if(y(t.x,t.y,i.x,i.y,n.x,n.y,s.x,s.y)&&x(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function l(e,t,i,n){var s=e.prev,r=e,a=e.next;if(x(s,r,a)>=0)return!1;for(var o=s.x<r.x?s.x<a.x?s.x:a.x:r.x<a.x?r.x:a.x,l=s.y<r.y?s.y<a.y?s.y:a.y:r.y<a.y?r.y:a.y,h=s.x>r.x?s.x>a.x?s.x:a.x:r.x>a.x?r.x:a.x,u=s.y>r.y?s.y>a.y?s.y:a.y:r.y>a.y?r.y:a.y,d=_(o,l,t,i,n),c=_(h,u,t,i,n),p=e.prevZ,g=e.nextZ;p&&p.z>=d&&g&&g.z<=c;){if(p!==e.prev&&p!==e.next&&y(s.x,s.y,r.x,r.y,a.x,a.y,p.x,p.y)&&x(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,g!==e.prev&&g!==e.next&&y(s.x,s.y,r.x,r.y,a.x,a.y,g.x,g.y)&&x(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&y(s.x,s.y,r.x,r.y,a.x,a.y,p.x,p.y)&&x(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=c;){if(g!==e.prev&&g!==e.next&&y(s.x,s.y,r.x,r.y,a.x,a.y,g.x,g.y)&&x(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function h(e,t,i){var n=e;do{var s=n.prev,a=n.next.next;!M(s,a)&&C(s,n,n.next,a)&&V(s,a)&&V(a,s)&&(t.push(s.i/i),t.push(n.i/i),t.push(a.i/i),D(n),D(n.next),n=e=a),n=n.next}while(n!==e);return r(n)}function u(e,t,i,n,s,o){var l=e;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&w(l,h)){var u=S(l,h);return l=r(l,l.next),u=r(u,u.next),a(l,t,i,n,s,o),void a(u,t,i,n,s,o)}h=h.next}l=l.next}while(l!==e)}function d(e,t,i,n){var a,o,l,h=[];for(a=0,o=t.length;a<o;a++)(l=s(e,t[a]*n,a<o-1?t[a+1]*n:e.length,n,!1))===l.next&&(l.steiner=!0),h.push(f(l));for(h.sort(c),a=0;a<h.length;a++)i=r(i=g(h[a],i),i.next);return i}function c(e,t){return e.x-t.x}function p(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function g(e,t){var i=function(e,t){var i,n=t,s=e.x,r=e.y,a=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var o=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=s&&o>a){if(a=o,o===s){if(r===n.y)return n;if(r===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(s===a)return i;var l,h=i,u=i.x,d=i.y,c=1/0;n=i;do{s>=n.x&&n.x>=u&&s!==n.x&&y(r<d?s:a,r,u,d,r<d?a:s,r,n.x,n.y)&&(l=Math.abs(r-n.y)/(s-n.x),V(n,e)&&(l<c||l===c&&(n.x>i.x||n.x===i.x&&v(i,n)))&&(i=n,c=l)),n=n.next}while(n!==h);return i}(e,t);if(!i)return t;var n=S(i,e),s=r(i,i.next);let a=p(n);return r(a,a.next),s=p(s),p(t===i?s:t)}function v(e,t){return x(e.prev,e,t.prev)<0&&x(t.next,e,e.next)<0}function m(e,t,i,n){var s=e;do{null===s.z&&(s.z=_(s.x,s.y,t,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){var t,i,n,s,r,a,o,l,h=1;do{for(i=e,e=null,r=null,a=0;i;){for(a++,n=i,o=0,t=0;t<h&&(o++,n=n.nextZ);t++);for(l=h;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(s=i,i=i.nextZ,o--):(s=n,n=n.nextZ,l--),r?r.nextZ=s:e=s,s.prevZ=r,r=s;i=n}r.nextZ=null,h*=2}while(a>1)}(s)}function _(e,t,i,n,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function y(e,t,i,n,s,r,a,o){return(s-a)*(t-o)-(e-a)*(r-o)>=0&&(e-a)*(n-o)-(i-a)*(t-o)>=0&&(i-a)*(r-o)-(s-a)*(n-o)>=0}function w(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&C(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(V(e,t)&&V(t,e)&&function(e,t){var i=e,n=!1,s=(e.x+t.x)/2,r=(e.y+t.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(x(e.prev,e,t.prev)||x(e,t.prev,t))||M(e,t)&&x(e.prev,e,e.next)>0&&x(t.prev,t,t.next)>0)}function x(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function M(e,t){return e.x===t.x&&e.y===t.y}function C(e,t,i,n){var s=P(x(e,t,i)),r=P(x(e,t,n)),a=P(x(i,n,e)),o=P(x(i,n,t));return s!==r&&a!==o||!(0!==s||!b(e,i,t))||!(0!==r||!b(e,n,t))||!(0!==a||!b(i,e,n))||!(0!==o||!b(i,t,n))}function b(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function P(e){return e>0?1:e<0?-1:0}function V(e,t){return x(e.prev,e,e.next)<0?x(e,t,e.next)>=0&&x(e,e.prev,t)>=0:x(e,t,e.prev)<0||x(e,e.next,t)<0}function S(e,t){var i=new A(e.i,e.x,e.y),n=new A(t.i,t.x,t.y),s=e.next,r=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function L(e,t,i,n){var s=new A(e,t,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function D(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function A(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Z(e,t,i,n){for(var s=0,r=t,a=i-n;r<i;r+=n)s+=(e[a]-e[r])*(e[r+1]+e[a+1]),a=r;return s}i.d(t,{e:()=>n}),n.deviation=function(e,t,i,n){var s=t&&t.length,r=s?t[0]*i:e.length,a=Math.abs(Z(e,0,r,i));if(s)for(var o=0,l=t.length;o<l;o++){var h=t[o]*i,u=o<l-1?t[o+1]*i:e.length;a-=Math.abs(Z(e,h,u,i))}var d=0;for(o=0;o<n.length;o+=3){var c=n[o]*i,p=n[o+1]*i,g=n[o+2]*i;d+=Math.abs((e[c]-e[g])*(e[p+1]-e[c+1])-(e[c]-e[p])*(e[g+1]-e[c+1]))}return 0===a&&0===d?0:Math.abs((d-a)/a)},n.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,s=0;s<e.length;s++){for(var r=0;r<e[s].length;r++)for(var a=0;a<t;a++)i.vertices.push(e[s][r][a]);s>0&&(n+=e[s-1].length,i.holes.push(n))}return i}},46576:(e,t,i)=>{i.d(t,{T:()=>s});var n=i(96342);function s(e){const t=new n.n(e);return t.options.store=0,t.options.excludeLabels=!0,t}},66678:(e,t,i)=>{i.d(t,{c:()=>o});var n=i(24648),s=i(7137),r=i(90659);const a=e=>({geodesicArea(t){const{spatialReference:i}=t;return(0,r.M0)(i,l,t=>function(e,t){try{return(0,n.gT)(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch(i){return null}}(e,t),t)}});async function o(){const e=await Promise.all([i.e(2612),i.e(2481)]).then(i.bind(i,62481));return a(e)}function l(e){return(0,n.gT)(Math.abs((0,s.qy)([e],"square-meters")[0]),"square-meters")}},75218:(e,t,i)=>{i.d(t,{X:()=>h});var n=i(89379),s=i(54901),r=i(77944),a=i(18295),o=i(64344);const l=new Map;function h(e){if(!l.has(e)){const t=(0,a.B)(e,{distance:10}),i=function(e,t){return new o.g({view:e,options:t})}(e,t.options);l.set(e,{referenceCount:0,snappingManager:i,remove:()=>{t.remove(),i.destroy()}})}const t=l.get(e);t.referenceCount++;const i=(0,s.hA)(()=>{return i=e,(n=t).referenceCount--,void(n.referenceCount>0||(0,r.d)(()=>{0===n.referenceCount&&(n.remove(),l.delete(i))}));var i,n});return(0,n.A)({snappingManager:t.snappingManager},i)}},77515:(e,t,i)=>{i.d(t,{CL:()=>d,Gc:()=>p,OK:()=>u,s7:()=>g,uc:()=>l,zS:()=>c});var n=i(20664),s=i(9392),r=i(65215),a=i(78315),o=i(94966);function l(e,t){const i=(0,n.j)(h,0,0,0);for(let r=0;r<e.length;++r)(0,n.g)(i,i,e[r]);(0,n.h)(i,i,1/e.length);let s=0;for(let r=0;r<e.length;++r)s=Math.max(s,(0,n.s)(i,e[r]));(0,a.e)(t,i,Math.sqrt(s))}const h=(0,s.vt)();function u(e,t){if(e.length<3)throw new Error("need at least 3 points to fit a plane");(0,o.e9)(e[0],e[1],e[2],t)}function d(e,t){return(0,n.f)(e,t)+e[3]}function c(e,t,i,s,r){let{geodesicArea:a}=r;const o=v;return(0,n.d)(o.rings[0][0],e),(0,n.d)(o.rings[0][1],t),(0,n.d)(o.rings[0][2],i),(0,n.d)(o.rings[0][3],e),o.spatialReference=s,o.clearCache(),a(o)}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=(e,t)=>{if(0===t[0]&&0===t[1]&&0===t[2])return!1;for(let i=0;i<e.length;++i)if((0,n.f)(t,e[i])<-1e-6)return!1;return!0};if(0===e.length)return!1;if(1===e.length)return t&&(0,n.d)(t,e[0]),!0;(0,n.j)(m,0,0,0);for(let r=0;r<e.length;++r)(0,n.g)(m,m,e[r]);if((0,n.n)(m,m),s(e,m))return t&&(0,n.d)(t,m),!0;if(!i)return!1;for(let r=0;r<e.length;++r)for(let i=0;i<e.length;++i)if(r!==i&&((0,n.i)(m,e[r],e[i]),(0,n.n)(m,m),s(e,m)))return t&&(0,n.d)(t,m),!0;return!1}function g(e){return"mouse"!==e.pointerType||0===e.button}const v=new r.A({hasM:!1,hasZ:!0,rings:[[(0,s.vt)(),(0,s.vt)(),(0,s.vt)(),(0,s.vt)()]],spatialReference:null}),m=(0,s.vt)()},78009:(e,t,i)=>{i.d(t,{EI:()=>c,lO:()=>f,qh:()=>p,u0:()=>_});var n=i(24648),s=i(31633),r=i(38983),a=i(20664),o=i(9392),l=i(14487),h=i(13927),u=i(45097),d=i(41868);function c(e){return g(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]})}function p(e){return g(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]},!1)}function g(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.hasZ;const r=(0,d.l)(e.spatialReference),c=(0,s.B5)(r);if(null==c)return null;const p=(e,t)=>!(t.length<2)&&((0,a.j)(e,t[0],t[1],i&&t[2]||0),!0);let g=0;for(const n of e.rings){const i=n.length;if(i<3)continue;const{positionsWorldCoords:s}=t;for(;s.length<i;)s.push((0,o.vt)());const d=v,c=(0,a.j)(m,0,0,0),_=1/i;for(let t=0;t<i;t++){if(!p(d,n[t]))return null;if(!(0,l.F)(d,e.spatialReference,s[t],r))return null;(0,a.c)(c,c,s[t],_)}const y=(0,h.Cr)(s[0],s[1],c,(0,h.LV)());if(0===(0,a.m)((0,h.Qj)(y)))continue;for(let e=0;e<i;e++)(0,h.Z1)(y,c,s[e],s[e]);const w=f(s);for(let e=0;e<w.length;e+=3)g+=(0,u.Fm)(s[w[e]],s[w[e+1]],s[w[e+2]])}return(0,n.gT)(g,c)}const v=(0,o.vt)(),m=(0,o.vt)();function _(){return{positionsWorldCoords:[]}}function f(e){return(0,r.e)(function(e){const t=new Float64Array(2*e.length);for(let i=0;i<e.length;++i){const n=e[i],s=2*i;t[s]=n[0],t[s+1]=n[1]}return t}(e),[],2)}},86401:(e,t,i)=>{i.d(t,{Ci:()=>s,KL:()=>o,dB:()=>a,l5:()=>r,wB:()=>l});var n=i(48549);const s=(0,n.BP)().vec3f("position").freeze(),r=(0,n.BP)().vec3f("position").vec2f16("uv0").freeze(),a=(0,n.BP)().vec3f("position").vec4u8("color").freeze(),o=(0,n.BP)().vec3f("position").vec2f("uv0").freeze(),l=(0,n.BP)().vec3f("position").vec2f("uv0").vec4u8("olidColor").freeze()},87230:(e,t,i)=>{i.d(t,{C:()=>m,b:()=>v});var n,s,r=i(57528),a=i(26917),o=i(94192),l=i(80883),h=i(3799),u=i(95756),d=i(58350),c=i(86955),p=i(91911),g=i(2687);function v(e){const t=new g.N5,{vertex:i,fragment:v,varyings:m}=t;return t.fragment.include(a.HQ,e),t.include(o.Z,e),t.include(p.z,e),(0,h.NB)(i,e),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),m.add("vUV","vec2"),m.add("vpos","vec3"),i.main.add((0,c.H)(n||(n=(0,r.A)(["vUV = uv0;\nvpos = position;\nforwardViewPosDepth((view * vec4(position, 1.0)).xyz);\ngl_Position = proj * view * vec4(position, 1.0);"])))),v.uniforms.add(new u.G("size",e=>e.size)),v.uniforms.add(new d.E("color1",e=>e.color1)),v.uniforms.add(new d.E("color2",e=>e.color2)),v.include(l.a),v.main.add((0,c.H)(s||(s=(0,r.A)(["discardByTerrainDepth();\nvec2 uvScaled = vUV / (2.0 * size);\nvec2 uv = fract(uvScaled - 0.25);\nvec2 ab = clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\nfloat fade = smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\nfloat t = mix(abs(ab.x + ab.y), 0.5, fade);\nfragColor = mix(color2, color1, t);\noutputColorHighlightOID(fragColor, vpos, fragColor.rgb);"])))),t}const m=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},94089:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Ct});var n=i(6326),s=(i(81806),i(30726)),r=i(46053),a=i(76460),o=(i(47249),i(87990)),l=i(19747),h=i(72205),u=i(91967),d=i(68134),c=i(15941),p=i(24648),g=i(31633),v=i(19555),m=i(72745),_=i(20664),f=i(9392),y=i(55855),w=i(34111),x=i(56611),M=i(98510),C=i(14487);function b(e,t,i,n,s){(0,_.d)(P,e),(0,_.g)(V,e,t),(0,C.F)(P,i,P,s),(0,C.F)(V,i,V,s),(0,_.e)(n,V,P),(0,_.n)(n,n)}const P=(0,f.vt)(),V=(0,f.vt)();var S=i(64232),L=i(38496),D=i(65658),A=i(78315),Z=i(45097),R=i(77515),O=i(80935),z=i(94966),T=i(78009),k=i(29772),G=i(90659),H=i(41868);class I{get numVertices(){return this._length}get hasStagedVertex(){return null!=this._lastCursorPoint}constructor(e,t,i){var n,s;this._sceneView=e,this._geodesicAreaMeasurementUtils=t,this._geodesicLengthMeasurementUtils=i,this.validMeasurement=!1,this.positionsWorld=[],this.positionsRender=[],this.positionsFittedWorld=[],this.positionsFittedRender=[],this.positionsGeodesic=[],this.positionsSpherical=[],this.positionsStereographic=[],this.pathSegmentLengths=[],this.geodesicPathSegmentLengths=[],this.perimeterSegmentLengths=[],this.intersectingSegments=new Set,this.geodesicIntersectingSegments=new Set,this.triangleIndices=null,this.geodesicTriangleIndices=null,this.areaCentroidWorldCoords=(0,f.vt)(),this.areaCentroidRenderCoords=(0,f.vt)(),this.geodesicAreaCentroidRenderCoords=(0,f.vt)(),this.fittingMode=null,this.area=null,this.geodesicArea=null,this.pathLength=null,this.geodesicPathLength=null,this.perimeterLength=null,this._length=0,this._centroidRenderCoords=(0,f.vt)(),this._planeWorldCoords=(0,y.vt)(),this._worldUp=(0,f.vt)(),this._worldTangent=(0,f.vt)(),this._frame=[(0,f.vt)(),(0,f.vt)(),(0,f.vt)()],this._lastPathVersion=-1,this._lastCursorPoint=null,this._mode=null,this._tempU=(0,f.vt)(),this._tempV=(0,f.vt)(),this._tempVec3=(0,f.vt)(),this._tempSphere=(0,A.c)();const r=(0,H.l)(e.spatialReference);this._measurementSR=r,this._lengthMeasurementUnit=null!==(n=(0,g._H)(r))&&void 0!==n?n:"meters",this._areaMeasurementUnit=null!==(s=(0,g.B5)(r))&&void 0!==s?s:"square-meters"}update(e,t,i,n,s,r){const a=this._lastPathVersion===e.version,o=t?t.equals(this._lastCursorPoint):null==this._lastCursorPoint,l=this._mode===s;return!(a&&!r&&l&&o)&&(this._lastPathVersion=e.version,this._lastCursorPoint=t,this._updateCursorSegmentLength(e,t),this._update(e,t,i,n,s),!0)}_update(e,t,i,n,s){const r=this._sceneView.renderSpatialReference,a=this._measurementSR,o=i.spatialReference;let l=e.numVertices;const h=!(null==t||t.equals(e.lastPoint)||l>2&&t.equals(e.firstPoint)||e.polygonIsClosed);h&&(l+=1);const u=!e.polygonIsClosed&&l>2,d=e.polygonIsClosed||u;this._resize(l);const c=(0,M.lO)(o),g=null!=o&&(0,G.yF)(o)?o:null,v=null!=g&&(0,x.canProjectWithoutEngine)(o,c),{positionsGeodesic:m,positionsWorld:f,positionsRender:y,positionsSpherical:w}=this,C=(e,t)=>{(function(e,t){var i;t.hasZ||(t.z=null!==(i=(0,O.R1)(e,t,"ground"))&&void 0!==i?i:0)})(i.elevationProvider,e),(0,S.g)(e,f[t],a),(0,S.g)(e,y[t],r),v&&((0,S.g)(e,m[t],g),(0,S.g)(e,w[t],c),(0,_.n)(w[t],w[t]))};e.forEachVertexPosition((e,t)=>C(e,t)),h&&C(t,l-1);const b=this._updatePathLengths(d);if(this.pathLength=this._length>1?(0,p.d_)(b,this._lengthMeasurementUnit):null,v){const e=this._updateGeodesicPathLengths(d,g);this.geodesicPathLength=null!=e&&this._length>1?e:null}else this.geodesicPathLength=null;if(this._updateMode(s),!d)return this.area=null,this.geodesicArea=null,this.perimeterLength=null,this.triangleIndices=null,this.geodesicTriangleIndices=null,this.intersectingSegments.clear(),this.geodesicIntersectingSegments.clear(),void(this.validMeasurement=!1);this._updateAreaAndPerimeterLength(i,r,a,n),v&&this._updateGeodesicArea(i,g),this.validMeasurement=!0}getData(){return{validMeasurement:this.validMeasurement,numVertices:this.numVertices,hasStagedVertex:this.hasStagedVertex,positionsRender:this.positionsRender,positionsFittedWorld:this.positionsFittedWorld,positionsFittedRender:this.positionsFittedRender,intersectingSegments:this.intersectingSegments,geodesicIntersectingSegments:this.geodesicIntersectingSegments,triangleIndices:this.triangleIndices,geodesicTriangleIndices:this.geodesicTriangleIndices,areaCentroidRenderCoords:this.areaCentroidRenderCoords,geodesicAreaCentroidRenderCoords:this.geodesicAreaCentroidRenderCoords,area:this.area,geodesicArea:this.geodesicArea,pathLength:this.pathLength,geodesicPathLength:this.geodesicPathLength,perimeterLength:this.perimeterLength,actualMeasurementMode:this.actualMeasurementMode}}_resize(e){for(e<this._length&&(this.positionsWorld.length=e,this.positionsRender.length=e,this.positionsFittedWorld.length=e,this.positionsFittedRender.length=e,this.positionsGeodesic.length=e,this.positionsSpherical.length=e,this.positionsStereographic.length=e,this.pathSegmentLengths.length=e,this.geodesicPathSegmentLengths.length=e,this.perimeterSegmentLengths.length=e,this._length=e);this._length<e;)this.positionsWorld.push((0,f.vt)()),this.positionsRender.push((0,f.vt)()),this.positionsFittedWorld.push((0,m.vt)()),this.positionsFittedRender.push((0,f.vt)()),this.positionsGeodesic.push((0,f.vt)()),this.positionsSpherical.push((0,f.vt)()),this.positionsStereographic.push((0,m.vt)()),this.pathSegmentLengths.push(0),this.geodesicPathSegmentLengths.push(0),this.perimeterSegmentLengths.push(0),++this._length}_updatePathLengths(e){const t=this.positionsWorld,i=this.pathSegmentLengths;let n=0;const s=this._length;for(let r=0;r<s;++r){const a=i[r]=(0,_.k)(t[r],t[(r+1)%s]);(r<s-1||e)&&(n+=a)}return n}_updateGeodesicPathLengths(e,t){const i=this.positionsGeodesic,n=this.geodesicPathSegmentLengths;let s=0;const r=this._length;for(let a=0;a<r;++a){const o=this._geodesicLengthMeasurementUtils.geodesicDistance(i[a],i[(a+1)%r],t);if(null==o)return null;const l=(0,p.kM)(o,"meters").value,h=n[a]=l;(a<r-1||e)&&(s+=h)}return(0,p.d_)(s,"meters")}_updateAreaAndPerimeterLength(e,t,i,n){const s=e.renderCoordsHelper,r=this.positionsWorld,a=this.positionsRender,o=this.positionsFittedWorld,l=this.positionsFittedRender,h=this._planeWorldCoords,u=this._centroidRenderCoords;(0,z.ix)(a,u),s.worldUpAtPosition(u,this._worldUp),s.worldBasisAtPosition(u,0,this._worldTangent),b(u,this._worldUp,t,this._worldUp,i),b(u,this._worldTangent,t,this._worldTangent,i),r.length>2&&(0,R.OK)(r,h),this.fittingMode=this._selectFittingMode(h,r,this._worldUp,n);let d=0;if("horizontal"===this.fittingMode){let e=-1/0;a.forEach((t,i)=>{const n=s.getAltitude(a[i]);n>e&&(e=n,d=i)})}const c=r[d];let p=h,g=this._worldTangent;"horizontal"===this.fittingMode?p=this._worldUp:"vertical"===this.fittingMode&&(p=this._tempVec3,g=this._worldUp,(0,z.YH)(h,this._worldUp,p)),(0,_.d)(this._frame[2],p),(0,z.YH)(g,p,this._frame[0]),(0,_.i)(this._frame[1],this._frame[0],this._frame[2]),(0,_.u)(this._frame[1],this._frame[1]);const m=this._tempVec3,f=this._tempU,y=this._tempV;for(let w=0;w<this._length;++w){const e=o[w],n=l[w];(0,_.e)(m,r[w],c),(0,v.hZ)(e,(0,_.f)(this._frame[0],m),(0,_.f)(this._frame[1],m)),(0,_.h)(f,this._frame[0],e[0]),(0,_.h)(y,this._frame[1],e[1]),(0,_.g)(m,f,y),(0,_.g)(m,m,c),(0,C.F)(m,i,n,t)}this.perimeterLength=this._length>0?this._updatePerimeterLengths():null,(0,z.ix)(l,this.areaCentroidRenderCoords),(0,C.F)(this.areaCentroidRenderCoords,t,this.areaCentroidWorldCoords,i),this._updateIntersectingSegments(),this.area=0===this.intersectingSegments.size?this._computeArea():null}_updateGeodesicArea(e,t){const{renderCoordsHelper:i,spatialReference:n}=e,{positionsSpherical:s,positionsStereographic:r}=this,a=this._tempVec3,o=(0,R.Gc)(s,a);if(!o)return void(this.geodesicArea=null);const l=this._tempU,h=this._tempV;(0,z.VV)(a,l,h);for(let u=0;u<this._length;++u){const e=(0,_.f)(s[u],l),t=(0,_.f)(s[u],h),i=(0,_.f)(s[u],a);(0,v.hZ)(r[u],e/i,t/i)}(0,_.h)(a,a,(0,w.tO)(n).radius),i.toRenderCoords(a,(0,M.lO)(n),this.geodesicAreaCentroidRenderCoords),this._updateGeodesicIntersectingSegments(),this.geodesicArea=o&&0===this.geodesicIntersectingSegments.size?this._computeGeodesicArea(t):null}_updatePerimeterLengths(){const e=this.positionsFittedWorld,t=this.perimeterSegmentLengths;let i=0;for(let n=0;n<this._length;++n)i+=t[n]=(0,v.Io)(e[n],e[(n+1)%this._length]);return(0,p.d_)(i,this._lengthMeasurementUnit)}_updateIntersectingSegments(){const e=this.positionsFittedWorld,t=this.intersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let n=i+2;n<this._length;++n){if((n+1)%this._length===i)continue;const s=e[i],r=e[(i+1)%this._length],a=e[n],o=e[(n+1)%this._length];(0,D.Ql)(s,r,a,o)&&(t.add(i),t.add(n))}}_computeArea(){const e=this.positionsFittedWorld,t=this.triangleIndices=(0,L.Dg)((0,T.lO)(e));let i=0;for(let n=0;n<t.length;n+=3)i+=(0,Z.Fm)(e[t[n]],e[t[n+1]],e[t[n+2]]);return(0,p.gT)(i,this._areaMeasurementUnit)}_updateGeodesicIntersectingSegments(){const e=this.positionsStereographic,t=this.geodesicIntersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let n=i+2;n<this._length;++n){if((n+1)%this._length===i)continue;const s=e[i],r=e[(i+1)%this._length],a=e[n],o=e[(n+1)%this._length];(0,D.Ql)(s,r,a,o)&&(t.add(i),t.add(n))}}_computeGeodesicArea(e){const t=this.positionsGeodesic,i=this.positionsStereographic,n=this.geodesicTriangleIndices=(0,L.Dg)((0,T.lO)(i));let s=0;for(let r=0;r<n.length;r+=3){const i=(0,R.zS)(t[n[r]],t[n[r+1]],t[n[r+2]],e,this._geodesicAreaMeasurementUtils);if(null==i)return null;s+=(0,p.kM)(i,"square-meters").value}return(0,p.gT)(s,"square-meters")}_selectFittingMode(e,t,i,n){const s=t.map(t=>Math.abs((0,R.CL)(e,t))).reduce((e,t)=>Math.max(e,t),0);(0,R.uc)(t,this._tempSphere);const r=s/(2*this._tempSphere[3]),a=r<n.maxRelativeErrorCoplanar,o=r<n.maxRelativeErrorAlmostCoplanar;let l="horizontal";return a?l="oblique":o&&(l=Math.abs((0,_.f)(i,e))>Math.cos((0,c.kU)(n.verticalAngleThreshold))?"horizontal":"vertical"),l}_updateCursorSegmentLength(e,t){var i;const n=e.lastPoint;e.isValidPolygon||null==n||null==t?(this.geodesicStagedSegmentLength=null,this.stagedSegmentLength=null):(this.geodesicStagedSegmentLength=this._geodesicLengthMeasurementUtils.geodesicDistanceBetweenPoints(n,t),this.stagedSegmentLength=null===(i=(0,k.NH)(n,t))||void 0===i?void 0:i.direct)}_updateMode(e){if(0===e){this.actualMeasurementMode="euclidean";let e=0;null!=this.geodesicPathLength&&(e+=this.geodesicPathLength.value),e>E&&(this.actualMeasurementMode="geodesic")}else this.actualMeasurementMode=1===e?"euclidean":"geodesic";null==this.geodesicPathLength&&(this.actualMeasurementMode="euclidean"),this._mode=e}}const E=1e5;let W=class extends u.A{constructor(e){super(e)}initialize(){this._measurementDataManager=new I(this.view,this.geodesicAreaMeasurementUtils,this.geodesicLengthMeasurementUtils),this.addHandles([this.analysisViewData.path.on("change",()=>this._update()),(0,d.wB)(()=>this.analysisViewData.stagedPoint,()=>this._update(),d.OH),(0,d.wB)(()=>this.analysisViewData.mode,()=>this._update(),d.OH)]),this._update()}_update(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{analysisViewData:t,view:i}=this;this._measurementDataManager.update(t.path,t.stagedPoint,i,{maxRelativeErrorCoplanar:.005,maxRelativeErrorAlmostCoplanar:.01,verticalAngleThreshold:80},t.mode,e)&&(t.measurementData=this._measurementDataManager.getData())}};(0,n.Cg)([(0,r.MZ)({constructOnly:!0})],W.prototype,"view",void 0),(0,n.Cg)([(0,r.MZ)({constructOnly:!0})],W.prototype,"analysis",void 0),(0,n.Cg)([(0,r.MZ)({constructOnly:!0})],W.prototype,"analysisViewData",void 0),(0,n.Cg)([(0,r.MZ)({constructOnly:!0})],W.prototype,"geodesicAreaMeasurementUtils",void 0),(0,n.Cg)([(0,r.MZ)({constructOnly:!0})],W.prototype,"geodesicLengthMeasurementUtils",void 0),W=(0,n.Cg)([(0,o.$)("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurementController")],W);var F=i(54099),B=i(19247),U=i(2413),q=i(17430),j=i(89238),N=i(974),J=i(56497);let Q=class extends F.nJ{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this._version=0,this._internalGeometryChange=!1,this._extent=(0,U.Ie)()}set areaMeasurement(e){this._set("areaMeasurement",e),null!=e&&null!=this.view&&this._initialize(e,this.view)}set view(e){this._set("view",e),null!=e&&null!=this.areaMeasurement&&this._initialize(this.areaMeasurement,e)}get constructed(){return null!=this.areaMeasurement&&null!=this.view}get version(){return this._version}get isEmptyPolygon(){return!this.constructed||0===this._editGeometry.parts.length}get isValidPolygon(){return this.constructed&&this.polygonIsClosed}get extent(){var e;if(this.constructed&&null!==(e=this._editGeometry.parts[0])&&void 0!==e&&e.vertices.length){const e=(0,U.Ie)(this._extent);return this.forEachVertex(t=>{(0,U.tK)(e,t.pos)}),e}return null}get spatialReference(){return this.constructed?this._editGeometry.coordinateHelper.spatialReference:null}_initialize(e,t){this.removeAllHandles(),this.addHandles((0,d.wB)(()=>e.geometry,()=>{this._updateEditGeometryFromModelGeometry(e,t)},d.pc)),this._makeDirty(!0)}_makeDirty(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.notifyChange("polygonIsClosed"),this.notifyChange("isValidPolygon"),this.notifyChange("initialized"),this.notifyChange("extent"),e&&this.notifyChange("numVertices")}_updateEditGeometryFromModelGeometry(e,t){if(this._version++,this._internalGeometryChange)return;this.removeHandles("EditGeometry");let i=e.geometry;if(null!=i){const n=(0,x.tryProjectWithZConversion)(i,t.spatialReference);null==n&&(0,q.V)(e,i.spatialReference,a.A.getLogger(this)),i=n}this._editGeometryOperations=null!=i?J.p.fromGeometry(i,t.state.viewingMode):new J.p(new N.ZE("polygon",(0,j.BV)(!0,!1,t.spatialReference)),t.state.viewingMode),this._makeDirty(!0),this.emit("change"),this.addHandles(this._editGeometry.on("change",t=>{this._makeDirty(null!=t.addedVertices||null!=t.removedVertices),this._internalGeometryChange=!0,e.geometry=this.numVertices>0?this._editGeometry.geometry:null,this._internalGeometryChange=!1}),"EditGeometry")}get _editGeometry(){return this._editGeometryOperations.data}get vertices(){const e=[];return this.forEachVertex(t=>{e.push(t)}),e}get numVertices(){var e,t;return this.constructed&&null!==(e=null===(t=this._editGeometry.parts[0])||void 0===t?void 0:t.vertices.length)&&void 0!==e?e:0}get polygonIsClosed(){var e,t;return null!==(e=null===(t=this._editGeometry.parts[0])||void 0===t?void 0:t.isClosed())&&void 0!==e&&e}get firstPoint(){if(this.constructed){var e;const{coordinateHelper:t,parts:i}=this._editGeometry,n=null===(e=i[0])||void 0===e?void 0:e.getFirstVertex();if(null!=n)return t.vectorToPoint(n.pos)}return null}get lastPoint(){if(this.constructed){var e;const{coordinateHelper:t,parts:i}=this._editGeometry,n=null===(e=i[0])||void 0===e?void 0:e.getLastVertex();if(null!=n)return t.vectorToPoint(n.pos)}return null}getVertex(e){var t;if(!this.constructed||null===(t=this._editGeometry.parts[0])||void 0===t||!t.vertices.length)return null;const i=this._editGeometry.parts[0].vertices[0];let n=i;do{if(n.index===e)return n;n=n.rightSegment.rightVertex}while(n!==i&&null!=n);return null}getVertexPositionAsPoint(e){return this._editGeometry.coordinateHelper.vectorToPoint(e.pos)}getVertexPositionAsPointFromIndex(e){return this._editGeometry.coordinateHelper.vectorToPoint(this.getVertex(e).pos)}forEachVertex(e){if(this.constructed&&this._editGeometry.parts.length>0)for(const t of this._editGeometry.parts[0].iterateVertices())e(t,t.index)}forEachVertexPosition(e){const t=this._editGeometry.coordinateHelper;this.forEachVertex((i,n)=>{t.vectorToPoint(i.pos,$),e($,n)})}clear(){null!=this.areaMeasurement&&(this.areaMeasurement.geometry=null)}add(e){if(!this.constructed)return null;const t=this._editGeometryOperations.appendVertex(this._editGeometry.coordinateHelper.pointToVector(e),this._editGeometry.parts.at(0));return this.emit("change"),t}close(){if(!this.constructed||0===this._editGeometry.parts.length)return null;const e=this._editGeometryOperations.closePart(this._editGeometry.parts[0]);return this.emit("change"),e}ensureContains(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=!1;if(this._editGeometry.parts.forEach(t=>{for(const n of t.iterateVertices())n===e&&(i=!0)}),!i)throw new Error("vertex doesn't exist ".concat(t));return i}setVertexPosition(e,t){if(!this.constructed)return null;const i=this._editGeometryOperations.setVertexPosition(e,this._editGeometry.coordinateHelper.pointToVector(t));return this.emit("change"),i}equals(e){if(this.numVertices!==e.numVertices)return!1;let t=!0;return this.forEachVertexPosition((i,n)=>{const s=e.getVertexPositionAsPointFromIndex(n);i.equals(s)||(t=!1)}),!!t}};(0,n.Cg)([(0,r.MZ)({value:null})],Q.prototype,"areaMeasurement",null),(0,n.Cg)([(0,r.MZ)({value:null})],Q.prototype,"view",null),(0,n.Cg)([(0,r.MZ)()],Q.prototype,"isEmptyPolygon",null),(0,n.Cg)([(0,r.MZ)()],Q.prototype,"isValidPolygon",null),(0,n.Cg)([(0,r.MZ)()],Q.prototype,"extent",null),(0,n.Cg)([(0,r.MZ)()],Q.prototype,"spatialReference",null),(0,n.Cg)([(0,r.MZ)()],Q.prototype,"numVertices",null),(0,n.Cg)([(0,r.MZ)()],Q.prototype,"polygonIsClosed",null),Q=(0,n.Cg)([(0,o.$)("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurementPathHelper")],Q);const $=new B.A;var K=i(89379),X=(i(11265),i(59784)),Y=i(11113),ee=i(34761),te=i(13191);function ie(e,t){return(0,p.kM)(e,(0,g.cT)(e.value,e.unit,t))}function ne(e,t){return(0,p.kM)(e,se(e,t))}function se(e,t){const i=function(e){switch(e){case"metric":case"ares":case"hectares":return"metric";case"imperial":case"acres":return"imperial";case"square-inches":return"inches";case"square-feet":return"feet";case"square-yards":return"yards";case"square-miles":return"miles";case"square-nautical-miles":return"nautical-miles";case"square-us-feet":return"us-feet";case"square-millimeters":return"millimeters";case"square-centimeters":return"centimeters";case"square-decimeters":return"decimeters";case"square-meters":return"meters";case"square-kilometers":return"kilometers"}throw new Error("unhandled area unit")}(t);return(0,g.Vs)(e.value,e.unit,i)}var re=i(66747),ae=i(7256),oe=i(43047),le=i(32314),he=i(50468),ue=i(17345),de=i(34981),ce=i(59696),pe=i(45463),ge=i(82809),ve=i(86401),me=i(63928),_e=i(16506),fe=i(59246),ye=i(60322),we=i(87230),xe=i(57162);class Me extends fe.w{constructor(e,t){super(e,t,new _e.$(we.C,()=>i.e(2028).then(i.bind(i,62028))),ve.l5.locations)}initializePipeline(e){const{oitPass:t,transparent:i,polygonOffset:n,output:s}=e,r=0===t,a=2===t;return(0,xe.Ey)({blending:i?(0,ye.Yf)(t):null,depthTest:{func:(0,ye.K_)(t)},depthWrite:(0,ye.z5)(e),drawBuffers:(0,ye.m6)(t,s),colorWrite:xe.kn,polygonOffset:r||a?n?Ce:null:{factor:-1,units:-25}})}}const Ce={factor:0,units:-25};var be=i(6485),Pe=i(92656);class Ve extends Pe.E{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.polygonOffset=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=0,this.emissionSource=0,this.output=0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.overlayEnabled=!1,this.draped=!1,this.snowCover=!1}get discardInvisibleFragments(){return this.transparent&&this.writeDepth}}(0,n.Cg)([(0,be.W)()],Ve.prototype,"transparent",void 0),(0,n.Cg)([(0,be.W)()],Ve.prototype,"writeDepth",void 0),(0,n.Cg)([(0,be.W)()],Ve.prototype,"polygonOffset",void 0),(0,n.Cg)([(0,be.W)()],Ve.prototype,"terrainDepthTest",void 0),(0,n.Cg)([(0,be.W)()],Ve.prototype,"cullAboveTerrain",void 0);var Se=i(75569);class Le extends me.W{constructor(e){super(e,Ae),this._configuration=new Ve,this.produces=new Map([[2,e=>(0,de.RN)(e)&&!this.transparent],[4,e=>(0,de.RN)(e)&&this.transparent&&this.parameters.writeDepth],[8,e=>(0,de.RN)(e)&&this.transparent&&!this.parameters.writeDepth]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.transparent=this.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}get visible(){return this.parameters.color1[3]>=Se.Q||this.parameters.color2[3]>=Se.Q}get transparent(){return this.parameters.color1[3]<1||this.parameters.color2[3]<1}createGLMaterial(e){return new De(e)}createBufferWriter(){return new ge.Z(ve.l5)}}class De extends ce.A{beginSlot(e){return this.getTechnique(Me,e)}}class Ae extends pe.q{constructor(){super(...arguments),this.size=(0,m.fA)(1,1),this.color1=(0,y.fA)(.75,.75,.75,1),this.color2=(0,y.fA)(.5,.5,.5,1),this.writeDepth=!0,this.polygonOffset=!1}}class Ze extends le.X{constructor(e){super(e),this._checkerBoardMaterial=null,this._renderOccluded=4,this._geometry=null,this._size=(0,m.fA)(1,1),this._color1=(0,y.fA)(1,.5,0,.5),this._color2=(0,y.fA)(1,1,1,.5),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){(0,v.C)(this._size,e),this._updateMaterial()}get color1(){return this._color1}set color1(e){(0,oe.a)(e,this._color1)||((0,oe.d)(this._color1,e),this._updateMaterial())}get color2(){return this._color2}set color2(e){(0,oe.a)(e,this._color2)||((0,oe.d)(this._color2,e),this._updateMaterial())}_updateMaterial(){var e;null===(e=this._checkerBoardMaterial)||void 0===e||e.setParameters({size:this._size,color1:this._color1,color2:this._color2,renderOccluded:this._renderOccluded})}createExternalResources(){this._checkerBoardMaterial=new Le({size:this._size,color1:this._color1,color2:this._color2,writeDepth:!1,polygonOffset:!0,renderOccluded:4,isDecoration:this.isDecoration})}destroyExternalResources(){this._checkerBoardMaterial=null}forEachMaterial(e){e(this._checkerBoardMaterial)}createGeometries(e){if(null==this._geometry||null==this._checkerBoardMaterial)return;const t=Re;(0,ee.sC)(t,this.transform);const i=this._geometry,n=[],s=(0,f.vt)();i.position.forEach(e=>{(0,_.e)(s,e,t),n.push(s[0],s[1],s[2])});const r=[];i.uv.forEach(e=>{r.push(e[0],e[1])});const a=new ue.V(this._checkerBoardMaterial,[["position",new he.n(n,i.triangleIndices,3,!0)],["uv0",new he.n(r,i.triangleIndices,2,!0)]]);e.addGeometry(a)}}const Re=(0,f.vt)();var Oe=i(25191),ze=i(35925),Te=i(38042),ke=i(63860);let Ge=class extends u.A{get _parameters(){const{accentColor:e,textColor:t}=this.view.effectiveTheme,i=(0,X.QP)(e),n=(0,X.f6)(e,.5),s=(0,X.f6)((0,X.bJ)(e),.5),r=(0,X.bJ)(t,160);return{accentColor:i,transparentAccentColor:n,transparentContrastColor:s,intersectingLineColor:[1,.2,0,1],textColor:t,textBackgroundColor:(0,X._L)(r,.6),textCalloutColor:(0,X._L)(r,.5),pathLineWidth:3,perimeterLineWidth:2,projectionLineWidth:2,projectionLineStippleSize:5,labelDistance:25}}get visible(){return this.analysisViewData.visible}get _renderUnits(){var e;const t=this.view.renderCoordsHelper.spatialReference;return null!==(e=(0,g._H)(t))&&void 0!==e?e:"meters"}get testData(){}constructor(e){super(e),this._path=null,this._intersectedPath=null,this._perimeter=null,this._intersectedPerimeter=null,this._projectionLines=null,this._measurementArea=null,this._areaLabel=null,this._perimeterLengthLabel=null,this._pathSegments=[],this._perimeterSegments=[],this._origin=(0,f.vt)(),this._originTransform=(0,te.vt)(),this.messages=null,this.viewData=He,this.areaLabel=null,this.perimeterLengthLabel=null,this.loadingMessages=!0}initialize(){const{analysisViewData:e,_parameters:t,view:i}=this;this._path=new ae.t({view:i,attached:!0,width:t.pathLineWidth,polygonOffset:!0,renderOccluded:4,isDecoration:!0}),this._intersectedPath=new ae.t({view:i,attached:!0,width:t.pathLineWidth,polygonOffset:!0,renderOccluded:4,isDecoration:!0}),this._perimeter=new ae.t({view:i,attached:!0,width:t.perimeterLineWidth,polygonOffset:!0,renderOccluded:4,isDecoration:!0}),this._intersectedPerimeter=new ae.t({view:i,attached:!0,width:t.perimeterLineWidth,color:t.intersectingLineColor,polygonOffset:!0,renderOccluded:4,isDecoration:!0}),this._projectionLines=new ae.t({view:i,attached:!0,width:t.projectionLineWidth,stipplePattern:(0,ze.wk)(t.projectionLineStippleSize),polygonOffset:!0,renderOccluded:4,isDecoration:!0}),this._measurementArea=new Ze({view:i,attached:!0,isDecoration:!0});const n={attached:!0,view:i,isDecoration:!0};this._areaLabel=new re.N((0,K.A)((0,K.A)({},n),{},{fontSize:16})),this._perimeterLengthLabel=new re.N((0,K.A)((0,K.A)({},n),{},{fontSize:12})),this.addHandles([(0,d.wB)(()=>[e.mode,this.visible,e.unit,e.measurementData,e.stagedPoint],()=>this._update(),d.pc),(0,d.wB)(()=>{var e;return null===(e=i.state)||void 0===e?void 0:e.camera},()=>this._updateLabels(),d.pc),(0,Te.oQ)(()=>this._updateMessageBundle()),(0,d.wB)(()=>this._parameters,e=>{let{accentColor:t,transparentAccentColor:i,transparentContrastColor:n,textColor:s,textBackgroundColor:r,textCalloutColor:a}=e;const{_path:o,_intersectedPath:l,_perimeter:h,_projectionLines:u,_measurementArea:d,_areaLabel:c,_perimeterLengthLabel:p}=this;o.color=t,l.color=t,h.color=t,u.color=t,d.color1=i,d.color2=n,c.textColor=s,c.backgroundColor=r,c.calloutColor=a,p.textColor=s,p.backgroundColor=r,p.calloutColor=a},d.Vh)]),this._updateMessageBundle()}destroy(){this._measurementArea=(0,s.pR)(this._measurementArea),this._path=(0,s.pR)(this._path),this._intersectedPath=(0,s.pR)(this._intersectedPath),this._perimeter=(0,s.pR)(this._perimeter),this._intersectedPerimeter=(0,s.pR)(this._intersectedPerimeter),this._areaLabel=(0,s.pR)(this._areaLabel),this._perimeterLengthLabel=(0,s.pR)(this._perimeterLengthLabel),this._projectionLines=(0,s.pR)(this._projectionLines),this.set("view",null)}_update(){if(this.destroyed||!this.view.ready||!this.view.renderCoordsHelper)return;const{analysisViewData:{measurementData:e},analysisViewData:t}=this;null!=e&&(this._updateViewData(e,t.path),this._updateOrigin(),this._updatePathSegments(),this._updatePerimeterSegments(),this._updateArea(),this._updateProjectionLines(),this._updateLabels())}_updateViewData(e,t){const i=e.validMeasurement,n="geodesic"===e.actualMeasurementMode,s=n?e.geodesicArea:e.area;let r=1;if(s){const e=ie(s,this.analysisViewData.unit);r=(0,c.Vr)(Math.sqrt(e.value)/Math.sqrt(300)),r*=Math.sqrt((0,g.oU)(1,e.unit,"square-meters")),r=(0,g.oU)(r,"meters",this._renderUnits)}const a={validMeasurement:i,numVertices:e.numVertices,hasStagedVertex:e.hasStagedVertex,path:t,mode:e.actualMeasurementMode,positionsRender:e.positionsRender,positionsFittedWorld:e.positionsFittedWorld,positionsFittedRender:e.positionsFittedRender,intersectingSegments:n?e.geodesicIntersectingSegments:e.intersectingSegments,triangleIndices:n?e.geodesicTriangleIndices:e.triangleIndices,areaCentroid:n?e.geodesicAreaCentroidRenderCoords:e.areaCentroidRenderCoords,perimeterLengthLabelSegmentIndex:0,area:n?e.geodesicArea:e.area,pathLength:n?e.geodesicPathLength:e.pathLength,perimeterLength:e.perimeterLength,checkerSize:r};this._set("viewData",a)}_updateOrigin(){const e=this.viewData;(0,z.ix)(e.positionsRender,this._origin),(0,ee.kN)(this._originTransform,this._origin),this._measurementArea.transform=this._originTransform,this._projectionLines.transform=this._originTransform}_createSegments(e){const t=this.viewData,i=this.view.renderCoordsHelper.spatialReference,n=t.mode,s=[],r=[],a=[],o=t.numVertices,l=t.validMeasurement?o:o-1;for(let u=0;u<l;++u){const l=t[e][u],h=t[e][(u+1)%o];let d=null;switch(n){case"euclidean":d=new Oe.C(l,h);break;case"geodesic":d=new Oe.J(l,h,i)}t.intersectingSegments.has(u)?a.push(d):r.push(d),s.push(d)}let h=null;return t.validMeasurement&&t.hasStagedVertex&&l>=2?h=s[s.length-2]:t.hasStagedVertex&&l>=1&&(h=s[s.length-1]),{all:s,nonIntersecting:r,intersecting:a,stagedSegment:h}}_updatePathSegments(){const{visible:e}=this,t=this._createSegments("positionsRender");this._path.setGeometryFromSegments(t.nonIntersecting,this._origin),this._path.visible=e,this._intersectedPath.setGeometryFromSegments(t.intersecting,this._origin),this._intersectedPath.visible=e,this._pathSegments=t.all}_updatePerimeterSegments(){const e=this.visible&&"euclidean"===this.viewData.mode&&this.viewData.path.numVertices>2,t=this._createSegments("positionsFittedRender");this._perimeter.setGeometryFromSegments(t.nonIntersecting,this._origin),this._perimeter.visible=e,this._intersectedPerimeter.setGeometryFromSegments(t.intersecting,this._origin),this._intersectedPerimeter.visible=e,this._perimeterSegments=t.all}_updateArea(){const e=this.viewData;switch(e.mode){case"euclidean":this._updateAreaEuclidean(e);break;case"geodesic":this._updateAreaGeodesic()}}_updateAreaEuclidean(e){const t=this.visible;e.validMeasurement&&0===e.intersectingSegments.size&&e.triangleIndices?(this._measurementArea.geometry={uv:e.positionsFittedWorld,position:e.positionsFittedRender,triangleIndices:e.triangleIndices},this._measurementArea.size=[e.checkerSize,e.checkerSize],this._measurementArea.visible=t):this._measurementArea.visible=!1}_updateAreaGeodesic(){this._measurementArea.visible=!1}_updateProjectionLines(){const e=this.viewData,t=this.visible,i=e.mode,n=e.numVertices;if(n>0&&e.validMeasurement&&"euclidean"===i){const i=[];for(let t=0;t<n;++t){const n=(0,f.vt)();(0,_.e)(n,e.positionsRender[t],this._origin);const s=(0,f.vt)();(0,_.e)(s,e.positionsFittedRender[t],this._origin),i.push([n,s])}this._projectionLines.geometry=i,this._projectionLines.visible=t}else this._projectionLines.geometry=null,this._projectionLines.visible=!1}_updateLabels(){if(this.destroyed)return;const{viewData:e}=this,{area:t,path:i}=e;if(!i)return;const n=this.visible,s=this._areaLabel,r=this._perimeterLengthLabel,a=e.validMeasurement;s.visible=!0,r.visible=!0;let o=!1;const l=function(e,t,i){return e&&t&&(0,Y.zJ)(e,t,(0,g.cT)(t.value,t.unit,i))}(this.messages,t,this.analysisViewData.unit);if(null!=l&&n&&(s.geometry={type:"point",point:e.areaCentroid},s.text=l,o=e.validMeasurement&&0===e.intersectingSegments.size),this._set("areaLabel",l),n&&a&&0===e.intersectingSegments.size){const t="geodesic"===e.mode,i=t?e.pathLength:e.perimeterLength,n=function(e,t,i){return e&&t&&(0,Y.zJ)(e,t,se(t,i))}(this.messages,i,this.analysisViewData.unit);this._set("perimeterLengthLabel",n),r.distance=this._parameters.labelDistance,r.anchor="top",r.text=n;let s=!0;for(let a=0;a<e.numVertices;++a){const i=(e.perimeterLengthLabelSegmentIndex+a)%e.numVertices,n=t?this._pathSegments[i]:this._perimeterSegments[i];if(s=!0,r.geometry={type:"segment",segment:n,sampleLocation:"center"},!r.overlaps(this._areaLabel))break;s=!1}r.visible=s}else r.visible=!1;s.visible=o}_updateMessageBundle(){this.loadingMessages=!0,(0,ke.ud)("esri/core/t9n/Units").then(e=>{this.messages=e,this.view&&this._update()}).finally(()=>{this.loadingMessages=!1})}};(0,n.Cg)([(0,r.MZ)()],Ge.prototype,"_parameters",null),(0,n.Cg)([(0,r.MZ)()],Ge.prototype,"view",void 0),(0,n.Cg)([(0,r.MZ)()],Ge.prototype,"messages",void 0),(0,n.Cg)([(0,r.MZ)()],Ge.prototype,"analysis",void 0),(0,n.Cg)([(0,r.MZ)()],Ge.prototype,"viewData",void 0),(0,n.Cg)([(0,r.MZ)()],Ge.prototype,"analysisViewData",void 0),(0,n.Cg)([(0,r.MZ)({readOnly:!0})],Ge.prototype,"areaLabel",void 0),(0,n.Cg)([(0,r.MZ)({readOnly:!0})],Ge.prototype,"perimeterLengthLabel",void 0),(0,n.Cg)([(0,r.MZ)()],Ge.prototype,"loadingMessages",void 0),(0,n.Cg)([(0,r.MZ)()],Ge.prototype,"visible",null),(0,n.Cg)([(0,r.MZ)()],Ge.prototype,"_renderUnits",null),Ge=(0,n.Cg)([(0,o.$)("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurementVisualization")],Ge);const He={validMeasurement:!1,numVertices:0,hasStagedVertex:!1,path:null,mode:null,positionsRender:null,positionsFittedWorld:null,positionsFittedRender:null,intersectingSegments:null,triangleIndices:null,areaCentroid:null,perimeterLengthLabelSegmentIndex:null,checkerSize:null,area:null,pathLength:null,perimeterLength:null};var Ie=i(56002),Ee=i(50346),We=i(19451),Fe=i(32535),Be=i(70836),Ue=i(7947),qe=i(69539),je=i(88321),Ne=i(76931),Je=i(56121),Qe=i(38317),$e=i(91175);class Ke{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.screenPoint=e,this.result=t}}class Xe{constructor(e,t){this.scenePoint=e,this.mapPoint=t}}var Ye=i(1307),et=i(72017),tt=i(38386),it=i(46576);class nt{constructor(e){this.vertexManipulators=[],this._destroyed=!1,this._isManipulatorsOwner=!0,this._visible=!0,this._listenerHandles=null,this._tempHandlePosition=(0,f.vt)();const{analysisViewData:t,manipulators:i,toolState:n,view:s,visible:r}=e;this._analysisViewData=t,this._toolState=n,null!=i?(this._manipulators=i,this._isManipulatorsOwner=!1):this._manipulators=new tt.t,this._view=s,this._intersector=(0,it.T)(s.state.viewingMode);const a=(0,Qe.UM)(this._handleColor),o=[new $e.M((0,et.CM)(a,1,32,32))],l=new Je.q({view:s,renderObjects:o});l.available=!1,l.radius=ot,l.interactive=!1,this._manipulators.add(l),this._cursorManipulator=l,this._cursorManipulatorMaterial=a,this._laserLine=new Ye.o({view:s,attached:!0,style:{glowWidth:st,glowFalloff:rt,innerWidth:at},isDecoration:!0}),this._updateVisibility(null===r||void 0===r||r)}destroy(){this._listenerHandles=(0,s.pR)(this._listenerHandles),this._isManipulatorsOwner?this._manipulators=(0,s.pR)(this._manipulators):this._manipulators=null,this._laserLine=(0,s.pR)(this._laserLine),this._destroyed=!0}get destroyed(){return this._destroyed}get visible(){return this._visible}set visible(e){e?this.show():this.hide()}get testData(){}show(){this._setVisibility(!0)}hide(){this._setVisibility(!1)}_setVisibility(e){this._destroyed||this._visible===e||this._updateVisibility(e)}_updateVisibility(e){this._visible=e,this._laserLine.visible=e,e?(this._initializeListeners(),this._updateAll()):(this._destroyListeners(),this.vertexManipulators.forEach(e=>{let{manipulator:t}=e;return this._removeVertexManipulator(t)}),this.vertexManipulators=[])}vertexHandleAt(e,t){const i=this._manipulators.intersect(e,t);return null===i||void 0===i?void 0:i.metadata}pick(e){const t=this._view.spatialReference,i=(0,Ne.WA)(e.screenPoint);this._view.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const n=this._intersector.results.min,s=(0,f.vt)();if(!n.getIntersectionPoint(s))return null;const r=this._view.renderCoordsHelper.fromRenderCoords(s,new B.A({spatialReference:t}));return null==r?null:new Xe(s,r)}_updateAll(){this._visible&&(this._updateVertexManipulators(),this._updateLaserLine())}_createVertexManipulator(){const e=(0,Qe.UM)(this._handleColor),t=[new $e.M((0,et.CM)(e,1,32,32))],i=new Je.q({view:this._view,renderObjects:t});return i.radius=ot,this._manipulators.add(i),{manipulator:i,material:e}}_removeVertexManipulator(e){this._manipulators.remove(e)}_updateVertexManipulators(){const{viewData:e}=this._analysisViewData,t=this._analysisViewData.path?this._analysisViewData.path.vertices:[],i=this.vertexManipulators;(function(e,t,i,n){for(;e.length<t;)e.push(i());if(n)for(;e.length>t;)n(e.pop());else e.length=t})(i,t.length,()=>this._createVertexManipulator(),e=>{let{manipulator:t}=e;return this._removeVertexManipulator(t)}),i.forEach((i,n)=>{let{manipulator:s}=i;s.metadata=t[n],s.renderLocation=e.positionsRender[n],s.cursor=0===n&&"drawing"===this._toolState.polygonState?"crosshair":null}),"drawing"===this._toolState.polygonState&&null!=this._analysisViewData.stagedPoint?(this._cursorManipulator.available=!0,this._cursorManipulator.location=this._analysisViewData.stagedPoint):this._cursorManipulator.available=!1}get _handleColor(){return(0,X.f6)(this._view.effectiveTheme.accentColor,.5)}_getFocusPoint(){const{lastDraggedVertex:e}=this._analysisViewData;switch(this._toolState.polygonState){case"drawing":return null!=this._analysisViewData.stagedPoint?this._analysisViewData.stagedPoint:null!=e?this._analysisViewData.path.getVertexPositionAsPoint(e):this._analysisViewData.path.lastPoint;case"editing":return null!=e?this._analysisViewData.path.getVertexPositionAsPoint(e):null;default:return this._analysisViewData.stagedPoint}}_updateLaserLine(){const e="measured"!==this._toolState.polygonState&&this._toolState.active,t=this._getFocusPoint();if(e&&null!=t){const e=this._tempHandlePosition;this._view.renderCoordsHelper.toRenderCoords(t,e),this._laserLine.heightManifoldTarget=e}else this._laserLine.heightManifoldTarget=null}_initializeListeners(){this._listenerHandles=new je.A,this._listenerHandles.add([(0,d.wB)(()=>this._toolState.polygonState,()=>this._updateLaserLine()),(0,d.wB)(()=>this._analysisViewData.viewData,()=>this._updateAll(),d.OH),(0,d.wB)(()=>({lastDraggedVertex:this._analysisViewData.lastDraggedVertex,cursorPoint:this._analysisViewData.stagedPoint}),()=>this._updateLaserLine()),(0,d.wB)(()=>this._toolState.active,()=>this._updateAll()),(0,d.wB)(()=>this._view.effectiveTheme.accentColor,e=>{const t=(0,X.f6)(e,.5);for(const{material:o}of this.vertexManipulators)o.setParameters({color:t});this._cursorManipulatorMaterial.setParameters({color:t});const i=qe.A.toUnitRGB(e),n=qe.A.toUnitRGB((0,X.bJ)(e)),s=.75*e.a,r=this._laserLine,a=r.style;r.style=(0,K.A)((0,K.A)({},a),{},{glowColor:i,innerColor:n,globalAlpha:s})},{initial:!0,equals:X.hw})])}_destroyListeners(){this._listenerHandles=(0,s.pR)(this._listenerHandles)}}const st=8,rt=8,at=1,ot=5;var lt=i(5109),ht=i(17046),ut=i(82307),dt=i(13284),ct=i(61237),pt=i(75218),gt=i(14318),vt=i(70330),mt=i(11500);let _t=class extends lt.k{constructor(e){super(e),this._updatingHandles=new We.U,this._snappingManagerResult=null,this.polygonState="initial",this.removeIncompleteOnCancel=!1,this.manipulators=new tt.t,this._getSnappingContext=(0,Ie.B)(e=>new dt.e({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new J.p(new N.ZE("point",(0,j.BV)(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new Be.s}))}initialize(){const{view:e,analysisViewData:t,manipulators:i,visible:n}=this;this.measurementView=new nt({view:e,analysisViewData:t,toolState:this,manipulators:i,visible:n}),this._snappingOperation=new gt.O({view:e}),this._updatingHandles.add(()=>this.stagedPoint,e=>{this.analysisViewData.stagedPoint=null!=e?(0,Fe.EL)(e,new B.A):null},d.pc),(0,vt.BY)(this,()=>{var e,t;const i=null!==(e=null===(t=this.view.inputManager.latestPointerInfo)||void 0===t?void 0:t.type)&&void 0!==e?e:"mouse",n=this._getSnappingContext(i);this._updatingHandles.addPromise((0,Ee.QZ)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._ensureSnappingManager(),n)))}),this._setupManipulators(),this.addHandles([(0,d.z7)(()=>"measured"===this.state,()=>this.finishToolCreation(),d.pc),this.analysisViewData.path.on("change",()=>{const e=this.analysisViewData.path;"initial"!==this.polygonState||e.isEmptyPolygon||(e.isValidPolygon?this.polygonState="measured":this.polygonState="drawing")})])}destroy(){this.measurementView.destroy(),this._set("measurementView",null),this._updatingHandles=(0,s.pR)(this._updatingHandles)}get _snappingManager(){var e;return null===(e=this._snappingManagerResult)||void 0===e?void 0:e.snappingManager}_ensureSnappingManager(){if(null==this._snappingManagerResult){const e=(0,pt.X)(this.view);this._snappingManagerResult=e,this.addHandles(e)}return this._snappingManagerResult.snappingManager}get state(){return 0===this.analysisViewData.path.numVertices?"ready":this.analysisViewData.path.isValidPolygon&&"editing"!==this.polygonState?"measured":"measuring"}get cursor(){return this.active?"crosshair":null}get updating(){var e;return this._updatingHandles.updating||!(null===(e=this._snappingManager)||void 0===e||!e.updating)}get stagedPoint(){return this._snappingOperation.stagedPoint}set stagedPoint(e){this._snappingOperation.stagedPoint=e}get snappingOptions(){var e;return null===(e=this._snappingManager)||void 0===e?void 0:e.options}finishMeasurement(){const{path:e}=this.analysisViewData;e.numVertices<=2||(e.close(),this.polygonState="measured",this._resetSnappingState(),this.active&&(this.view.activeTool=null))}resetCreated(){super.resetCreated(),this._resetSnappingState(),this.polygonState="initial","measured"===this.state&&(this.polygonState="measured",this.finishToolCreation())}onShow(){this.measurementView.show()}onHide(){this.measurementView.hide()}onDeactivate(){this._resetSnappingState()}onInputEvent(e){switch(e.type){case"immediate-double-click":this._handleImmediateDoubleClick(e);break;case"immediate-click":this._handleImmediateClick(e);break;case"pointer-move":this._handlePointerMove(e);break;case"drag":this._handleDrag(e);break;case"key-down":this._handleKeyDown(e)}}_setupManipulators(){const e=e=>e.events.on("grab-changed",()=>{if(this.analysisViewData.path.isValidPolygon){const e=this.manipulators.some(e=>e.manipulator.grabbing);this.polygonState=e?"editing":"measured"}}),t=t=>{this.addHandles([(0,ht.Xt)(t,(e,t,i,n)=>{const s=(0,Ue.z7)(e),r=e.metadata,a=this._snappingManager,o=this._getSnappingContext(n),l=this._updatingHandles,{snappingStep:h,cancelSnapping:u}=(0,ct.L)({snappingManager:a,snappingContext:o,updatingHandles:l});i=i.next(s).next(t=>(this.analysisViewData.lastDraggedVertex=null,this.analysisViewData.path.setVertexPosition(r,d),e.location=d,t)).next(u),t.next(s).next((0,Ue.xk)(this.view)).next(...h).next(t=>{e.location=t.mapEnd,this.analysisViewData.lastDraggedVertex="end"===t.action?null:r,this.analysisViewData.path.setVertexPosition(r,(0,Fe.EL)(t.mapEnd))});const d=(0,Fe.EL)(this.analysisViewData.path.getVertexPositionAsPoint(r))}),e(t)],t)};this.manipulators.forEach(e=>{let{manipulator:i}=e;t(i)}),this.addHandles([this.manipulators.on("after-add",e=>{let{item:{manipulator:i}}=e;t(i)}),this.manipulators.on("after-remove",e=>{let{item:{manipulator:t}}=e;return this.removeHandles(t)})])}_handleImmediateDoubleClick(e){(0,R.s7)(e)&&("drawing"===this.polygonState&&this.finishMeasurement(),e.stopPropagation())}_handleDrag(e){"editing"===this.polygonState&&e.stopPropagation()}_handleImmediateClick(e){if(!(0,R.s7)(e))return;const t=(0,mt.ZV)(e),{pointerType:i}=e;if(this.active)switch(this.polygonState){case"initial":case"measured":if(this._addVertexAt(t,i))return this.stagedPoint=null,this.polygonState="drawing",void e.stopPropagation();break;case"drawing":{const n=this.measurementView.vertexHandleAt(t,i);if(null==n){if(this._addVertexAt(t,i))return this.stagedPoint=null,void e.stopPropagation()}else 0===n.index&&(this.finishMeasurement(),e.stopPropagation());break}}"mouse"===e.pointerType&&this._hoverAt(t)}_handlePointerMove(e){if("mouse"===e.pointerType){const t=(0,mt.ZV)(e);this._hoverAt(t)}}_handleKeyDown(e){const{path:t}=this.analysisViewData;e.key===ut.NE.complete&&"drawing"===this.polygonState&&t.numVertices>=3&&(this.stagedPoint=null,this.finishMeasurement(),e.stopPropagation())}_hoverAt(e){const{polygonState:t}=this;if(this.active&&ft.has(t)){const t=this._pick(e);if(null!=(null===t||void 0===t?void 0:t.mapPoint)){const e=this._getSnappingContext("mouse");this._updatingHandles.addPromise((0,Ee.QZ)(this._snappingOperation.snap({point:t.mapPoint},this._ensureSnappingManager(),e)))}}else this.stagedPoint=null}_addVertexAt(e,t){const i=this._pick(e),n=null===i||void 0===i?void 0:i.mapPoint;if(null==n)return!1;this.analysis.valid&&"measured"===this.polygonState&&(this.analysis.clear(),this._set("created",!1),this.polygonState="initial");const s=this._getSnappingContext(t),r=this._snappingOperation.update({point:n},this._ensureSnappingManager(),s),a=(0,Fe.EL)(r,new B.A);return this.analysisViewData.path.add(a),!0}_pick(e){const t=new Ke(e);return this.measurementView.pick(t)}_resetSnappingState(){this._ensureSnappingManager().doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}get test(){}};(0,n.Cg)([(0,r.MZ)()],_t.prototype,"_snappingManagerResult",void 0),(0,n.Cg)([(0,r.MZ)()],_t.prototype,"_snappingManager",null),(0,n.Cg)([(0,r.MZ)({readOnly:!0})],_t.prototype,"state",null),(0,n.Cg)([(0,r.MZ)()],_t.prototype,"polygonState",void 0),(0,n.Cg)([(0,r.MZ)({readOnly:!0})],_t.prototype,"cursor",null),(0,n.Cg)([(0,r.MZ)()],_t.prototype,"measurementView",void 0),(0,n.Cg)([(0,r.MZ)()],_t.prototype,"removeIncompleteOnCancel",void 0),(0,n.Cg)([(0,r.MZ)({constructOnly:!0})],_t.prototype,"view",void 0),(0,n.Cg)([(0,r.MZ)({constructOnly:!0})],_t.prototype,"analysis",void 0),(0,n.Cg)([(0,r.MZ)({constructOnly:!0})],_t.prototype,"analysisViewData",void 0),(0,n.Cg)([(0,r.MZ)({readOnly:!0})],_t.prototype,"manipulators",void 0),(0,n.Cg)([(0,r.MZ)()],_t.prototype,"updating",null),(0,n.Cg)([(0,r.MZ)()],_t.prototype,"stagedPoint",null),(0,n.Cg)([(0,r.MZ)()],_t.prototype,"snappingOptions",null),_t=(0,n.Cg)([(0,o.$)("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DTool")],_t);const ft=new Set(["initial","drawing","measured"]);var yt=i(10260),wt=i(66678),xt=i(23739);let Mt=class extends h.P{constructor(e){super(e),this.type="area-measurement-view-3d",this.analysis=null,this.measurementData=null,this.lastDraggedVertex=null,this.stagedPoint=null,this.mode=0,this.tool=null,this.userOperation=null}initialize(){const{analysis:e,view:t}=this;this.path=new Q({view:t,areaMeasurement:e}),this._analysisVisualization=new Ge({view:t,analysis:e,analysisViewData:this}),this.addResolvingPromise(Promise.all([(0,wt.c)(),(0,xt.V)()]).then(i=>{let[n,s]=i;this.destroyed||(this._analysisController=new W({view:t,analysis:e,analysisViewData:this,geodesicAreaMeasurementUtils:n,geodesicLengthMeasurementUtils:s}))})),this.addHandles((0,yt.Hd)(this,_t))}destroy(){(0,yt.aS)(this),this.userOperation=(0,s.DC)(this.userOperation),this._analysisController=(0,s.pR)(this._analysisController),this._analysisVisualization=(0,s.pR)(this._analysisVisualization),this.path.destroy()}get visible(){return super.visible}set visible(e){super.visible=e}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get updating(){var e;return!(null===(e=this._analysisVisualization)||void 0===e||!e.loadingMessages)}get result(){const{measurementData:e}=this;if(null==e)return{area:null,mode:null,perimeter:null};const{unit:t}=this;if("euclidean"===e.actualMeasurementMode){const{area:i,perimeterLength:n}=e;return{area:null!=i?ie(i,t):null,perimeter:null!=n?ne(n,t):null,mode:"euclidean"}}const{geodesicArea:i,pathLength:n}=e;return{area:null!=i?ie(i,t):null,perimeter:null!=n?ne(n,t):null,mode:"geodesic"}}get viewData(){return this._analysisVisualization.viewData}get areaLabel(){return this._analysisVisualization.areaLabel}get perimeterLengthLabel(){return this._analysisVisualization.perimeterLengthLabel}get validMeasurement(){return this.path.isValidPolygon}get unit(){var e;return null!==(e=this.analysis.unit)&&void 0!==e?e:(0,l.c)(this.view)}get testData(){}place(e){return(0,yt.ZX)(this,{placementOptions:e})}};(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"_analysisVisualization",void 0),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"_analysisController",void 0),(0,n.Cg)([(0,r.MZ)({readOnly:!0})],Mt.prototype,"type",void 0),(0,n.Cg)([(0,r.MZ)({constructOnly:!0,nonNullable:!0})],Mt.prototype,"analysis",void 0),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"updating",null),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"result",null),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"measurementData",void 0),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"viewData",null),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"areaLabel",null),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"perimeterLengthLabel",null),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"validMeasurement",null),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"path",void 0),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"lastDraggedVertex",void 0),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"stagedPoint",void 0),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"mode",void 0),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"unit",null),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"tool",void 0),(0,n.Cg)([(0,r.MZ)()],Mt.prototype,"userOperation",void 0),Mt=(0,n.Cg)([(0,o.$)("esri.views.3d.analysis.AreaMeasurementAnalysisView3D")],Mt);const Ct=Mt}}]);
//# sourceMappingURL=4089.11cbca8a.chunk.js.map