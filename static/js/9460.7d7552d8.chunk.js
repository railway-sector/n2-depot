"use strict";(self.webpackChunkn2_depot=self.webpackChunkn2_depot||[]).push([[9460],{2515:(e,t,i)=>{i.d(t,{r:()=>s});var n=i(19898);class r extends n.R{constructor(e,t){super(e,t,"webmap")}}function s(e){return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass}new r(2,35)},3109:(e,t,i)=>{i.d(t,{$x:()=>l,Wn:()=>d,XO:()=>o,iE:()=>u,y6:()=>a});var n=i(73582),r=i(2413),s=i(80963);class a{constructor(e,t,i,n,r){this.extent=e,this.timeExtent=t,this.size=i,this.pixelRatio=n,this.time=r}get flowExtentInfo(){var e;return{modelSize:this.size,valid:null===(e=(0,s.Vp)(this.extent.spatialReference))||void 0===e?void 0:e.valid,extent:(0,r.VY)(this.extent)}}insideMapExtent(e,t){return l(this.flowExtentInfo,e,t)}modelToMapSpace(e,t,i){return o(this.flowExtentInfo,e,t,i)}}function l(e,t,i){const{extent:n,valid:r}=e,[s,a,l,o]=n;return!(i<a||i>o)&&(null!=r&&s>l?t>=l||t<=s:t>=s&&t<=l)}function o(e,t,i,s){const{extent:a,modelSize:l,valid:o}=e,[u,c,h]=a,m=d(u,h,o);let g=t/l[0]*m+u;return null!=o&&s&&(g=new n.hr(o[0],o[1]).normalize(g)),[g,(l[1]-i)/l[1]*(0,r.uJ)(a)+c]}function u(e,t,i){return null!=i&&Math.abs(e-i.valid[0])<i.dx&&Math.abs(t-i.valid[1])<i.dx}function d(e,t,i){if(null!=i&&e>t){const[n,r]=i;return r-e+(t-n)}return t-e}},10600:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(27106);function r(e){return function(){return new s(e.apply(this,arguments))}}function s(e){var t,i;function r(t,i){try{var a=e[t](i),l=a.value,o=l instanceof n.A;Promise.resolve(o?l.v:l).then(function(i){if(o){var n="return"===t?"return":"next";if(!l.k||i.done)return r(n,i);i=e[n](i).value}s(a.done?"return":"normal",i)},function(e){r("throw",e)})}catch(e){s("throw",e)}}function s(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?r(t.key,t.arg):i=null}this._invoke=function(e,n){return new Promise(function(s,a){var l={key:e,arg:n,resolve:s,reject:a,next:null};i?i=i.next=l:(t=i=l,r(e,n))})},"function"!=typeof e.return&&(this.return=void 0)}s.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},s.prototype.next=function(e){return this._invoke("next",e)},s.prototype.throw=function(e){return this._invoke("throw",e)},s.prototype.return=function(e){return this._invoke("return",e)}},27106:(e,t,i)=>{function n(e,t){this.v=e,this.k=t}i.d(t,{A:()=>n})},28701:(e,t,i)=>{i.d(t,{A:()=>ee});var n=i(89379),r=i(6326),s=i(18690),a=(i(81806),i(30726)),l=i(50346),o=i(68134),u=i(52394),d=i(91417),c=i(31633),h=i(46053),m=(i(76460),i(87990)),g=i(34111),f=i(56611),v=i(2413),p=i(80963),_=i(731),y=i(76931),w=i(31723);function T(e){const t=function(e){return"constant"===e.kind?e.value[0]:e.values[e.values.length-1]}(function(e){if(!e.hasVisualVariables("size"))return{kind:"constant",value:[(0,y.Lz)(e.trailWidth)]};const t=e.getVisualVariablesForType("size")[0],i=[],n=[];let r;if(t.stops){for(const e of t.stops)i.push(e.value),n.push((0,y.Lz)(e.size));r=t.stops.length}else i.push(t.minDataValue,t.maxDataValue),n.push((0,y.Lz)(t.minSize),(0,y.Lz)(t.maxSize)),r=2;return{kind:"ramp",stops:i,values:n,count:r}}(e)),i=t,n=Math.max(t/2,5),r=Math.round((0,y.Lz)(e.maxPathLength)/n)+1,{density:s}=e;return{smoothing:(0,y.Lz)(e.smoothing),interpolate:!0,velocityScale:"flow-from"===e.flowRepresentation?1:-1,verticesPerLine:r,minSpeedThreshold:.001,segmentLength:n,maxTurnAngle:1,collisions:!0,lineCollisionWidth:i,lineSpacing:10,density:s,onlyForwardTracing:!0,wrapAround:!1}}function x(e,t){let i=!0;return i=i&&e.collisions===t.collisions,i=i&&e.density===t.density,i=i&&e.interpolate===t.interpolate,i=i&&e.lineCollisionWidth===t.lineCollisionWidth,i=i&&e.lineSpacing===t.lineSpacing,i=i&&e.maxTurnAngle===t.maxTurnAngle,i=i&&e.minSpeedThreshold===t.minSpeedThreshold,i=i&&e.segmentLength===t.segmentLength,i=i&&e.smoothing===t.smoothing,i=i&&e.velocityScale===t.velocityScale,i=i&&e.verticesPerLine===t.verticesPerLine,i}function S(e,t,i,n){return e/=i.size[0],t=1-(t/=i.size[1]),e*=i.extent.xmax-i.extent.xmin,t*=i.extent.ymax-i.extent.ymin,e+=i.extent.xmin,t+=i.extent.ymin,e-=n.extent.xmin,t-=n.extent.ymin,e/=n.extent.xmax-n.extent.xmin,t=1-(t/=n.extent.ymax-n.extent.ymin),{x:e*=n.size[0],y:t*=n.size[1]}}var b=i(69576),M=i(1873),R=i(64147),C=i(3109),A=i(12016);class L extends A.B{constructor(e){super("FlowWorker","generateStreamlines",{generateStreamlines:e=>[e.flowData.data.buffer,e.flowData.mask.buffer],generateTiledStreamlines:e=>{const t=[];return e.flowDataTiles.forEach(e=>{"loaded"===e.type&&t.push(e.data.data.buffer,e.data.mask.buffer)}),t}},e,{strategy:"dedicated"})}generateStreamlines(e,t){return this.invokeMethod("generateStreamlines",e,t)}generateTiledStreamlines(e,t){return this.invokeMethod("generateTiledStreamlines",e,t)}}var V=i(69539),P=i(9392),k=i(75002),E=i(94587),Z=i(12482),z=i(63048),D=i(70667),O=i(1599);function q(e,t,i,n,r,s){let{vertices:a,stage:l,hasMagnitude:o}=i;const{spatialReference:u}=t.extent,d=[],c=(0,w.uu)(o),h=t.flowExtentInfo.modelSize[0];let m=0;for(let w=0;w<a.length;w+=c){if(s&&w>0){const e=a[w]-a[w-c];e>h/2?m-=h:-e>h/2&&(m+=h)}const[i,r]=t.modelToMapSpace(a[w]+m,a[w+1],!1),l=s?[i,r,O.bi]:I(i,r,u,e,n);d.push(l)}const g=Math.floor(a.length/c),f=(0,E.fY)(g);for(let w=0;w<g;w++)f[w]=a[w*c+2];const{hasVVColor:v,hasVVOpacity:p,hasVVSize:_}=r.parameters;let y,T,x;if(o&&(v||p||_)){const e=(0,k.oe)(g);for(let t=0;t<g;t++)e[t]=a[t*c+3];v&&(y=[e]),p&&(T=[e]),_&&(x=[e])}const S=(0,D.yU)([d],void 0,[{timeStamps:f,streamlineType:l}],y,T,x);return(0,D.te)(r,S[0])}function I(e,t,i,n,r){const{absoluteZ:s}=(0,Z.Q5)(e,t,0,i,n,r),a=(0,P.fA)(e,t,s);return n.renderCoordsHelper.toRenderCoords(a,i,a),a}var W=i(10600),j=i(48989),G=i(97255);class F{constructor(e,t,i,n,r){this._query=e,this.streamlines=t,this._material=i,this.geometries=n,this._bytesPerFeature=r,this._startTime=0,this._endTime=1/0,this.usedMemory=null,this.startTime=this._query.time,this.computeMemory()}computeMemory(){const e=(0,G.Qh)(this.streamlines),t=(0,G.Qh)(this.geometries.map(e=>e.attributes)),i=this.streamlines.length*this._bytesPerFeature;this.usedMemory=e+t+i}get startTime(){return this._startTime}set startTime(e){this._query.time!==e&&(this._query=new C.y6(this._query.extent,this._query.timeExtent,this._query.size,this._query.pixelRatio,(0,d.Kp)(e))),this._startTime=e,this.setMaterialParameters({startTime:e})}get endTime(){return this._endTime}set endTime(e){this._endTime=e,this.setMaterialParameters({endTime:e})}get query(){return this._query}hasFadedOut(e){return this.endTime+this._material.parameters.fadeOutTime<e}setMaterialParameters(e){this._material.setParameters(e)}get test(){return null}}var B=i(442),U=i(59752);class N extends F{constructor(e,t,i,n,r){super(e,t,i,n,j.Fq.LINE_ROUND.draped.bytesPerFeature),this._layerView=r,this._drapeRenderer=null,this.drapeSourceType=2,this.updatePolicy=0,this.renderGroup=0,this._frameTask=null,this._renderGeometries=[]}get _view(){return this._layerView.view}get layer(){return this._layerView.layer}get fullOpacity(){return this._layerView.fullOpacity}get attached(){return null!=this._drapeRenderer}get destroyed(){return this.attached}async attach(){const{geometries:e}=this;null!=e&&(this.detach(),this._frameTask=this._view.resourceController.scheduler.registerTask(U.W6.FLOW_GENERATOR),await this._frameTask.scheduleGenerator(t=>this._addGeometryToOverlay(e,t)))}_addGeometryToOverlay(e,t){var i=this;return(0,W.A)(function*(){i._drapeRenderer=i._view.overlayManager.registerGeometryDrapeSource(i);for(let n=0;n<e.length;n+=R.ti){const r=e.slice(n,n+R.ti).map(e=>new B.$(e));i._drapeRenderer.addGeometries(r,0),i._renderGeometries.push(...r),i._drapeRenderer.commitChanges(),t.madeProgress(),t.done&&(t=yield)}})()}detach(){this._frameTask=(0,a.xt)(this._frameTask),this._drapeRenderer&&(this._drapeRenderer.removeGeometries(this._renderGeometries,2),this._drapeRenderer.commitChanges(),this._renderGeometries.length=0),this.attached&&this._view.overlayManager.unregisterDrapeSource(this),this._drapeRenderer=(0,a.pR)(this._drapeRenderer)}}var H=i(37046),$=i(8918);class K extends F{constructor(e,t,i,n,r){super(e,t,i,n,j.Fq.LINE_ROUND.bytesPerFeature),this._view=r,this._objects3D=[],this._engineLayer=null,this._frameTask=null}get attached(){return null!=this._engineLayer}async attach(){const{geometries:e}=this;null!=e&&(this.detach(),this._frameTask=this._view.resourceController.scheduler.registerTask(U.W6.FLOW_GENERATOR),await this._frameTask.scheduleGenerator(t=>this._addGeometryToLayer(e,t)))}detach(){var e,t;this.attached&&(null!==(e=this._engineLayer)&&void 0!==e&&e.removeMany(this._objects3D),this._objects3D.forEach(e=>e.dispose()),null!==(t=this._engineLayer)&&void 0!==t&&t.commit(),this._objects3D=[],this._engineLayer=null,this._frameTask=(0,a.xt)(this._frameTask))}_addGeometryToLayer(e,t){var i=this;return(0,W.A)(function*(){const{stage:n}=i._view,r=new $.x(n,{pickable:!1,updatePolicy:1});for(let s=0;s<e.length;s+=R.ti){const n=new H.B({geometries:e.slice(s,s+R.ti),castShadow:!1});r.add(n),i._objects3D.push(n),r.commit(),t.madeProgress(),t.done&&(t=yield)}i._engineLayer=r})()}}var Y=i(9902),Q=i(12028),X=i(52479),J=i(90992);let ee=class extends b.A{constructor(e){super(e),this.type="flow",this.renderedTiles=null,this.requireLoad=!1,this.workerHandle=null,this.frameTask=null,this._averageLoadingTime=(0,d.Kp)(0),this._abortController=null,this._loadingState="ready-to-load",this._tilesUpdateIsWaiting=!1,this._debugAllowAutoLoading=!0,this.emissiveStrength=0,this._overrideMaterialParameters=null,this._overrideSimulationSettings=null,this._overrideTransitionEnabled=null,this._updateTask=null,this._debouncedTileUpdate=(0,l.sg)(async()=>{const{allTiles:e}=this.surface,t=this._getTileFilterFunction(),i=new Set;await this.frameTask.scheduleGenerator(function*(n){for(let r=0;r<e.length;++r){const s=e.at(r);t(s)&&i.add(s),n.madeProgress(),n.done&&(n=yield)}}),this.renderedTiles=i})}initialize(){const{surface:e,view:t}=this,{resourceController:i}=t;this.workerHandle=new L((0,M.m)(i)),this.frameTask=i.scheduler.registerTask(U.W6.FLOW_GENERATOR),this._updateTask=(0,u.mg)({update:e=>this._update(e)}),this.addHandles([(0,o.wB)(()=>this._simulationSettings,()=>this.triggerLoad(),{sync:!0,equals:(e,t)=>null==e&&null==t||null!=e&&null!=t&&x(e,t)}),(0,o.wB)(()=>{const{elevationInfo:e}=this;return[this._clippingArea,this._visible,this._draped,this.view.state.contentPixelRatio,this.view.viewingMode,null===e||void 0===e?void 0:e.mode,null===e||void 0===e?void 0:e.offset,null===e||void 0===e?void 0:e.unit,this._effectiveDensity]},()=>this.triggerLoad(),o.OH),(0,o.wB)(()=>this._materialParameters,e=>{var t,i;null!==(t=this._resources)&&void 0!==t&&t.setMaterialParameters(e),null===(i=this._lastResources)||void 0===i||i.setMaterialParameters(e)}),e.on("tiles-changed",()=>{this.loadByTileTreesAllowed&&this._triggerTilesUpdate()}),t.enableFeatureTiles(),(0,o.wB)(()=>[this._dataBounds,this._featureTilesBounds,this.loadAllTiles],()=>this._triggerTilesUpdate()),(0,o.wB)(()=>this._flowRenderer,(e,t)=>{var i,n;const r=null!==(i=null===t||void 0===t?void 0:t.visualVariables)&&void 0!==i?i:[],s=null!==(n=null===e||void 0===e?void 0:e.visualVariables)&&void 0!==n?n:[];s.length===r.length&&s.every((e,t)=>e.type===r[t].type)||this.clear()}),(0,o.z7)(()=>{var e;return!(null!==(e=t.featureTiles)&&void 0!==e&&e.updating)},()=>{this.loadByTileTreesAllowed&&this._triggerTilesUpdate()})]),this._triggerTilesUpdate()}destroy(){this._updateTask=(0,a.xt)(this._updateTask),this.abort(),this.clear()}abort(){this._abortController=(0,a.DC)(this._abortController),this.requireLoad=!1}get _clippingArea(){const e=(0,f.projectOrLoad)(this.view.clippingArea,this.surface.spatialReference).geometry;return null==e?null:(0,v.VY)(e)}get _dataBounds(){const e=(0,f.projectOrLoad)(this.layer.fullExtent,this.surface.spatialReference).geometry;return null==e?null:(0,v.VY)(e)}get _draped(){return"on-the-ground"===this.elevationInfo.mode}get _ellipsoidRadius(){return(0,g.tO)(this.view.spatialReference).radius}get extent(){const{spatialReference:e}=this.surface;let t=this.renderedTiles;if(null==e||null==t)return null;const i=this.view.terrainLevel;if(null!=i){const e=new Set;t.forEach(t=>{Math.abs(i-t.level)<R.iM&&e.add(t)}),t=e}const n=(0,w.DW)(t,this.spatialReferenceInfo);return null==n?null:((0,v.E$)(n,this._clippingArea,n),(0,v.w1)(n,e))}get loadAllTiles(){const{position:e}=this.view.camera,t=e.z;return null!=t&&t*(0,c.G9)(e.spatialReference)/this._ellipsoidRadius>=R.FO}get isDataGlobal(){const{extent:e,spatialReferenceInfo:t}=this;return null!=e&&(0,C.iE)(e.xmin,e.xmax,t)}get loadByTileTreesAllowed(){return!this.loadAllTiles||!this.loadRequirementsMet}get _featureTilesBounds(){var e;const t=null===(e=this.view.featureTiles)||void 0===e?void 0:e.filterExtent,i=(0,f.projectOrLoad)(t,this.surface.spatialReference).geometry;return null==i?null:(0,v.VY)(i)}get _flowRenderer(){const e=this.layer.renderer;return"flow"!==(null===e||void 0===e?void 0:e.type)?null:e}get _materialParameters(){return(0,n.A)((0,n.A)((0,n.A)({},function(e,t,i){var n,r,s,a;if(null==e)return{};let l=null;if(e.visualVariables){const t=[],i=e.visualVariables,n=new z.wI({supports:{size:!0,color:!0,rotation:!1,opacity:!0}});l=(0,z.T3)(i,n,t)}const o=null!==(n=l)&&void 0!==n&&n.color?[1,1,1,1]:V.A.toUnitRGBA(e.color);return o[3]*=t,{color:o,width:e.trailWidth,cap:0,animationSpeed:e.flowSpeed,trailLength:e.trailLength,animation:3,emissiveStrength:i,vvColor:null===(r=l)||void 0===r?void 0:r.color,vvOpacity:null===(s=l)||void 0===s?void 0:s.opacity,vvSize:null===(a=l)||void 0===a?void 0:a.size}}(this._flowRenderer,this.layerView.fullOpacity,this.emissiveStrength)),{},{fadeInTime:R.jt,fadeOutTime:R.um},this._overrideMaterialParameters),{},{hasSlicePlane:this.layerView.slicePlaneEnabled,screenSizePerspective:!this._draped&&(0,Q.tl)(this.layer.screenSizePerspectiveEnabled)?this.view.screenSizePerspective.parameters:null})}get _opacity(){return this.layerView.fullOpacity}get _seamlessTransitionWaitingTime(){const{_averageLoadingTime:e}=this;return(0,d.Kp)(0===e?R.$7:this._averageLoadingTime*R.nD)}get _seamlessTransitionEnabled(){return null!=this._overrideTransitionEnabled?this._overrideTransitionEnabled:R.q7}get _tracingResolution(){var e;const{extent:t}=this;if(!t)return[0,0];const i=(0,C.Wn)(t.xmin,t.xmax,null===(e=this.spatialReferenceInfo)||void 0===e?void 0:e.valid)/(t.ymax-t.ymin),[n,r]=this.view.size;let s,a;n<r?(s=n,a=n/i):(s=r*i,a=r);const l=R.NK,o=this.view.qualitySettings.flow3D.maxTracingResolution,u=Math.max(1,l/Math.min(s,a)),d=u*Math.min(1,o/Math.max(s*u,a*u));return[Math.round(s*d),Math.round(a*d)]}get _visible(){var e;const t=null===(e=this._flowRenderer)||void 0===e?void 0:e.color;return this.visibleAtCurrentScale&&this.layer.effectiveVisible&&this._opacity>0&&(null==t||t.a>0)}get _estimatedStreamlines(){const{extent:e,_simulationSettings:t,renderedTiles:i}=this;if(null==t||null==i)return 0;const n=this._tracingResolution[0]*this._tracingResolution[1]/t.lineSpacing**2*t.density,r=null==e?null:(0,v.VY)(e);if(null==r)return 0;let s=0;for(const o of i)(0,v.gR)(r,o.extent)&&(s+=(0,v.Wc)(o.extent));const a=(0,v.Wc)(r),l=0===a?0:s/a;return 2*Math.round(n*l)}get _effectiveDensity(){const{_estimatedStreamlines:e,_simulationSettings:t}=this,{qualitySettings:i,quality:n}=this.view;if(null==t)return 0;const r=i.flow3D.maxTotalNumberOfStreamlines,s=e>=r?r/e:1,a=t.density*s*n;return t.lineSpacing/Math.sqrt(a)<t.lineCollisionWidth?(t.lineSpacing/t.lineCollisionWidth)**2:a}get elevationInfo(){var e;return null!==(e=this.layer.elevationInfo)&&void 0!==e?e:te}startPositions(e){if(!this._seamlessTransitionEnabled)return[];const{_flowRenderer:t,_resources:i}=this;return null==t||null==i?[]:function(e,t,i,n){const r=[],s=i.time-t.time;if(0===e.length)return[];const a=(0,w.Sw)(e),l=a?(0,w.uu)(e[0].hasMagnitude):1,o=a?(e,t)=>{let{vertices:i}=e;const n=i,r=t*l;return{x:n[r],y:n[r+1],t:n[r+2],speed:0}}:(e,t)=>{let{vertices:i}=e;return i[t]};for(const u of e){const{stage:e,vertices:a}=u;if(2===e)continue;const d=a.length/l,c=o(u,0),h=c.t,m=(s*n-h)%(o(u,d-1).t-h)+h;let g,f=c.x,v=c.y,p=c.t;for(g=1;g<d&&p<m;g++){const e=o(u,g),t=Math.min(e.t,m)-p,i=e.t-p;f+=(e.x-f)*(t/i),v+=(e.y-v)*(t/i),p+=t}r.push(S(f,v,t,i))}return r}(i.streamlines,i.query,e,t.flowSpeed)}get needsMagnitude(){var e,t;return null!==(e=null===(t=this._flowRenderer)||void 0===t?void 0:t.hasVisualVariables())&&void 0!==e&&e}get spatialReferenceInfo(){return(0,p.Vp)(this.surface.spatialReference)}get layer(){return this.layerView.layer}get loadingState(){return this._loadingState}get loadRequirementsMet(){return null!=this.renderedTiles&&this.renderedTiles.size>0}getUpdating(){return this.updatingHandles.updating||this.requireLoad||"before-transition"===this._loadingState}get updating(){return this.getUpdating()}get visibleAtCurrentScale(){return!(0,J.j)()||(0,J.E5)(this.layer.effectiveScaleRange,this.view.scale)}get _simulationSettings(){const{_flowRenderer:e,_overrideSimulationSettings:t}=this;if(null==e)return null;let i=T(e);return i.segmentLength=i.lineCollisionWidth/2,i.onlyForwardTracing=!1,i.density*=R.Ci,this.loadAllTiles&&this.isDataGlobal&&(i.density*=R.Cq),null!=t&&(i=(0,n.A)((0,n.A)({},i),t)),i}getSimulationSettings(e){const{_simulationSettings:t,spatialReferenceInfo:i}=this;if(null==t)return null;const r="global"===this.view.viewingMode&&null!=i&&(0,C.iE)(e.extent.xmin,e.extent.xmax,i);return(0,n.A)((0,n.A)({},t),{},{wrapAround:r,density:this._effectiveDensity})}get surface(){return this.view.basemapTerrain}doRefresh(){this.triggerLoad()}clear(){var e,t;null!==(e=this._resources)&&void 0!==e&&e.detach(),this._resources=null,null!==(t=this._lastResources)&&void 0!==t&&t.detach(),this._lastResources=null,this._loadingState="ready-to-load"}_update(e){var t;const i=(0,d.y)(e.time);(null===(t=this._lastResources)||void 0===t?void 0:t.hasFadedOut(i))&&this._lastResources.detach();const n=this._nextStateForTransition(i);if(!this.requireLoad||this.updatingHandles.updating||"ready-to-load"!==n||!this.loadRequirementsMet)return void(this._loadingState=n);this._loadingState="loading";this.updatingHandles.addPromise((0,l.QZ)((async()=>{const e=performance.now(),t=this._seamlessTransitionEnabled&&null!=this._resources?(0,d.Kp)(i+this._seamlessTransitionWaitingTime):i;await this._load(t);const n=(0,d.Kp)((performance.now()-e)/1e3);this._updateAverageLoadingTime(n)})())),this.requireLoad=!1}_updateAverageLoadingTime(e){const t=R.S$;this._averageLoadingTime=(0,d.Kp)(t*e+(1-t)*this._averageLoadingTime)}triggerLoad(){this._debugAllowAutoLoading&&(this.requireLoad=!0)}async _load(e){const{extent:t,view:i}=this;if(!this._visible)return this.clear(),void(this._loadingState="ready-to-load");if(null==t)return void(this._loadingState="ready-to-load");const n=new C.y6(t,this.layerView.timeExtent,this._tracingResolution,i.state.contentPixelRatio,e);null==this._abortController&&(this._abortController=new AbortController);const r=this._abortController,s=await this._loadStreamlines(n,r.signal);if((0,l.Te)(r.signal),this._visible&&null!=s){var a;null!==(a=this._lastResources)&&void 0!==a&&a.detach(),this._lastResources=this._resources,this._resources=s;const t=performance.now()/1e3,i=t>e?t:e;null!=this._lastResources&&(this._lastResources.endTime=i),this._resources.startTime=i,await s.attach(),this._loadingState=this._seamlessTransitionEnabled?"before-transition":"transitioning"}else this._loadingState="ready-to-load"}async _loadStreamlines(e,t){const i=await this.fetchDataAndGenerateStreamlines(e,t);if(null==i)return null;const{geometries:n,material:r}=await this._createGeometry(e,i);return this._draped?new N(e,i,r,n,this.layerView):new K(e,i,r,n,this.view)}async fetchDataAndGenerateStreamlines(e,t){return null}async _createGeometry(e,t){const i=new X.W(this._materialParameters,this.view.state.isGlobal),n=new Array,{elevationInfo:r,_draped:s,view:a}=this;return await this.frameTask.scheduleGenerator(function*(l){for(let o=0;o<t.length;++o)n.push(q(a,e,t[o],r,i,s)),l.madeProgress(),l.done&&(l=yield)}),{geometries:n,material:i}}_triggerTilesUpdate(){if(this._tilesUpdateIsWaiting)return;this._tilesUpdateIsWaiting=!0;this.updatingHandles.addPromise((0,l.QZ)((async()=>{await(0,o.C_)(()=>this.view.stationary),this._tilesUpdateIsWaiting=!1,await this._debouncedTileUpdate()})()))}_getTileFilterFunction(){const{_dataBounds:e,view:t,_featureTilesBounds:i}=this;if(this.loadAllTiles)return t=>t.leaf&&ie(e,t.extent);const n=t=>t.rendered&&t.visible&&ie(e,t.extent),{featureTiles:r}=t;if(!r)return n;const a=r.tiles.filter(e=>e.measures.visible);return e=>n(e)&&ie(i,e.extent)&&a.some(t=>{let{lij:i}=t;return(0,s.aI)(i,e.lij)||(0,Y.ZH)(i,e.lij)})}_nextStateForTransition(e){const{_resources:t}=this;if(null==this._flowRenderer||null==t||"ready-to-load"===this._loadingState||"loading"===this._loadingState)return this._loadingState;const i=t.startTime;return e<i?"before-transition":e<i+R.um?"transitioning":"ready-to-load"}get usedMemory(){var e,t,i,n;return(null!==(e=null===(t=this._lastResources)||void 0===t?void 0:t.usedMemory)&&void 0!==e?e:0)+(null!==(i=null===(n=this._resources)||void 0===n?void 0:n.usedMemory)&&void 0!==i?i:0)}get test(){}};(0,r.Cg)([(0,h.MZ)()],ee.prototype,"type",void 0),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"renderedTiles",void 0),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_resources",void 0),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_lastResources",void 0),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"requireLoad",void 0),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_averageLoadingTime",void 0),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_loadingState",void 0),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"emissiveStrength",void 0),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_clippingArea",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_dataBounds",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_draped",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_ellipsoidRadius",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"extent",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"loadAllTiles",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"isDataGlobal",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_featureTilesBounds",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_flowRenderer",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_materialParameters",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_opacity",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_seamlessTransitionWaitingTime",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_seamlessTransitionEnabled",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_tracingResolution",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_visible",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_estimatedStreamlines",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_effectiveDensity",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"elevationInfo",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"needsMagnitude",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"spatialReferenceInfo",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"layer",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"loadingState",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"updating",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"visibleAtCurrentScale",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_overrideMaterialParameters",void 0),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_overrideSimulationSettings",void 0),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_overrideTransitionEnabled",void 0),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"_simulationSettings",null),(0,r.Cg)([(0,h.MZ)()],ee.prototype,"surface",null),ee=(0,r.Cg)([(0,m.$)("esri.views.3d.layers.FlowSubView3D")],ee);const te=new _.A({mode:"on-the-ground"});function ie(e,t){return null==e||null==t||(0,v.HY)(e,t)}},31516:(e,t,i)=>{i.d(t,{F:()=>s});i(18690),i(53084);var n=i(18288),r=i(59187);i(2515),i(72027);function s(e,t,i){if(null==(null===e||void 0===e?void 0:e.timeInfo))return null;const{datesInUnknownTimezone:s=!1,timeOffset:a,useViewTime:l}=e;let o=e.timeExtent;s&&(o=function(e){if(!e)return e;const{start:t,end:i}=e;return new r.A({start:null!=t?(0,n.S1)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,n.S1)(i,i.getTimezoneOffset(),"minutes"):i})}(o));let u=l?t&&o?t.intersection(o):t||o:o;return!u||u.isEmpty||u.isAllTime?u:(a&&(u=u.offset(-a.value,a.unit)),s&&(u=function(e){if(!e)return e;const{start:t,end:i}=e;return new r.A({start:null!=t?(0,n.S1)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,n.S1)(i,-i.getTimezoneOffset(),"minutes"):i})}(u)),u.equals(i)?i:u)}},31723:(e,t,i)=>{i.d(t,{DW:()=>c,Sw:()=>o,T5:()=>g,Xx:()=>u,Zt:()=>d,uu:()=>l});var n=i(2413),r=i(46533),s=i(76191),a=i(3109);function l(e){return e?4:3}function o(e){return e[0].vertices instanceof Float32Array}class u{constructor(e,t,i,n,r,s){this.data=e,this.mask=t,this.width=i,this.height=n,this.lij=r,this.extent=s}}function d(e){return(0,s.et)(e.lij[0],e.lij[1],e.lij[2])}function c(e,t){let[i,r,s,l]=[null,null,null,null];for(const n of e){const e=n.extent;i=m(e[0],i),r=m(e[1],r),s=h(e[2],s),l=h(e[3],l)}if(null==i||null==r||null==s||null==l)return null;if((0,a.iE)(i,s,t)){const t=[...e].toSorted((e,t)=>e.extent[0]-t.extent[0]);let n=t[0].extent[2],r=0,a=0,l=0;for(let e=1;e<t.length;e++){const[i,s,o]=t[e].extent;if(n<i&&(l++,r=n,a=i,l>1))break;n=Math.max(n,o)}1===l&&(i=a,s=r)}return(0,n.vt)([i,r,s,l])}function h(e,t){return null==t?e:Math.max(e,t)}function m(e,t){return null==t?e:Math.min(e,t)}function g(e,t,i){const[s,l]=i.modelSize;let o=null;const u=new Map;t.forEach(t=>{u.set(t.lij,(0,r.DE)(e,t))});const d=(e,t,i)=>(0,n.Rj)(e.extent,t,i);return(r,c)=>{var h;const m=Math.round(r),g=Math.round(c);if(!e.wrapAround&&(m<0||m>=s||g<0||g>=l))return[0,0];const[f,v]=(0,a.XO)(i,r,c,!0);if(!(0,a.$x)(i,f,v))return[0,0];if(null==o||!d(o,f,v)){o=null;for(const[e,i]of t)if(d(i,f,v)){o=i;break}}if(null==(null===(h=o)||void 0===h?void 0:h.data))return[0,0];const p=u.get(o.lij);if(null==p)return[0,0];const{width:_,height:y,extent:w}=o;return p((f-w[0])/(0,n.VL)(w)*_,y-(v-w[1])/(0,n.uJ)(w)*y)}}},51939:(e,t,i)=>{i.d(t,{AL:()=>_,DV:()=>f,ER:()=>r,F_:()=>l,Nd:()=>m,Oo:()=>s,dy:()=>h,eS:()=>x,h4:()=>S,jC:()=>p,nq:()=>g,rZ:()=>c,y6:()=>v});var n=i(44135);const r="Raster.",s="Raster.Dim.",a=".Max",l={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},o=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function u(e,t){return new n.A({name:e,alias:t,domain:null,editable:!1,length:50,type:"string"})}function d(e,t){return new n.A({name:e,alias:t,domain:null,editable:!1,type:"double"})}function c(e){return u(l.servicePixelValue,null!==e&&void 0!==e?e:"Service Pixel Value")}function h(e){return u(l.rawServicePixelValue,null!==e&&void 0!==e?e:"Raw Service Pixel Value")}function m(){return u(l.itemPixelValue,"Item Pixel Value")}function g(e){return u("".concat(l.servicePixelValue,".").concat(e),e)}function f(e){return d("".concat(l.magnitude),"Magnitude"+(e?" (".concat(e,")"):""))}function v(){return d("".concat(l.direction),"Direction (\xb0)")}function p(e){return e.fields.filter(e=>"oid"!==e.type&&"value"!==e.name.toLowerCase()).map(e=>{const t=e.clone();return t.name="".concat(r).concat(e.name),t})}function _(e){const t=new Set,i=new Set,r=new Map;return e.variables.forEach(e=>{let{dimensions:n}=e;n.forEach(e=>{if(e.recurring)r.set(e.name,e.unit);else{var n,s;const r="ISO8601"===(null===(n=e.unit)||void 0===n?void 0:n.trim())||"stdtime"===(null===(s=e.name)||void 0===s||null===(s=s.trim())||void 0===s?void 0:s.toLowerCase())?t:i;r.add(e.name),e.hasRanges&&r.add("".concat(e.name).concat(a))}})}),[u(l.variable,"Variable"),...[...t].map(e=>function(e,t){return new n.A({name:e,alias:t,domain:null,editable:!1,type:"date"})}("".concat(s).concat(e),w(e))),...[...i].map(e=>d("".concat(s).concat(e),w(e))),...[...r].map(e=>{let[t,i]=e;return d("".concat(s).concat(t),y(t,i))})]}function y(e,t){var i;return(t=null===(i=t)||void 0===i?void 0:i.toLowerCase())&&o.has(t)?o.get(t):w(e)}function w(e){const t=e.endsWith(a),i=t?e.slice(0,-4):e,n="StdTime"===i?"Standard Time":"StdZ"===i?"Standard Z":i;return t?"".concat(n," Max"):n}function T(e,t){return t?new Date(e):e}function x(e,t,i){(null===i||void 0===i?void 0:i.length)&&(t[l.variable]=i[0].variableName,i.forEach(i=>{let{dimensionName:n,values:r}=i;if(n&&null!==r&&void 0!==r&&r.length){const i="".concat(s).concat(n),l=e.find(e=>{let{name:t}=e;return t===i});if(!l)return;const o="date"===l.type,u=r[0];if(Array.isArray(u)){if(t["".concat(s).concat(n)]=T(u[0],o),null!=u[1]){const i="".concat(s).concat(n).concat(a);if(e.some(e=>{let{name:t}=e;return t===i})){const e=T(u[1],o);t[i]=e}}}else t["".concat(s).concat(n)]=T(u,o)}}))}function S(e,t){if(t.pixelType.startsWith("f")&&e.forEach(e=>{let{format:t,fieldName:i}=e;t&&i&&/^raster\.(item|service)pixelvalue/i.test(i)&&(t.places=2)}),t.multidimensionalInfo){const i=t.multidimensionalInfo.variables.flatMap(e=>{let{dimensions:t}=e;return t});e.forEach(e=>{let{format:t,fieldName:n}=e;if(t&&null!==n&&void 0!==n&&n.startsWith(s)){var r;const e=n.slice(s.length),l="".concat(e).concat(a),o=i.find(t=>{let{name:i}=t;return i===e||i===l});(null===o||void 0===o||null===(r=o.values)||void 0===r?void 0:r.every(e=>Number.isInteger(e)))&&(t.places=0)}})}}},64147:(e,t,i)=>{i.d(t,{$7:()=>u,Ci:()=>g,Cq:()=>f,FO:()=>d,NK:()=>h,S$:()=>n,iM:()=>m,jt:()=>s,nD:()=>o,q6:()=>a,q7:()=>l,ti:()=>c,um:()=>r});const n=.1,r=1,s=1,a=1e3,l=!1,o=3,u=1,d=1.5,c=501,h=256,m=3,g=2,f=2},76191:(e,t,i)=>{i.d(t,{Tb:()=>s,et:()=>u,mS:()=>l,nx:()=>a});var n=i(34111),r=i(2413);const s="virtual-snapshot-tile",a="virtual-display-filter-highlight-tile";class l{constructor(e,t,i,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:u(e,t,i);this._tilingScheme=n,this.id=s,this.lij=[0,0,0],this.extent=null,this.measures=new o,this.loadPriority=0,this.used=!1,this.lij[0]=this.measures.lodLevel=e,this.lij[1]=t,this.lij[2]=i,n&&(this.extent=(0,r.vt)(),null===n||void 0===n||n.getExtent(e,t,i,this.extent))}get planetRadius(){return(0,n.tO)(this.spatialReference).radius}get spatialReference(){var e;return null===(e=this._tilingScheme)||void 0===e?void 0:e.spatialReference}get resolution(){var e,t;return null!==(e=null===(t=this._tilingScheme)||void 0===t?void 0:t.resolutionAtLevel(this.measures.lodLevel))&&void 0!==e?e:0}get level(){return this.lij[0]}get lodLevelDelta(){return this.measures.lodLevel-this.level}createChildren(){const e=this.lij[0]+1,t=2*this.lij[1],i=2*this.lij[2];return[new l(e,t,i,this._tilingScheme),new l(e,t+1,i,this._tilingScheme),new l(e,t,i+1,this._tilingScheme),new l(e,t+1,i+1,this._tilingScheme)]}}class o{constructor(){this.visible=!0,this.distance=0,this.lodLevel=0,this.splitPriority=0,this.mergeable=!0}}function u(e,t,i){return"".concat(e,"/").concat(t,"/").concat(i)}}}]);
//# sourceMappingURL=9460.7d7552d8.chunk.js.map