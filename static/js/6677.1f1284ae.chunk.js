"use strict";(self.webpackChunkn2_depot=self.webpackChunkn2_depot||[]).push([[6677],{36035:(e,t,s)=>{s.d(t,{i_:()=>n});var r=s(53430);function n(e,t,s){var n,a;t=null===(n=(0,r.rS)(t))||void 0===n?void 0:n.toLowerCase(),s=null===(a=(0,r.rS)(s))||void 0===a?void 0:a.toLowerCase();const u=e.map(e=>e.toLowerCase()),l=t?e[u.indexOf(t)]:null,p=s?e[u.indexOf(s)]:null;return{longitudeFieldName:l||e[u.indexOf(i.find(e=>u.includes(e)))],latitudeFieldName:p||e[u.indexOf(o.find(e=>u.includes(e)))]}}const o=["lat","lat83","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point_y"],i=["lon","lng","lng83","long","long83","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point_x"]},86677:(e,t,s)=>{s.r(t),s.d(t,{default:()=>W});var r=s(89379),n=s(19495),o=s(56218),i=s(10600),a=s(6326),u=s(19276),l=s(4212),p=s(50076),d=s(81806),c=s(76460),f=s(34429),y=s(13312),m=s(42294),h=s(12034),g=s(9345),v=s(40296),w=s(44135),_=s(1900),x=s(53430),I=s(42553),F=s(46053),R=(s(47249),s(87990));let S=class extends I.o{constructor(e){super(e),this.type="location",this.latitudeFieldName=null,this.longitudeFieldName=null}};(0,a.Cg)([(0,F.MZ)({type:["location"],readOnly:!0,json:{write:!0}})],S.prototype,"type",void 0),(0,a.Cg)([(0,F.MZ)({json:{write:!0}})],S.prototype,"latitudeFieldName",void 0),(0,a.Cg)([(0,F.MZ)({json:{write:!0}})],S.prototype,"longitudeFieldName",void 0),S=(0,a.Cg)([(0,R.$)("esri.layers.support.ParquetEncodingLocation")],S);let A=class extends I.o{constructor(e){super(e),this.type="wkb",this.primaryFieldName=null}};function C(e){switch(e.type){case"wkb":return A.fromJSON(e);case"location":return S.fromJSON(e)}}(0,a.Cg)([(0,F.MZ)({type:["wkb"],readOnly:!0,json:{write:!0}})],A.prototype,"type",void 0),(0,a.Cg)([(0,F.MZ)({json:{write:!0}})],A.prototype,"orientation",void 0),(0,a.Cg)([(0,F.MZ)({json:{write:!0}})],A.prototype,"primaryFieldName",void 0),A=(0,a.Cg)([(0,R.$)("esri.layers.support.ParquetEncodingWkb")],A);var b=s(45802),q=s(36035),O=s(67103);const P=new b.J({esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint"});function N(e){return P.toJSON(e)}function G(e){return P.fromJSON(e)}async function Q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.geometryType&&e.spatialReference&&e.encoding&&e.fields)return e;if(e.urls.length<1)throw new p.A("parquet:bad-input","At least one url must be specified",e);const s=await(0,O.DV)(e.urls.getItemAt(0),{getCustomParameters:()=>t.customParameters}),n=(0,O.hD)(s),o=(0,r.A)((0,r.A)({},e),{},{file:s});null==o.fields&&(o.fields=s.fields().map(e=>w.A.fromJSON({name:e.name,type:e.type}))),null==o.encoding&&(o.encoding=T(n,o.fields));const i=(0,O.Hj)(s);if(i)switch(i.mode){case"z":o.displayOptimization={mode:"z"};break;case"xz":{const e=i.multiscale;if(!e)throw new p.A("bad-format","XZ display optimization requires multiscale geometries");o.displayOptimization={mode:"xz",multiscale:e};break}}if(!o.encoding)return o;switch(o.encoding.type){case"location":null==o.spatialReference&&(o.spatialReference=y.A.WGS84),null==o.geometryType&&(o.geometryType="point");break;case"wkb":{if(!n)return o;const e=n.primary_column,t=n.columns[e];if(o.geometryType||(o.geometryType=function(e){const{geometry_types:t}=e,s=new Set;for(const r of t){const e=D(r);e&&s.add(e)}if(s.size>1)throw new p.A("unsupported","Parquet mixed geometry types are not support",{geometryTypes:s});return 1===s.size?s.values().next().value:void 0}(t)),o.spatialReference||(o.spatialReference=function(e){var t;const s=null===(t=e.crs)||void 0===t||null===(t=t.id)||void 0===t?void 0:t.code;return s&&"number"==typeof s?new y.A({wkid:s}):void 0}(t)),o.fields)for(const s of Object.keys(n.columns))o.fields=o.fields.filter(e=>e.name!==s)}}return o}function T(e,t){if(null!=e){var s;const t=e.primary_column,r=e.columns[t];return new A({primaryFieldName:t,orientation:null!==(s=r.orientation)&&void 0!==s?s:null})}const r=(0,q.i_)(t.map(e=>e.name));return r.latitudeFieldName&&r.longitudeFieldName?new S({latitudeFieldName:r.latitudeFieldName,longitudeFieldName:r.longitudeFieldName}):null}function D(e){switch(e){case"Point":return"point";case"Polygon":case"MultiPolygon":return"polygon";case"LineString":return"polyline";case"MultiPoint":return"multipoint";default:return null}}var M=s(77859),k=s(61137),z=s(21666),j=s(77408),E=s(27428);const B=new M.Z,J=8e3,Z="__OBJECTID";class W{constructor(){this._fileInfos=new Map,this._queue=new f.QueueProcessor({concurrency:4,process:(e,t)=>this._executeQuery(e,t)})}async load(e){var t,s,n,o,i,l,d,f,h,g,x;const I=e.spatialReference?y.A.fromJSON(e.spatialReference):void 0;if(I&&!I.isWGS84&&!I.isWebMercator)throw new p.A("parquet:unsupported-projection","Only WGS84 and Web Mercator are supported");const F=await Q({urls:new u.A(e.urls),fields:null===(t=e.fields)||void 0===t?void 0:t.map(e=>w.A.fromJSON(e)),encoding:e.encoding?C(e.encoding):e.encoding,geometryType:e.geometryType?G(e.geometryType):null,spatialReference:I},{customParameters:e.customParameters});let R;if(F.geometryType&&F.encoding){if(!F.spatialReference)throw new p.A("parquet:unsupported","SpatialReference must be defined");if(!F.spatialReference.isGeographic&&!F.spatialReference.isWebMercator)throw new p.A("parquet:unsupported-projection","Only WGS84 and Web Mercator are supported");F.spatialReference.isGeographic&&!F.spatialReference.isWGS84&&(c.A.getLogger("parquet:unsupported-projection").warn("Found a geographic projection that is not WGS84. Handling as WGS84.",{spatialReference:F.spatialReference}),F.spatialReference=y.A.WGS84),R={geometryType:N(F.geometryType),spatialReference:F.spatialReference.toJSON(),encoding:F.encoding.toJSON(),displayOptimization:F.displayOptimization}}this.setCustomParameters(e.customParameters),this._geometryInfo=R;const S=e.urls;for(const r of S){const e=await(0,O.DV)(r,{geometryInfo:R,outSpatialReference:null,getCustomParameters:()=>this._customParameters});this._fileInfos.set(r,{index:this._fileInfos.size,file:e})}this._capabilities=L(await this.getFileStatistics());const A=null===(s=this._fileInfos.values().next().value)||void 0===s?void 0:s.file;if(!A)return{layerDefinition:{},capabilities:L(null)};const{fields:b}=F;if(null==b)throw new p.A("parquet-layer:missing-metadata","Unable to create parquet source: cannot infer fields",b);b.push(new w.A({name:Z,type:"oid",alias:Z}));const q={fields:b.map(e=>(0,r.A)((0,r.A)({},e.toJSON()),{},{column:A.columnForFieldName(e.name)})),timeZoneByFieldName:null},P=_.A.fromJSON(q);this._fieldsIndex=P;const T=N(null!==(n=F.geometryType)&&void 0!==n?n:"point");if(this._metadata=j.i.createFeature({fieldsIndex:q,geometryType:T,featureIdInfo:{type:"object-id",fieldName:"rowId"},subtypes:null,subtypeField:null,types:null,typeIdField:null,globalIdField:null,spatialReference:F.spatialReference,outSpatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null}),this._queryEngineParams={fieldsIndex:this._metadata.fieldsIndex,geometryType:null!==(o=null===(i=R)||void 0===i?void 0:i.geometryType)&&void 0!==o?o:"esriGeometryPoint",featureIdInfo:{type:"object-id",fieldName:"rowId"},hasM:!1,hasZ:!1,spatialReference:null!==(l=null===(d=R)||void 0===d?void 0:d.spatialReference)&&void 0!==l?l:{wkid:4326},aggregateAdapter:null,timeInfo:null,definitionExpression:null},F.spatialReference&&(this._fullExtent=function(e,t){const s=(0,m.hZ)((0,m.vt)(),m.qv);for(const r of e){const e=(0,O.hD)(r.file);if(!e)return null;const t=e.columns[e.primary_column];if(!t.bbox)return null;const n=H(t.bbox);(0,m.RF)(s,n)}return{xmin:s[0],ymin:s[1],xmax:s[3],ymax:s[4],spatialReference:t}}(this._fileInfos.values(),F.spatialReference.toJSON())),null==this._fullExtent&&"location"===(null===(f=F.encoding)||void 0===f?void 0:f.type)){var D,M,k;const{latitudeFieldName:e,longitudeFieldName:t}=F.encoding,s=null===(D=this._fieldsIndex.get(e))||void 0===D?void 0:D.column,r=null===(M=this._fieldsIndex.get(t))||void 0===M?void 0:M.column,n=(0,m.hZ)((0,m.vt)(),m.qv);for(const o of this._fileInfos.values())for(const e of o.file.rowGroups()){const t={stack:[],error:void 0,hasError:!1};try{const o=(0,a.mS)(t,e.columnDescriptorForAttribute(s),!1),i=(0,a.mS)(t,e.columnDescriptorForAttribute(r),!1),u=[i.minValue(),o.minValue(),i.maxValue(),o.maxValue()];(0,m.DC)(n,u),e.free()}catch(z){t.error=z,t.hasError=!0}finally{(0,a.hk)(t)}}this._fullExtent={xmin:n[0],ymin:n[1],xmax:n[3],ymax:n[4],spatialReference:null===(k=F.spatialReference)||void 0===k?void 0:k.toJSON()}}return{capabilities:this._capabilities,layerDefinition:{fields:null===(h=F.fields)||void 0===h?void 0:h.map(e=>e.toJSON()),drawingInfo:(0,v.F0)(T),extent:null!==(g=this._fullExtent)&&void 0!==g?g:void 0,geometryType:T,encoding:null===(x=F.encoding)||void 0===x?void 0:x.toJSON(),displayOptimization:F.displayOptimization}}}destroy(){for(const e of this._fileInfos.values())e.file.free();this._fileInfos.clear(),this._queue.destroy()}setCustomParameters(e){this._customParameters=e}getFileStatistics(){if(!this._fileInfos.size)return null;const e=Array.from(this._fileInfos.values()).reduce((e,t)=>e+t.file.byteLength(),0);return{featureCount:this._getFeatureCount(),byteLength:e}}async updateFiles(e){const t=new Set(e);for(const[s,r]of this._fileInfos.entries())t.has(s)?t.delete(s):(r.file.free(),this._fileInfos.delete(s));for(const s of t){const e=await(0,O.DV)(s,{geometryInfo:this._geometryInfo,outSpatialReference:null,getCustomParameters:()=>this._customParameters});this._fileInfos.set(s,{index:this._fileInfos.size,file:e})}}async queryFeatures(e,t){var s;return this._validateQuery(e),function(e){var t,s;return!!(null!==(t=e.objectIds)&&void 0!==t&&t.length||e.outStatistics||null!==(s=e.orderByFields)&&void 0!==s&&s.length||e.returnDistinctValues)}(e)||(e.resultRecordCount=e.resultRecordCount?Math.min(e.resultRecordCount,8e3):8e3,e.resultOffset=null!==(s=e.resultOffset)&&void 0!==s?s:0),(e.outStatistics||e.returnDistinctValues)&&delete e.returnGeometry,(await this._enqueueQuery(e,t)).createQueryResponse()}async queryFeatureCount(e,t){return this._validateQuery(e),V(e)?(delete e.outFields,delete e.returnGeometry,(await this._enqueueQuery(e,t)).createQueryResponseForCount()):this._getFeatureCount()}async queryObjectIds(e,t){var s;return this._validateQuery(e),V(e)?(e.resultRecordCount=e.resultRecordCount?Math.min(e.resultRecordCount,8e3):8e3,e.resultOffset=null!==(s=e.resultOffset)&&void 0!==s?s:0,delete e.returnGeometry,delete e.outFields,(await this._enqueueQuery(e,t)).items.map(e=>e.getObjectId())):Array.from({length:this._getFeatureCount()},(e,t)=>t)}async queryExtent(e,t){if(this._validateQuery(e),this._fullExtent&&!V(e))return{count:this._getFeatureCount(),extent:this._fullExtent};const s=(0,l.zI)(this._metadata.spatialReference);e.returnGeometry=!0,delete e.outFields;const r=(0,m.hZ)((0,m.vt)(),m.qv),n=(0,m.vt)(),o=await this._enqueueQuery(e,t);let i=0;for(const a of o.items)a.getBounds(n)&&((0,m.RF)(r,n),i+=1);return{count:i,extent:(0,h.Wc)(r,s,e.outSR?(0,l.zI)(e.outSR):s,s,!1)}}_getFeatureCount(){return Array.from(this._fileInfos.values()).reduce((e,t)=>e+t.file.numRows(),0)}_validateQuery(e){var t;if(!this._capabilities.query.supportsStatistics&&e.outStatistics)throw new p.A("parquet:unsupported","Statistics queries are not supported",{query:e});if(!this._capabilities.query.supportsOrderBy&&null!==(t=e.orderByFields)&&void 0!==t&&t.length)throw new p.A("parquet:unsupported","Queries using orderBy are not supported",{query:e});if(!this._capabilities.query.supportsDistinct&&e.returnDistinctValues)throw new p.A("parquet:unsupported","Queries using returnDistinctValues are not supported",{query:e})}_fetchChunks(e,t){var s=this;return(0,i.A)(function*(){for(const r of s._fileInfos.values()){const n=r.file.numRows(),i=Math.ceil(n/J);for(let a=0;a<i;a++){const n=a*J,i=yield(0,o.A)(r.file.readChunk(n,J,e.fields,e.returnGeometry,t));for(const e of i){const t=new E.s(s._metadata,s._fieldsIndex,e,0,r.index),n=U([new k.j(t,null,0,!1)],s._queryEngineParams);yield n}}}})()}_enqueueQuery(e,t){return this._queue.push(e,t)}async _executeQuery(e,t){var s,r,o;const i=await this._getReadParams(e);if(null!==(s=e.objectIds)&&void 0!==s&&s.length)for(const n of this._fileInfos.values()){const s=[],r=U((await n.file.readChunksByRowId(new Uint32Array(e.objectIds),i.fields,i.returnGeometry,t)).map((e,t)=>new E.s(this._metadata,this._fieldsIndex,e,t,n.index)).map((e,t)=>new k.j(e,null,t,!1)),this._queryEngineParams),o=await r.executeQueryForOpaqueFeatures(e,t);for(const e of o)s.push(e);return new g.G(s,e,{fieldsIndex:this._fieldsIndex,geometryType:this._metadata.geometryType,spatialReference:this._queryEngineParams.spatialReference,objectIdField:"rowId",hasM:!1,hasZ:!1,featureAdapter:B})}let a=null!==(r=e.resultRecordCount)&&void 0!==r?r:this._getFeatureCount(),u=null!==(o=e.resultOffset)&&void 0!==o?o:0;delete e.resultRecordCount,delete e.resultOffset;const l=[];var p,d=!1,c=!1;try{for(var f,y=(0,n.A)(this._fetchChunks(i,t));d=!(f=await y.next()).done;d=!1){const s=f.value;{const r=await s.executeQueryForOpaqueFeatures(e,t);if(r.length>u){const t=r.slice(u,Math.min(u+a,r.length));for(const e of t)l.push(e);if(u=0,a-=t.length,0===a)return new g.G(l,e,{fieldsIndex:this._fieldsIndex,geometryType:this._metadata.geometryType,spatialReference:this._queryEngineParams.spatialReference,objectIdField:"rowId",hasM:!1,hasZ:!1,featureAdapter:B})}else u-=r.length}}}catch(m){c=!0,p=m}finally{try{d&&null!=y.return&&await y.return()}finally{if(c)throw p}}return new g.G(l,e,{fieldsIndex:this._fieldsIndex,geometryType:this._metadata.geometryType,spatialReference:this._queryEngineParams.spatialReference,objectIdField:"rowId",hasM:!1,hasZ:!1,featureAdapter:B})}async _getReadParams(e){const t=new Set;if(e.where&&await(0,x.hz)(t,this._fieldsIndex,e.where),e.outStatistics)for(const s of e.outStatistics)null!=s.onStatisticField&&t.add(s.onStatisticField);if(e.outFields)for(const s of e.outFields)t.add(s);return{fields:this._getAttributeIds(Array.from(t)),returnGeometry:!!e.returnGeometry||!!e.geometry}}_getAttributeIds(e){if(null==e)return new Uint32Array;if(e.includes("*"))return new Uint32Array(this._fieldsIndex.fields.map(e=>e.column).filter(e=>null!=e));const t=[];for(const s of e){const e=this._fieldsIndex.get(s);if(null==e)throw new p.A("unknown-field","Field ".concat(s," does not exist"));null==e.column||t.push(e.column)}return new Uint32Array(t)}}function V(e){return Object.keys(e).some(e=>function(e){switch(e){case"resultOffset":case"resultRecordCount":case"aggregateIds":case"distance":case"gdbVersion":case"geometry":case"having":case"timeExtent":case"where":case"objectIds":case"historicMoment":return!0;default:return!1}}(e))}function U(e,t){const s=new z.I;for(const r of e)s.insert(r);return new h.do((0,r.A)((0,r.A)({},t),{},{featureStore:s}))}function H(e){switch(e.length){case 4:return(0,m.Jt)((0,m.vt)(),e);case 6:return e;default:throw new p.A("parquet:protocol-violation","Invalid Geoparquet file. BoundingBox size must be 4 or 6.",{bbox:e})}}function L(e){const t=null===e||void 0===e?void 0:e.featureCount;let s=!1;return null!=t&&t<(0,d.A)("parquetlayer-full-query-feature-count")&&(s=!0),{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!1,supportsQueryPivot:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},query:{maxRecordCount:8e3,maxRecordCountFactor:void 0,maxUniqueIDCount:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!0,supportsCentroidOnDegeneratedQuantizedGeometry:!1,supportsCurrentUser:!1,supportsDegeneratedQuantizedGeometry:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:s,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:s,supportsPagination:!0,supportsPaginationOnAggregatedQueries:!1,supportsPercentileStatistics:!1,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsReturnMesh:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:s,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,supportsSqlExpression:!1,supportsTrueCurve:!1,tileMaxRecordCount:void 0},queryAttributeBins:{supportsDate:!1,supportsFixedInterval:!1,supportsAutoInterval:!1,supportsFixedBoundaries:!1,supportsStackBy:!1,supportsSplitBy:!1,supportsSnapToData:!1,supportsReturnFullIntervalBin:!1,supportsFirstDayOfWeek:!1,supportsNormalization:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}}}]);
//# sourceMappingURL=6677.1f1284ae.chunk.js.map