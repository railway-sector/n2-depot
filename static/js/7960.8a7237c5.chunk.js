"use strict";(self.webpackChunkn2_depot=self.webpackChunkn2_depot||[]).push([[7960],{67960:(e,t,i)=>{i.r(t),i.d(t,{SelfSnappingEngine:()=>k});var n=i(6326),r=i(91967),s=i(19276),o=i(46053),a=(i(81806),i(76460),i(47249),i(87990)),h=i(73582),l=i(24648),c=i(9392),d=i(12482),p=i(23862),g=i(31633),u=i(19555),f=i(63078),v=i(70330),m=i(17072);class x{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=f.N.shortLineThreshold*f.N.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,p.Lp)(e.leftVertex.pos,this.view,t),(0,p.Lp)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,i){let{spatialReference:n}=i;return 0===this.squaredShortLineThreshold||(0,v.pM)((0,m.j)(t,n,d.qt,this.view),(0,m.j)(e,n,d.qt,this.view))>this.squaredShortLineThreshold}isVertical(e,t,i){let{spatialReference:n}=i;const r=(0,g.GA)(n);return(0,u.Io)((0,p.Xz)(e),(0,p.Xz)(t))*r<f.N.verticalLineThresholdMeters}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}var S=i(45633),P=i(89646),w=i(79337);class L extends x{constructor(e,t,i){super(e,t),this._geodesicLengthMeasurementUtils=i}snapNewVertex(e,t){const i=t.editGeometryOperations.data.parts[0],n=i.segments.length,r=[];if(n<1)return r;const{spatialReference:s}=t,o=(0,m.j)(e,s,d.qt,this.view),{view:a}=this,h=i.segments[n-1];let l=h;do{if((0,v.PA)(l)&&this.edgeExceedsShortLineThreshold(l,t)){const i=(0,v.is)(l,a,t);this._processCandidateProposal(i.left,i.right,e,o,t,r)}l=l.leftVertex.leftSegment}while(l&&l!==h);return r}snapExistingVertex(e,t){const i=[],n=t.vertexHandle,r=n.part;if(r.segments.length<2)return i;const{view:s}=this,{spatialReference:o}=t,a=(0,m.j)(e,o,d.qt,s),h=n.leftSegment,l=n.rightSegment;(0,v.PA)(h)&&(0,v.PA)(l)&&this.edgeExceedsShortLineThreshold(h,t)&&this.edgeExceedsShortLineThreshold(l,t)&&this._processCandidateProposal((0,p.Lp)(h.leftVertex.pos,s,t),(0,p.Lp)(l.rightVertex.pos,s,t),e,a,t,i);const c=r.segments[0];let g=c;do{if((0,v.PA)(g)&&g!==n.leftSegment&&g!==n.rightSegment&&this.edgeExceedsShortLineThreshold(g,t)){const n=(0,v.is)(g,s,t);this._processCandidateProposal(n.left,n.right,e,a,t,i)}g=g.rightVertex.rightSegment}while(g&&g!==c);return i}_processCandidateProposal(e,t,i,n,r,s){var o;const{spatialReference:a,pointer:g}=r,u=(0,c.vt)();!function(e,t,i,n,r,s){(function(e,t,i,n,r,s){let{spatialReference:o}=r;const a=(0,P.IP)(t,i,o,o);if(null==a)return!1;const c=(0,P.IP)(i,n,o,o);if(null==c)return!1;const d=s.geodesicDistance(i,n,o);if(null==d)return!1;const p=Math.abs(h.wf.shortestSignedDiff(a,c))>Math.PI/2?h.uC.normalize(a+Math.PI):a;return(0,P.rT)(e,i,o,(0,l.l3)(d,"meters"),(0,l.Wq)(p,"radians","geographic"),"geodesic"),e[2]=n[2],!0})(e,t,i,n,r,s)||function(e,t,i,n){(0,w.Yv)(t,{start:i,end:n,type:1},e),e[2]=t[2]}(e,n,t,i)}(u,e,t,i,r,this._geodesicLengthMeasurementUtils);const f=(0,p.de)((0,p._7)(u));(0,v.pM)(n,(0,m.j)(f,a,d.qt,this.view))<this.squaredProximityThreshold(g)&&s.push(new S.o({lineStart:e,lineEnd:t,targetPoint:f,isDraped:"on-the-ground"===(null===(o=r.elevationInfo)||void 0===o?void 0:o.mode)}))}}var y=i(72745),V=i(20612),_=i(74050);class T extends x{snapNewVertex(e,t){const i=t.editGeometryOperations.data.parts[0],n=i.segments.length,r=i.vertices.length,s=[];if(n<2)return s;const{view:o}=this,a=(0,m.j)(e,t.spatialReference,d.qt,o),h=i.vertices[0],l=i.vertices[r-1],c=(0,v.PA)(l.leftSegment)?(0,p.Lp)(l.pos,o,t):null,g=(0,v.PA)(h.rightSegment)?(0,p.Lp)(h.pos,o,t):null,u=i.segments[n-1];let f=u;do{if((0,v.PA)(f)&&this.edgeExceedsShortLineThreshold(f,t)){const i=(0,v.is)(f,o,t);c&&this._checkEdgeForParallelLines(i,c,e,a,t,s),g&&this._checkEdgeForParallelLines(i,g,e,a,t,s)}f=f.leftVertex.leftSegment}while(f&&f!==u);return s}snapExistingVertex(e,t){const i=[],n=t.vertexHandle,r=n.part;if(r.segments.length<3)return i;const{view:s}=this,o=(0,m.j)(e,t.spatialReference,d.qt,s),a=n.leftSegment,h=n.rightSegment,l=r.vertices[0],c=(0,p.Lp)(l.pos,s,t),g=r.vertices.length,u=r.vertices[g-1],f=(0,p.Lp)(u.pos,s,t),x=r.segments[0];let S=x;do{if((0,v.PA)(S)&&S!==a&&S!==h&&this.edgeExceedsShortLineThreshold(S,t)){const r=(0,v.is)(S,s,t);(0,v.PA)(a)&&this._checkEdgeForParallelLines(r,(0,p.Lp)(a.leftVertex.pos,s,t),e,o,t,i),(0,v.PA)(h)&&this._checkEdgeForParallelLines(r,(0,p.Lp)(h.rightVertex.pos,s,t),e,o,t,i),n===l?this._checkEdgeForParallelLines(r,f,e,o,t,i):n===u&&this._checkEdgeForParallelLines(r,c,e,o,t,i)}S=S.rightVertex.rightSegment}while(S&&S!==x);return i}_checkEdgeForParallelLines(e,t,i,n,r,s){const o=e.left,a=e.right;if((0,_.fg)(q,(0,p.Xz)(t),(0,p.Xz)(o),(0,p.Xz)(a)),(0,u.hG)(q,(0,p.Xz)(t))<f.N.parallelLineThreshold)return;(0,_.fg)(q,(0,p.Xz)(i),(0,p.Xz)(o),(0,p.Xz)(a),(0,p.Xz)(t));const{spatialReference:h,pointer:l}=r,c=(0,p.de)((0,p.fA)(q[0],q[1],i[2]));if((0,v.pM)(n,(0,m.j)(c,h,d.qt,this.view))<this.squaredProximityThreshold(l)){var g;if(this.isVertical(c,t,r)||this.isVertical(o,a,r))return;if(function(e,t){const i=e.left,n=e.right;for(const r of t)if((0,_.fg)(q,(0,p.Xz)(n),(0,p.Xz)(r.constraint.start),(0,p.Xz)(r.constraint.end),(0,p.Xz)(i)),(0,u.hG)(q,(0,p.Xz)(n))<f.N.parallelLineThreshold)return r.addReferenceLine(e),!0;return!1}(e,s))return;s.push(new V.B({referenceLine:e,lineStart:t,targetPoint:c,isDraped:"on-the-ground"===(null===(g=r.elevationInfo)||void 0===g?void 0:g.mode)}))}}}const q=(0,y.vt)();var z=i(20664),M=i(75543),X=i(78228);class C extends x{constructor(e,t,i){super(e,t),this._geodesicLengthMeasurementUtils=i}snapNewVertex(e,t){const i=t.editGeometryOperations.data.parts[0],n=[];if(i.vertices.length<2)return n;const{view:r}=this,s=(0,m.j)(e,t.spatialReference,d.qt,r),o=i.vertices.at(-1);(0,v.PA)(o.leftSegment)&&this._checkForSnappingCandidate(1,n,o.leftSegment,o,o.leftSegment.leftVertex,e,s,t);const a=i.vertices[0];return(0,v.PA)(a.rightSegment)&&this._checkForSnappingCandidate(2,n,a.rightSegment,a,a.rightSegment.rightVertex,e,s,t),n}snapExistingVertex(e,t){const i=[],n=t.vertexHandle;if(n.part.vertices.length<3)return i;const{view:r}=this,s=(0,m.j)(e,t.spatialReference,d.qt,r),o=n.leftSegment,a=n.rightSegment;if((0,v.PA)(null===o||void 0===o?void 0:o.leftVertex.leftSegment)){const n=o.leftVertex.leftSegment;this._checkForSnappingCandidate(3,i,n,n.rightVertex,n.leftVertex,e,s,t)}if((0,v.PA)(a)&&(0,v.PA)(a.rightVertex.rightSegment)){const n=a.rightVertex.rightSegment;this._checkForSnappingCandidate(3,i,n,n.leftVertex,n.rightVertex,e,s,t)}return i}_checkForSnappingCandidate(e,t,i,n,r,s,o,a){if(!(0,v.PA)(i)||!this.edgeExceedsShortLineThreshold(i,a))return;const d=this.view,g=(0,p.Lp)(n.pos,d,a),f=(0,p.Lp)(r.pos,d,a);(function(e,t,i,n,r,s){(function(e,t,i,n,r,s){let{spatialReference:o}=r;const a=(0,P.IP)(t,i,o,o);if(null==a)return!1;const d=(0,P.IP)(i,n,o,o);if(null==d)return!1;const p=Math.sign(h.uC.shortestSignedDiff(a,d))*Math.PI*.5,g=(0,l.Wq)(a+p,"radians","geographic"),u=(0,c.vt)(),f=s.geodesicDistance(i,n,o);return null!=f&&((0,P.rT)(u,i,o,(0,l.l3)(f,"meters"),g,"geodesic"),(0,z.e)(e,u,i),!0)})(e,t,i,n,r,s)||function(e,t,i){const n=(0,u.Re)(E,(0,p.Xz)(i),(0,p.Xz)(t));(0,z.j)(e,n[1],-n[0],0)}(e,t,i)})(A,f,g,s,a,this._geodesicLengthMeasurementUtils),this._checkForSnappingCandidateAlongProjectedRay(e,t,f,g,A,s,o,a)}_checkForSnappingCandidateAlongProjectedRay(e,t,i,n,r,s,o,a){var h;const{spatialReference:l,pointer:g}=a,f=(0,u.Re)(E,(0,p.Xz)(s),(0,p.Xz)(n)),x=(0,u.Om)(r,f)/(0,u.m3)(r),S=(0,u.Ln)(E,(0,p.Xz)(n),r,x),P=(0,p.de)((0,p.fA)(S[0],S[1],s[2]));if((0,v.pM)(o,(0,m.j)(P,l,d.qt,this.view))>this.squaredProximityThreshold(g)||this.isVertical(P,n,a)||this.isVertical(n,i,a))return;const w=(0,z.c)((0,c.vt)(),n,r,Math.sign(x));t.push(new X.H({targetPoint:P,constraint:new M.FX(n,(0,p._7)(w)),previousVertex:i,otherVertex:n,otherVertexType:1,selfSnappingType:e,isDraped:"on-the-ground"===(null===(h=a.elevationInfo)||void 0===h?void 0:h.mode)}))}}const E=(0,y.vt)(),A=(0,c.vt)();var R=i(59380);class j extends x{snapNewVertex(e,t){const i=t.editGeometryOperations.data.parts[0],n=[],r=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return n;const{view:s}=this,o=i.vertices[0],a=i.vertices[r-1];if(a.leftSegment&&"line"!==a.leftSegment.type||a.rightSegment&&"line"!==a.rightSegment.type)return n;const h=(0,p.Lp)(o.pos,s,t),l=(0,p.Lp)(a.pos,s,t);return this._processCandidateProposal(h,l,e,t,n),n}snapExistingVertex(e,t){var i,n;const r=[],s=t.vertexHandle,o=s.part;if(o.segments.length<2)return r;if("polyline"===t.editGeometryOperations.data.type&&(0===s.index||s.index===o.vertices.length-1))return r;if("line"!==(null===(i=s.leftSegment)||void 0===i?void 0:i.type)||"line"!==(null===(n=s.rightSegment)||void 0===n?void 0:n.type))return r;const{view:a}=this,h=(0,p.Lp)(s.leftSegment.leftVertex.pos,a,t),l=(0,p.Lp)(s.rightSegment.rightVertex.pos,a,t);return this._processCandidateProposal(h,l,e,t,r),r}_processCandidateProposal(e,t,i,n,r){if(!this.exceedsShortLineThreshold(e,t,n))return;const s=(0,u.Cc)(F,(0,p.Xz)(e),(0,p.Xz)(t),.5),o=.5*(0,u.Io)((0,p.Xz)(e),(0,p.Xz)(t)),a=(0,_.Dh)(F,(0,p.Xz)(i),s,o),h=(0,p.de)((0,p.fA)(a[0],a[1],i[2])),{spatialReference:l,pointer:c}=n,g=(0,m.j)(i,l,d.qt,this.view);if((0,v.pM)(g,(0,m.j)(h,l,d.qt,this.view))<this.squaredProximityThreshold(c)){var f;if(this.isVertical(e,h,n)||this.isVertical(h,t,n))return;r.push(new R.R({targetPoint:h,point1:e,point2:t,isDraped:"on-the-ground"===(null===(f=n.elevationInfo)||void 0===f?void 0:f.mode)}))}}}const F=(0,y.vt)();let k=class extends r.A{constructor(e){super(e),this.updating=!1,this._snappers=new s.A,this._domain=2}initialize(){this._snappers.push(new T(this.view,this.options),new L(this.view,this.options,this.geodesicLengthMeasurementUtils),new C(this.view,this.options,this.geodesicLengthMeasurementUtils),new j(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,i){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const n=[];for(const r of this._snappers.items)for(const t of r.snap(e,i))n.push(t);return(0,v.xX)(e,n),n}};(0,n.Cg)([(0,o.MZ)({readOnly:!0})],k.prototype,"updating",void 0),(0,n.Cg)([(0,o.MZ)({constructOnly:!0})],k.prototype,"view",void 0),(0,n.Cg)([(0,o.MZ)({constructOnly:!0})],k.prototype,"geodesicLengthMeasurementUtils",void 0),(0,n.Cg)([(0,o.MZ)()],k.prototype,"options",null),k=(0,n.Cg)([(0,a.$)("esri.views.interactive.snapping.SelfSnappingEngine")],k)},89646:(e,t,i)=>{i.d(t,{$h:()=>g,Ef:()=>L,IP:()=>f,P1:()=>S,hF:()=>w,jQ:()=>x,rT:()=>P,uR:()=>v});var n=i(73582),r=i(24648),s=i(31633),o=i(19555),a=i(72745),h=i(20664),l=i(9392),c=i(14487),d=i(7137),p=i(80963);function g(e,t){if(null==e||null==t)return;const i=u(e,t);return null!=i?(0,r.Wq)(i,"radians","geographic"):void 0}const u=(()=>{const e=(0,l.vt)(),t=(0,l.vt)();return(i,n)=>{var r,s;return(0,h.j)(e,i.x,i.y,null!==(r=i.z)&&void 0!==r?r:0),(0,h.j)(t,n.x,n.y,null!==(s=n.z)&&void 0!==s?s:0),f(e,t,i.spatialReference,n.spatialReference)}})(),f=(()=>{const e=(0,a.vt)(),t=(0,l.vt)(),i=(0,l.vt)();return(n,r,l,g)=>{if((0,h.q)(n,r))return;const u=(0,d.Xn)(l),f=(0,d.Xn)(g);if(u&&f&&(0,p.aI)(u,f)&&(0,c.F)(n,l,t,u)&&(0,c.F)(r,g,i,f)){const{azimuth:e}=(0,d._3)(V,t,i,u);return null!=e?(0,s.oU)(e,"degrees","radians"):void 0}e[0]=r[0]-n[0],e[1]=r[1]-n[1];let v=(0,o.g7)(a.JP,e);return e[0]<0&&(v=_-v),v}})();function v(e,t,i){if(t&&i)switch(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"absolute"){case"absolute":return g(t,i);case"relative":return x(m(e,t,i),"relative");case"relative-bilateral":return x(m(e,t,i),"relative-bilateral")}}function m(e,t,i){if(!e||!t||!i)return;const n=u(e,t),s=u(t,i);return null!=n&&null!=s?(0,r.Wq)(s-n,"radians","geographic"):void 0}function x(e,t){if(null!=e)switch(t){case"absolute":return S(e);case"relative":{const t=w(e);let i=q.normalize(t,0,!0);return-180===i&&(i=180),(0,r.Wq)(i,"degrees","geographic")}case"relative-bilateral":{const t=w(e),i=Math.abs(q.normalize(t,0,!0));return(0,r.Wq)(i,"degrees","geographic")}}}function S(e){const t=w(e),i=T.normalize(t,0,!0);return(0,r.Wq)(i,"degrees","geographic")}const P=(()=>{const e=(0,l.vt)();return function(t,i,n,o,a){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"geodesic";(0,h.d)(e,i);const p=w(a);if("geodesic"===l){const r=(0,d.Xn)(n);if(r&&(0,c.F)(e,n,e,r))return(0,d.vN)(t,e,p,o,r),t[2]=i[2],!!(0,c.F)(t,r,t,n)}const g=(0,r.g2)(p,"geographic","arithmetic"),u=(0,s.oU)(g,"degrees","radians"),f=i[0]+o*Math.cos(u),v=i[1]+o*Math.sin(u),m=i[2];return(0,h.j)(t,f,v,m),!0}})();function w(e){if(null!=e)return(0,r.g2)(y(e),e.rotationType,"geographic")}function L(e){if(null!=e)return(0,r.g2)(y(e),e.rotationType,"arithmetic")}function y(e){return(0,s.oU)(e.value,e.unit,"degrees")}const V=new d.Zj,_=2*Math.PI,T=n.ie,q=new n.hr(-180,180)}}]);
//# sourceMappingURL=7960.8a7237c5.chunk.js.map